/**
 * Unknown World - CRT 테마 스타일시트 (단일 CSS SSOT)
 *
 * RULE-002 준수: 채팅 버블 UI 금지 - 게임 로그/HUD 형태만 허용
 * Frontend Style Guide 준수: CRT 터미널 레트로 미학
 *
 * @see vibe/ref/frontend-style-guide.md
 */

/* ============================================
   1. CRT 테마 토큰 (CSS Variables)
   ============================================ */
:root {
  color-scheme: dark; /* U-049: 시스템 브라우저 요소(스크롤바 등)를 다크 모드로 강제 */
  /* 기본 색상 - CRT 인광 녹색 테마 */
  --bg-color: #0d0d0d; /* 배경: 거의 순수한 검정 */
  --text-color: #33ff00; /* 주 텍스트: 인광 녹색 (CRT 그린) */
  --text-dim: #22a000; /* 보조 텍스트: 약간 더 밝게 하여 가독성 향상 (U-049) */
  --accent-color: #ff00ff; /* 강조색: 마젠타 */
  --border-color: #33ff00; /* 테두리: 인광 녹색 */
  --panel-bg: rgba(0, 15, 0, 0.7); /* 패널 배경: 대비 향상을 위해 불투명도 증가 (U-049) */
  --warning-color: #ffaa00; /* 경고: 주황색 */
  --error-color: #ff3333; /* 에러: 붉은색 */

  /* CRT 효과 */
  --crt-scanline: rgba(18, 16, 16, 0.1);
  --crt-flicker: 0.03;
  --glow-intensity: 5px;
  --crt-flicker-opacity-min: 0.97;
  --crt-flicker-opacity-max: 1;

  /* 타이포그래피 */
  --font-main: 'NeoDunggeunmo', 'VT323', monospace;
  --font-micro-en:
    'Share Tech Mono', 'Consolas', monospace; /* U-037: 영문 마이크로 텍스트 가독성 */
  --font-size-base: 16px;
  --font-size-lg: 1.2rem;
  --font-size-xl: 1.5rem;
  --font-size-2xl: 2rem;
  --line-height-base: 1.5;

  /* 마이크로 텍스트 (U-049: 가독성을 위해 최소 크기 상향) */
  --font-size-xs: 0.8125rem; /* 13px at 1.0 scale - 최소 마이크로 텍스트 */
  --font-size-sm: 0.9375rem; /* 15px at 1.0 scale - 작은 텍스트 */

  /* UI 스케일 (U-028: 전역 스케일 조절) */
  --ui-scale-factor: 1;

  /* 레이아웃 */
  --spacing-xs: 4px;
  --spacing-sm: 8px;
  --spacing-md: 16px;
  --spacing-lg: 24px;
  --spacing-xl: 32px;
  --border-radius: 4px;
  --max-width: 1400px;

  /* 그리드 레이아웃 */
  --header-height: 60px;
  --footer-height: 140px; /* U-050 v6: 컴팩트 카드에 맞춰 높이 조정 */
  --sidebar-width: 320px;
}

/* ============================================
   2. 폰트 정의
   ============================================ */
@font-face {
  font-family: 'NeoDunggeunmo';
  src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2001@1.3/NeoDunggeunmo.woff')
    format('woff');
  font-weight: normal;
  font-display: swap;
}

/* ============================================
   3. Reset & Base
   ============================================ */
*,
*::before,
*::after {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

html {
  /* U-028: UI 스케일 적용 - font-size가 스케일 팩터에 반응 */
  font-size: calc(var(--font-size-base) * var(--ui-scale-factor));
  line-height: var(--line-height-base);
}

html,
body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  background-color: var(--bg-color);
  color: var(--text-color);
  /* U-049: 표준 스크롤바 스타일 (Firefox 등) */
  scrollbar-width: thin;
  scrollbar-color: rgba(51, 255, 0, 0.3) var(--bg-color);
}

body {
  font-family: var(--font-main);
  min-height: 100vh;
  overflow: hidden;
  text-shadow:
    0 0 2px rgba(0, 0, 0, 0.8),
    0 0 var(--glow-intensity) var(--text-dim);
}

#root {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

/* ============================================
   4. CRT 오버레이 효과
   ============================================ */

/* 스캔라인 오버레이 - U-050 v6: 스캔라인 강도 완화 */
.crt-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  /* 스캔라인: 적당히 (0.35) - 분위기와 가독성 균형 */
  background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.35) 50%);
  background-size: 100% 2px;
  pointer-events: none;
  z-index: 9999;
  /* 플리커: 느리게 (0.5s), 미세한 변화만 */
  animation: flicker 0.5s infinite;
}

/* 
 * U-037: 중요도 기반 레이어링
 * - Critical: 오버레이(9999) 위로 뚫고 올라와 선명하게 표시
 * - Ambient: 오버레이 아래에 위치하여 CRT 분위기 적용
 */

/* Critical 보호 레이어 (오버레이 위) */
[data-ui-importance='critical'],
.ui-critical,
.phase-item,
.currency-value,
.action-card-cost,
.agent-error {
  position: relative;
  z-index: 10000;
}

/* Ambient 분위기 레이어 (오버레이 아래) */
.game-title,
.panel-header,
.action-card-title {
  position: relative;
  z-index: 1; /* 9999 오버레이보다 아래 */
}

#root {
  min-height: 100vh;
}

/* 플리커(깜빡임) 애니메이션 - U-050 v5: 미세한 깜빡임 */
@keyframes flicker {
  0%,
  100% {
    opacity: 0.95;
  }
  25% {
    opacity: 1;
  }
  50% {
    opacity: 0.97;
  }
  75% {
    opacity: 0.99;
  }
}

/* 글리치 효과 (타이틀용) */
.glitch {
  position: relative;
}

.glitch::before,
.glitch::after {
  content: attr(data-text);
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}

.glitch::before {
  left: 2px;
  text-shadow: -1px 0 #ff0000;
  clip-path: inset(0 0 0 0);
  animation: glitch-anim-1 5s infinite linear alternate-reverse;
}

.glitch::after {
  left: -2px;
  text-shadow: -1px 0 #0000ff;
  clip-path: inset(0 0 0 0);
  animation: glitch-anim-2 5s infinite linear alternate-reverse;
}

@keyframes glitch-anim-1 {
  0%,
  100% {
    clip-path: inset(0 0 95% 0);
  }
  20% {
    clip-path: inset(30% 0 50% 0);
  }
  40% {
    clip-path: inset(10% 0 70% 0);
  }
  60% {
    clip-path: inset(80% 0 5% 0);
  }
  80% {
    clip-path: inset(45% 0 35% 0);
  }
}

@keyframes glitch-anim-2 {
  0%,
  100% {
    clip-path: inset(95% 0 0 0);
  }
  20% {
    clip-path: inset(50% 0 30% 0);
  }
  40% {
    clip-path: inset(70% 0 10% 0);
  }
  60% {
    clip-path: inset(5% 0 80% 0);
  }
  80% {
    clip-path: inset(35% 0 45% 0);
  }
}

/* ============================================
   5. 게임 레이아웃 (CSS Grid)
   - RULE-002: 채팅 UI가 아닌 게임 UI 고정
   ============================================ */

.game-container {
  display: grid;
  grid-template-areas:
    'header header header'
    'sidebar-left center sidebar-right'
    'footer footer footer';
  grid-template-columns: var(--sidebar-width) 1fr var(--sidebar-width);
  grid-template-rows: var(--header-height) 1fr var(--footer-height);
  /* U-049: 스크롤 방지 - dvh 사용 및 overflow 제어 */
  height: 100dvh;
  height: 100vh; /* dvh 미지원 브라우저 폴백 */
  max-height: 100dvh;
  max-height: 100vh;
  width: 100%;
  max-width: var(--max-width);
  margin: 0 auto;
  padding: var(--spacing-sm);
  gap: var(--spacing-sm);
  overflow: hidden; /* U-049: 의도치 않은 스크롤 방지 */
}

/* ============================================
   6. Header 영역
   - Title, Language Toggle, Theme Toggle,
     Connection Status, Economy HUD
   ============================================ */

.game-header {
  grid-area: header;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 var(--spacing-md);
  border: 1px solid var(--border-color);
  background-color: var(--panel-bg);
  box-shadow:
    inset 0 0 20px rgba(0, 0, 0, 0.5),
    0 0 10px var(--text-dim);
}

.game-title {
  font-size: var(--font-size-2xl);
  color: var(--text-color);
  text-transform: uppercase;
  letter-spacing: 4px;
}

.header-controls {
  display: flex;
  align-items: center;
  gap: var(--spacing-md);
}

.economy-hud {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  padding: var(--spacing-xs) var(--spacing-sm);
  border: 1px solid var(--text-dim);
  background-color: rgba(0, 0, 0, 0.5);
}

.economy-hud .signal-icon {
  color: var(--accent-color);
}

.connection-status {
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
  font-size: 0.875rem;
}

.status-indicator {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background-color: var(--text-color);
  box-shadow: 0 0 6px var(--text-color);
  animation: pulse 2s infinite;
}

.status-indicator.offline {
  background-color: var(--error-color);
  box-shadow: 0 0 6px var(--error-color);
  animation: none;
}

@keyframes pulse {
  0%,
  100% {
    opacity: 1;
  }
  50% {
    opacity: 0.5;
  }
}

/* ============================================
   7. Sidebar (Left) 영역
   - Inventory, Quest/Objective, Rule Board
   - U-049: 컬럼 전체 스크롤 제거, 패널 콘텐츠 단위 스크롤
   ============================================ */

.sidebar-left {
  grid-area: sidebar-left;
  display: flex;
  flex-direction: column;
  gap: var(--spacing-sm);
  min-height: 0; /* U-049: flex 자식 축소 허용 */
  overflow: hidden; /* U-049: 컬럼 전체 스크롤 제거 */
}

/* ============================================
   8. Center 영역
   - Scene Canvas, Narrative Feed (로그 형태)
   ============================================ */

.game-center {
  grid-area: center;
  display: flex;
  flex-direction: column;
  gap: var(--spacing-sm);
  overflow: hidden;
}

.scene-canvas {
  flex: 1;
  border: 1px solid var(--border-color);
  background-color: var(--panel-bg);
  box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.8);
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  min-height: 200px;
  overflow: hidden; /* 내부 이미지 넘침 방지 */
}

/* U-020: Scene Image 컨테이너 스타일 */
.scene-image-container {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
}

.scene-placeholder {
  color: var(--text-color);
  font-size: var(--font-size-lg);
  text-align: center;
  background-color: rgba(0, 0, 0, 0.6);
  padding: var(--spacing-md);
  border: 1px solid var(--text-dim);
  text-shadow: 0 0 10px var(--text-color);
}

/* U-031: Scene Canvas 상태별 placeholder 스타일 */
.scene-status-label {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--spacing-sm);
  font-size: var(--font-size-lg);
  text-transform: uppercase;
  letter-spacing: 2px;
}

.scene-status-emoji {
  font-size: 1.5em;
}

.scene-status-message {
  margin-top: var(--spacing-xs);
  font-size: var(--font-size-sm);
}

/* 상태별 배경 이미지 적용 (container로 이동) */
.scene-image-container.scene-status-loading,
.scene-image-container.scene-status-offline,
.scene-image-container.scene-status-blocked,
.scene-image-container.scene-status-low_signal,
.scene-image-container.scene-status-default {
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
}

/* 로딩 상태: 펄스 애니메이션 */
.scene-image-container.scene-status-loading .scene-placeholder {
  animation: loading-pulse 2s ease-in-out infinite;
}

@keyframes loading-pulse {
  0%,
  100% {
    opacity: 0.7;
  }
  50% {
    opacity: 1;
  }
}

/* 오프라인 상태: 정적 노이즈 효과 */
.scene-image-container.scene-status-offline {
  position: relative;
}

.scene-image-container.scene-status-offline::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: repeating-linear-gradient(
    0deg,
    transparent,
    transparent 2px,
    rgba(0, 0, 0, 0.1) 2px,
    rgba(0, 0, 0, 0.1) 4px
  );
  pointer-events: none;
  animation: static-noise 0.5s steps(5) infinite;
}

@keyframes static-noise {
  0%,
  100% {
    opacity: 0.3;
  }
  50% {
    opacity: 0.5;
  }
}

/* 차단 상태: 경고색 테두리 */
.scene-image-container.scene-status-blocked {
  border-color: var(--warning-color);
  box-shadow: inset 0 0 30px rgba(255, 170, 0, 0.2);
}

.scene-image-container.scene-status-blocked .scene-status-label {
  color: var(--warning-color);
}

/* 저신호 상태: 희미한 표시 */
.scene-image-container.scene-status-low_signal .scene-placeholder {
  opacity: 0.8;
}

.scene-image-container.scene-status-low_signal .scene-status-label {
  color: var(--text-dim);
}

/* 정상 장면 표시 */
.scene-image-container.scene-active {
  background-color: transparent;
}

.scene-image-container .scene-image {
  width: 100%;
  height: 100%;
  object-fit: cover;
  /* U-020: 페이드 인 효과 */
  opacity: 0;
  transition: opacity 0.3s ease-in-out;
}

/* U-020: 이미지 로드 완료 시 표시 */
.scene-image-container .scene-image.scene-image-loaded {
  opacity: 1;
}

/* ============================================
   8.0.1 이미지 로딩 인디케이터 (U-020)
   - RULE-008: 텍스트 우선 + Lazy 이미지 정책
   - Q1 Option A: 이전 이미지 유지 + 로딩 상태 표시
   ============================================ */

/* 로딩 인디케이터 컨테이너 */
.scene-loading-indicator {
  position: absolute;
  bottom: var(--spacing-md);
  right: var(--spacing-md);
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
  padding: var(--spacing-xs) var(--spacing-sm);
  background-color: rgba(0, 20, 0, 0.9);
  border: 1px solid var(--accent-color);
  border-radius: 2px;
  z-index: 15;
  animation: loading-fade-in 0.2s ease-out;
}

@keyframes loading-fade-in {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* 로딩 스피너 */
.scene-loading-spinner {
  width: 14px;
  height: 14px;
  border: 2px solid var(--text-dim);
  border-top-color: var(--accent-color);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

/* 로딩 텍스트 */
.scene-loading-text {
  font-size: var(--font-size-xs);
  color: var(--accent-color);
  text-transform: uppercase;
  letter-spacing: 1px;
}

/* 이미지 로딩 중 캔버스 상태 */
.scene-image-container.image-loading {
  /* 약간의 시각적 힌트 */
}

.scene-image-container.image-loading::before {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 3px;
  background: linear-gradient(90deg, transparent 0%, var(--accent-color) 50%, transparent 100%);
  animation: loading-bar 1.5s ease-in-out infinite;
  z-index: 20;
}

@keyframes loading-bar {
  0% {
    transform: translateX(-100%);
  }
  100% {
    transform: translateX(100%);
  }
}

/* ============================================
   8.0.2 이미지 에러 배지 (U-020)
   - RULE-004: 실패 시 안전한 폴백
   ============================================ */

.scene-error-badge {
  position: absolute;
  top: var(--spacing-md);
  right: var(--spacing-md);
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
  padding: var(--spacing-xs) var(--spacing-sm);
  background-color: rgba(40, 0, 0, 0.9);
  border: 1px solid var(--warning-color);
  border-radius: 2px;
  z-index: 15;
  animation: error-shake 0.3s ease-out;
}

@keyframes error-shake {
  0%,
  100% {
    transform: translateX(0);
  }
  25% {
    transform: translateX(-4px);
  }
  75% {
    transform: translateX(4px);
  }
}

.scene-error-icon {
  font-size: 0.875rem;
}

.scene-error-text {
  font-size: var(--font-size-xs);
  color: var(--warning-color);
  text-transform: uppercase;
  letter-spacing: 1px;
}

/* reduced-motion: 로딩/에러 애니메이션 완화 */
@media (prefers-reduced-motion: reduce) {
  .scene-loading-indicator {
    animation: none;
  }

  .scene-loading-spinner {
    animation: none;
    border-color: var(--accent-color);
  }

  .scene-canvas.image-loading::before {
    animation: none;
    transform: none;
  }

  .scene-error-badge {
    animation: none;
  }

  .scene-canvas .scene-image {
    transition: none;
    opacity: 1;
  }

  .scene-canvas .scene-image.scene-image-loaded {
    opacity: 1;
  }
}

/* ============================================
   8.1 핫스팟 오버레이 (U-010)
   - RULE-009: 좌표 규약 (0~1000 정규화)
   - 클릭 가능한 오브젝트 영역 표시
   ============================================ */

/* 핫스팟 레이어 (장면 이미지 위 오버레이) */
.hotspot-layer {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 10;
}

/* 개별 핫스팟 오버레이 */
/* U-050: Option A - 면 최소화, 테두리/outline 중심 강조 */
.hotspot-overlay {
  position: absolute;
  pointer-events: auto;
  cursor: pointer;
  /* 면: 거의 투명 (콘텐츠 보호) */
  background-color: rgba(51, 255, 0, 0.02);
  /* 테두리: 대시 패턴으로 시각적 구분 + 존재감 */
  border: 1.5px dashed var(--text-color);
  border-radius: 2px;
  /* 글로우: 매우 얕고 좁게 (4px blur, 낮은 opacity) */
  box-shadow: 0 0 4px rgba(51, 255, 0, 0.15);
  transition:
    border-color 0.2s,
    border-style 0.2s,
    background-color 0.2s,
    box-shadow 0.2s;
}

/* 핫스팟 호버 효과 - U-050: 테두리 중심, 면 최소화 */
.hotspot-overlay.hovered {
  /* 면: 아주 미세한 틴트만 (덮임 방지) */
  background-color: rgba(255, 0, 255, 0.04);
  /* 테두리: solid로 전환 + 강조색 */
  border: 2px solid var(--accent-color);
  /* 글로우: 컴팩트하게 (6px blur) */
  box-shadow:
    0 0 6px rgba(255, 0, 255, 0.35),
    inset 0 0 2px rgba(255, 0, 255, 0.1);
  /* scale 제거 - 덮임 방지 */
  transform: none;
}

/* 핫스팟 포커스 효과 (접근성) */
.hotspot-overlay:focus {
  outline: 2px solid var(--accent-color);
  outline-offset: 2px;
}

/* 비활성화된 핫스팟 */
.hotspot-overlay.disabled {
  cursor: not-allowed;
  border-color: var(--text-dim);
  background-color: rgba(0, 0, 0, 0.3);
  box-shadow: none;
  opacity: 0.5;
}

.hotspot-overlay.disabled:hover {
  transform: none;
  border-color: var(--text-dim);
  background-color: rgba(0, 0, 0, 0.3);
}

/* ============================================
   8.2 핫스팟 드롭 타겟 상태 (U-012)
   - 드래그 오버 시 하이라이트 강화
   - 드롭 가능/불가 상태 시각화
   ============================================ */

/* 드롭 타겟 활성 상태 (아이템이 위에 있을 때) */
/* U-050: 면 최소화, 글로우 축소, 펄스 느리게 */
.hotspot-overlay.drop-target-active {
  /* 면: 미세한 경고 틴트 */
  background-color: rgba(255, 170, 0, 0.06);
  /* 테두리: 두껍게 + solid */
  border: 2.5px solid var(--warning-color);
  /* 글로우: 적당히 (8px blur) */
  box-shadow:
    0 0 8px rgba(255, 170, 0, 0.4),
    inset 0 0 3px rgba(255, 170, 0, 0.15);
  /* scale 축소 */
  transform: scale(1.01);
  /* 펄스: 느리게 (0.6s → 1.2s) */
  animation: drop-target-pulse 1.2s ease-in-out infinite;
}

/* 드롭 타겟 펄스 애니메이션 - U-050: 부드럽게 */
@keyframes drop-target-pulse {
  0%,
  100% {
    box-shadow:
      0 0 8px rgba(255, 170, 0, 0.4),
      inset 0 0 3px rgba(255, 170, 0, 0.15);
  }
  50% {
    box-shadow:
      0 0 12px rgba(255, 170, 0, 0.5),
      inset 0 0 4px rgba(255, 170, 0, 0.2);
  }
}

/* 드롭 힌트 스타일 (툴팁 내) */
.hotspot-tooltip-drop-hint {
  display: block;
  margin-top: 4px;
  font-size: var(--font-size-sm);
  font-weight: bold;
  color: var(--warning-color);
  text-transform: uppercase;
  letter-spacing: 1px;
  animation: drop-hint-blink 0.8s ease-in-out infinite;
}

@keyframes drop-hint-blink {
  0%,
  100% {
    opacity: 1;
  }
  50% {
    opacity: 0.6;
  }
}

/* 드롭 타겟 활성화 시 툴팁 테두리 변경 - U-050: 글로우 축소 */
.hotspot-overlay.drop-target-active .hotspot-tooltip {
  border-color: var(--warning-color);
  box-shadow:
    0 0 6px rgba(255, 170, 0, 0.3),
    0 2px 8px rgba(0, 0, 0, 0.7);
}

.hotspot-overlay.drop-target-active .hotspot-tooltip::after {
  border-top-color: var(--warning-color);
}

/* reduced-motion: 드롭 애니메이션 완화 */
@media (prefers-reduced-motion: reduce) {
  .hotspot-overlay.drop-target-active {
    animation: none;
    transform: none;
  }

  .hotspot-tooltip-drop-hint {
    animation: none;
  }
}

/* 핫스팟 툴팁 - U-050: 글로우 축소, 가독성 개선 */
.hotspot-tooltip {
  position: absolute;
  bottom: calc(100% + 8px);
  left: 50%;
  transform: translateX(-50%);
  min-width: 100px;
  max-width: 200px;
  padding: var(--spacing-xs) var(--spacing-sm);
  /* 배경: 약간 더 불투명하게 (가독성) */
  background-color: rgba(0, 15, 0, 0.92);
  border: 1px solid var(--accent-color);
  border-radius: 2px;
  /* 글로우: 축소 (10px → 5px) */
  box-shadow:
    0 0 5px rgba(255, 0, 255, 0.25),
    0 2px 8px rgba(0, 0, 0, 0.7);
  z-index: 20;
  white-space: nowrap;
  animation: tooltip-fade-in 0.15s ease-out;
}

@keyframes tooltip-fade-in {
  from {
    opacity: 0;
    transform: translateX(-50%) translateY(4px);
  }
  to {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
  }
}

/* 툴팁 화살표 (하단 가리키기) */
.hotspot-tooltip::after {
  content: '';
  position: absolute;
  top: 100%;
  left: 50%;
  transform: translateX(-50%);
  border: 6px solid transparent;
  border-top-color: var(--accent-color);
}

/* 툴팁 라벨 */
.hotspot-tooltip-label {
  display: block;
  font-size: var(--font-size-sm);
  font-weight: bold;
  color: var(--text-color);
  text-transform: uppercase;
  letter-spacing: 1px;
  text-shadow: 0 0 5px var(--text-dim);
}

/* 툴팁 힌트 */
.hotspot-tooltip-hint {
  display: block;
  margin-top: 2px;
  font-size: var(--font-size-xs);
  color: var(--text-dim);
}

/* 핫스팟 있을 때 Scene Canvas 조정 */
.scene-canvas.has-hotspots {
  /* 핫스팟 레이어를 위한 position 컨텍스트 확보 */
  position: relative;
}

/* 모바일에서 핫스팟 터치 영역 확대 - U-050: 툴팁 위치 조정 */
@media (max-width: 768px) {
  .hotspot-overlay {
    /* 터치 영역 최소 44px 보장 */
    min-width: 44px;
    min-height: 44px;
  }

  .hotspot-tooltip {
    /* 화면 상단 가림 방지: 아래로 표시 */
    bottom: auto;
    top: calc(100% + 6px);
    max-width: 140px;
    font-size: 0.8rem;
  }

  .hotspot-tooltip::after {
    /* 화살표 방향 반전 */
    top: auto;
    bottom: 100%;
    border-top-color: transparent;
    border-bottom-color: var(--accent-color);
  }

  .hotspot-overlay.drop-target-active .hotspot-tooltip::after {
    border-bottom-color: var(--warning-color);
  }
}

/* 태블릿 중간 크기 - U-050 */
@media (min-width: 769px) and (max-width: 1200px) {
  .hotspot-tooltip {
    max-width: 170px;
  }
}

/* 접근성: reduced-motion에서 애니메이션 완화 */
@media (prefers-reduced-motion: reduce) {
  .hotspot-overlay {
    transition: none;
  }

  .hotspot-overlay.hovered {
    transform: none;
  }

  .hotspot-tooltip {
    animation: none;
  }
}

/* 내러티브 피드 - RULE-002: 채팅 버블 아님, 게임 로그 형태 */
.narrative-feed {
  height: 180px;
  border: 1px solid var(--border-color);
  background-color: var(--panel-bg);
  box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.8);
  overflow-y: auto;
  overflow-x: hidden; /* U-049: 불필요한 가로 스크롤 방지 */
  scrollbar-width: thin; /* Firefox: 얇은 스크롤바 */
  padding: var(--spacing-sm);
}

.narrative-entry {
  padding: var(--spacing-xs) 0;
  border-bottom: 1px solid rgba(51, 255, 0, 0.2);
}

.narrative-entry:last-child {
  border-bottom: none;
}

.narrative-timestamp {
  color: var(--text-dim);
  font-size: 0.75rem;
  margin-right: var(--spacing-sm);
}

.narrative-text {
  color: var(--text-color);
}

/* ============================================
   9. Sidebar (Right) 영역
   - Agent Console, Memory Pin, Scanner Slot
   - U-049: 컬럼 전체 스크롤 제거, 패널 콘텐츠 단위 스크롤
   ============================================ */

.sidebar-right {
  grid-area: sidebar-right;
  display: flex;
  flex-direction: column;
  gap: var(--spacing-sm);
  min-height: 0; /* U-049: flex 자식 축소 허용 */
  overflow: hidden; /* U-049: 컬럼 전체 스크롤 제거 */
}

/* ============================================
   10. Footer 영역
   - Action Deck, Command Input
   ============================================ */

.game-footer {
  grid-area: footer;
  display: flex;
  flex-direction: column;
  /* U-050 v5: 카드와 입력창 사이 간격 축소 */
  gap: 2px;
  padding: var(--spacing-sm);
  border: 1px solid var(--border-color);
  background-color: var(--panel-bg);
  box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.5);
}

/* ============================================
   10.1 Action Deck (U-009: 게임 카드 UI)
   - RULE-002: 채팅 버튼이 아닌 게임 카드
   - RULE-005: 비용/위험/보상 표시
   ============================================ */

.action-deck {
  display: flex;
  /* U-050 v5: 카드가 콘텐츠 높이에 맞게 조절되도록 (stretch 대신) */
  align-items: flex-start;
  gap: var(--spacing-sm);
  /* U-050 v6: 카드 높이 축소에 맞춰 min-height 감소 */
  min-height: 85px;
  padding: var(--spacing-xs) 0 0;
  /* U-049: 드래그 스크롤 - 스크롤바 숨김 */
  overflow-x: auto;
  overflow-y: visible;
  scrollbar-width: none; /* Firefox */
  -ms-overflow-style: none; /* IE/Edge */
  /* 터치 디바이스 부드러운 스크롤 */
  -webkit-overflow-scrolling: touch;
  scroll-behavior: smooth;
  /* 드래그 스크롤을 위한 커서 */
  cursor: grab;
  /* 카드 스냅 */
  scroll-snap-type: x mandatory;
  scroll-padding: 0 var(--spacing-sm);
}

.action-deck::-webkit-scrollbar {
  display: none; /* Chrome/Safari */
}

.action-deck:active,
.action-deck.is-dragging {
  cursor: grabbing;
  user-select: none; /* 드래그 중 텍스트 선택 방지 */
}

/* U-049: 터치 디바이스 최적화 (Web Interface Guidelines) */
.action-deck {
  touch-action: pan-x; /* 수평 스크롤만 허용 */
  -webkit-tap-highlight-color: transparent;
}

.action-deck .action-card {
  scroll-snap-align: start;
  flex-shrink: 0; /* 카드 축소 방지 */
}

/* 카드 기본 스타일 - 게임 카드처럼 보이게 */
.action-card {
  position: relative;
  min-width: 160px;
  max-width: 200px;
  /* U-050 v6: padding 축소 - 컴팩트한 카드 */
  padding: var(--spacing-xs) var(--spacing-sm) var(--spacing-sm);
  border: 2px solid var(--border-color);
  border-radius: var(--border-radius);
  /* U-049: 배경 대비 강화 - 더 불투명한 배경 */
  background: linear-gradient(180deg, rgba(0, 20, 0, 0.98) 0%, rgba(0, 10, 0, 0.99) 100%);
  /* U-049: 내부 그림자로 깊이감 추가 */
  box-shadow:
    inset 0 0 20px rgba(0, 0, 0, 0.6),
    inset 0 1px 0 rgba(51, 255, 0, 0.1);
  cursor: pointer;
  transition:
    border-color 0.2s,
    box-shadow 0.2s,
    transform 0.15s;
  display: flex;
  flex-direction: column;
  gap: 2px;
}

/* 위험도별 테두리 색상 */
.action-card.risk-border-low {
  border-color: var(--text-color);
}

.action-card.risk-border-medium {
  border-color: var(--warning-color);
}

.action-card.risk-border-high {
  border-color: var(--error-color);
}

/* 호버 효과 - 카드가 살짝 올라오는 느낌 */
.action-card:hover:not(:disabled) {
  border-color: var(--accent-color);
  box-shadow:
    0 0 15px var(--accent-color),
    0 4px 20px rgba(0, 0, 0, 0.5);
  transform: translateY(-4px);
}

/* 카드 타이틀 - U-050 v6: 컴팩트 카드에 맞춰 크기 축소 */
.action-card-title {
  font-size: 0.85rem;
  font-weight: bold;
  color: var(--text-color);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  /* U-049: 강한 텍스트 그림자로 배경과 분리 */
  text-shadow:
    0 0 10px var(--text-color),
    0 0 20px rgba(51, 255, 0, 0.5),
    0 2px 4px rgba(0, 0, 0, 0.9);
  padding-bottom: 2px;
  border-bottom: 1px solid var(--text-dim);
}

/* 카드 설명 - U-050 v6: 컴팩트 카드에 맞춰 축소 */
.action-card-description {
  font-size: 0.7rem;
  color: var(--text-dim);
  line-height: 1.2;
  min-height: 1.5em;
}

/* 비용 표시 영역 - U-050 v6: 컴팩트 너비, 가운데 정렬 */
.action-card-cost {
  display: flex;
  align-items: center;
  justify-content: center;
  flex-wrap: wrap;
  gap: 4px;
  font-size: 0.65rem;
  color: var(--warning-color);
  padding: 2px var(--spacing-xs);
  /* U-050 v6: 컨텐츠에 맞는 너비 + 카드 내 가운데 배치 */
  width: fit-content;
  margin: 0 auto;
  /* U-049: 더 강한 배경 대비 */
  background: linear-gradient(180deg, rgba(0, 0, 0, 0.7) 0%, rgba(0, 0, 0, 0.85) 100%);
  border: 1px solid rgba(51, 255, 0, 0.2);
  border-radius: 2px;
  /* U-049: 텍스트 그림자 */
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.9);
}

.action-card-cost .cost-item {
  display: inline-flex;
  align-items: center;
  gap: 2px;
}

.action-card-cost .cost-separator {
  color: var(--text-dim);
  margin: 0 2px;
}

.action-card-cost .cost-value {
  font-weight: bold;
  font-family: var(--font-micro-en);
}

/* 위험도 라벨 색상 */
.action-card-cost .risk-label {
  text-transform: uppercase;
  font-size: 0.625rem;
  font-weight: bold;
}

.action-card-cost .risk-label.risk-low {
  color: var(--text-color);
}

.action-card-cost .risk-label.risk-medium {
  color: var(--warning-color);
}

.action-card-cost .risk-label.risk-high {
  color: var(--error-color);
}

/* 힌트 영역 (위험/보상) */
.action-card-hints {
  display: flex;
  flex-direction: column;
  gap: 2px;
  font-size: 0.625rem;
  padding-top: var(--spacing-xs);
  border-top: 1px dashed var(--text-dim);
}

.action-card-hints .hint-item {
  display: flex;
  align-items: flex-start;
  gap: 4px;
}

.action-card-hints .hint-icon {
  flex-shrink: 0;
}

.action-card-hints .hint-risk {
  color: var(--warning-color);
}

.action-card-hints .hint-reward {
  color: var(--accent-color);
}

.action-card-hints .hint-text {
  color: var(--text-dim);
  line-height: 1.2;
}

/* 대안 카드 배지 */
.action-card .alternative-badge {
  position: absolute;
  top: -8px;
  right: 8px;
  padding: 2px 6px;
  font-size: 0.5rem;
  font-weight: bold;
  text-transform: uppercase;
  letter-spacing: 1px;
  background-color: var(--text-color);
  color: var(--bg-color);
  border-radius: 2px;
}

/* 대안 카드 스타일 */
.action-card.card-alternative {
  border-style: dashed;
  opacity: 0.85;
  min-width: 140px;
}

.action-card.card-alternative:hover:not(:disabled) {
  opacity: 1;
}

/* 비활성화된 카드 */
.action-card.card-disabled,
.action-card:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  border-color: var(--text-dim);
  transform: none;
}

.action-card.card-disabled:hover,
.action-card:disabled:hover {
  border-color: var(--text-dim);
  box-shadow: none;
  transform: none;
}

/* 비활성화 오버레이 */
.action-card .card-disabled-overlay {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: rgba(0, 0, 0, 0.7);
  border-radius: var(--border-radius);
}

.action-card .card-disabled-overlay .disabled-reason {
  padding: var(--spacing-xs) var(--spacing-sm);
  font-size: 0.625rem;
  font-weight: bold;
  text-transform: uppercase;
  letter-spacing: 1px;
  color: var(--error-color);
  background-color: rgba(0, 0, 0, 0.8);
  border: 1px solid var(--error-color);
  text-shadow: 0 0 5px var(--error-color);
}

/* 모든 카드 비활성화 안내 */
.action-deck .deck-empty-notice {
  display: flex;
  align-items: center;
  justify-content: center;
  min-width: 200px;
  padding: var(--spacing-md);
  color: var(--warning-color);
  font-size: 0.75rem;
  text-align: center;
  border: 1px dashed var(--warning-color);
  background-color: rgba(255, 170, 0, 0.1);
}

.command-input-area {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  padding: var(--spacing-xs);
  border: 1px solid var(--text-dim);
  background-color: rgba(0, 0, 0, 0.5);
}

.command-prompt {
  color: var(--text-color);
  font-size: var(--font-size-lg);
}

.command-input {
  flex: 1;
  background: transparent;
  border: none;
  color: var(--text-color);
  font-family: var(--font-main);
  font-size: var(--font-size-lg);
  outline: none;
  text-shadow: 0 0 5px var(--text-dim);
}

.command-input::placeholder {
  color: var(--text-dim);
}

/* ============================================
   11. 공통 패널 스타일
   - U-049: flex 스크롤 전략 정리 (min-height: 0 핵심)
   ============================================ */

.panel {
  border: 1px solid var(--border-color);
  background-color: var(--panel-bg);
  box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.8);
  display: flex;
  flex-direction: column;
  min-height: 0; /* U-049: flex item 축소 허용 (필수) */
  overflow: hidden; /* U-049: 패널 자체 스크롤 방지 */
}

.panel-header {
  padding: var(--spacing-xs) var(--spacing-sm);
  border-bottom: 1px solid var(--text-dim);
  background-color: rgba(0, 0, 0, 0.3);
  display: flex;
  align-items: center;
  justify-content: space-between;
  flex-shrink: 0; /* U-049: 헤더는 축소하지 않음 */
}

.panel-title {
  font-size: 0.875rem;
  text-transform: uppercase;
  letter-spacing: 2px;
  color: var(--text-color);
}

.panel-content {
  flex: 1;
  padding: var(--spacing-sm);
  overflow-y: auto;
  overflow-x: hidden; /* U-049: 우측 패널 등 가로 스크롤 방지 */
  scrollbar-width: thin; /* Firefox: 얇은 스크롤바 */
  min-height: 0; /* U-049: flex 자식 축소 허용 (필수) */
}

.panel-placeholder {
  color: var(--text-dim);
  font-size: 0.875rem;
  text-align: center;
  padding: var(--spacing-md);
}

/* ===========================================
   11.1 사이드바 패널별 높이 전략 (U-049)
   - Q1 Option A: Agent Console만 flex-1 (유연 높이)
   - Economy/Scanner는 콘텐츠에 맞춰 축소
   =========================================== */

/* Agent Console: 유연 확장 (Q1 Option A) */
.panel-agent-console {
  /* flex-1은 className으로 받음 - 별도 설정 불필요 */
}

/* Economy HUD: 콘텐츠 기반 높이, 최대 제한 */
.panel-economy {
  flex-shrink: 0; /* 다른 패널에 밀려 축소되지 않음 */
  max-height: 280px; /* U-049: 과도한 확장 방지 */
}

.panel-economy .panel-content {
  display: flex;
  flex-direction: column;
  min-height: 0; /* U-049: flex 자식 축소 허용 */
}

/* Scanner Slot: 콘텐츠 기반 높이 */
.panel-scanner {
  flex-shrink: 0; /* 다른 패널에 밀려 축소되지 않음 */
}

/* ============================================
   12. 버튼 스타일
   ============================================ */

button,
.btn {
  background: var(--text-color);
  color: var(--bg-color);
  border: none;
  padding: var(--spacing-xs) var(--spacing-sm);
  font-family: var(--font-main);
  font-size: var(--font-size-lg);
  cursor: pointer;
  text-transform: uppercase;
  font-weight: bold;
  transition:
    background 0.2s,
    color 0.2s;
}

/* U-050 v3: 버튼 호버 - 아이콘 식별성 + 테두리 끊김 방지 */
button:hover,
.btn:hover {
  /* 면: 약한 틴트로 변경 (아이콘 덮임 방지) */
  background: rgba(255, 0, 255, 0.15);
  color: var(--accent-color);
  /* box-shadow로 테두리 효과 (outline 끊김 방지) */
  box-shadow:
    inset 0 0 0 2px var(--accent-color),
    0 0 8px rgba(255, 0, 255, 0.4);
}

button:disabled,
.btn:disabled {
  background: var(--text-dim);
  cursor: not-allowed;
}

/* ============================================
   13. 스크롤바 커스터마이징 (U-049: 다크 테마 강제)
   ============================================ */

/* 전역 웹킷 스크롤바 (Chrome, Safari, Edge) */
::-webkit-scrollbar {
  width: 6px;
  height: 6px;
}

::-webkit-scrollbar-track {
  background: var(--bg-color);
}

::-webkit-scrollbar-thumb {
  background: rgba(51, 255, 0, 0.25); /* 튀지 않는 어두운 녹색 */
  border: 1px solid rgba(51, 255, 0, 0.4);
  border-radius: 10px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(51, 255, 0, 0.5);
}

/* 스크롤바 화살표 제거 */
::-webkit-scrollbar-button {
  display: none;
  width: 0;
  height: 0;
}

/* 코너(가로/세로 스크롤 만나는 지점) */
::-webkit-scrollbar-corner {
  background: var(--bg-color);
}

/* ============================================
   14. 반응형 디자인
   ============================================ */

@media (max-width: 1200px) {
  .game-container {
    grid-template-areas:
      'header header'
      'center sidebar-right'
      'footer footer';
    grid-template-columns: 1fr var(--sidebar-width);
  }

  .sidebar-left {
    display: none;
  }
}

@media (max-width: 768px) {
  :root {
    font-size: 14px;
    --header-height: 50px;
    --footer-height: 100px;
    --sidebar-width: 100%;
  }

  .game-container {
    grid-template-areas:
      'header'
      'center'
      'footer';
    grid-template-columns: 1fr;
    grid-template-rows: var(--header-height) 1fr var(--footer-height);
    padding: var(--spacing-xs);
    gap: var(--spacing-xs);
  }

  .sidebar-left,
  .sidebar-right {
    display: none;
  }

  .game-header {
    padding: 0 var(--spacing-sm);
  }

  .game-title {
    font-size: var(--font-size-lg);
    letter-spacing: 2px;
  }

  .economy-hud {
    display: none;
  }

  .action-deck {
    flex-wrap: nowrap;
    overflow-x: auto;
  }

  .action-card {
    min-width: 120px;
  }
}

/* ============================================
   15. 유틸리티 클래스
   ============================================ */

.text-dim {
  color: var(--text-dim);
}

.text-accent {
  color: var(--accent-color);
}

.text-warning {
  color: var(--warning-color);
}

.text-error {
  color: var(--error-color);
}

.text-glow {
  text-shadow: 0 0 10px var(--text-color);
}

.visually-hidden {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

/* ============================================
   16. Agent Console 스타일 (U-008)
   - RULE-008: 단계/배지/복구 표시
   ============================================ */

.agent-console-content {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-sm);
  font-size: 0.75rem;
}

/* 스트리밍 상태 */
.streaming-status {
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
  padding: var(--spacing-xs);
  border-bottom: 1px solid var(--text-dim);
}

.streaming-status .status-dot {
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background-color: var(--text-dim);
  transition: background-color 0.3s;
}

.streaming-status .status-dot.active {
  background-color: var(--accent-color);
  box-shadow: 0 0 8px var(--accent-color);
  animation: pulse 1s infinite;
}

.streaming-status .status-text {
  text-transform: uppercase;
  letter-spacing: 1px;
  color: var(--text-dim);
}

.streaming-status .status-dot.active + .status-text {
  color: var(--accent-color);
}

/* 단계 큐 */
.phase-queue {
  padding: var(--spacing-xs);
}

.phase-queue .queue-label,
.badges-panel .badges-label,
.repair-trace .repair-label {
  font-size: 0.75rem; /* 12px로 상향 */
  text-transform: uppercase;
  letter-spacing: 2px;
  color: #33ff00; /* 순수 인광 녹색으로 고정 */
  opacity: 1; /* 투명도 제거하여 최대 밝기 */
  margin-bottom: var(--spacing-sm);
  font-weight: 600; /* 더 굵게 */
  text-shadow: 0 0 5px rgba(51, 255, 0, 0.4); /* 미세 글로우로 강조 */
}

.badges-panel .badges-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 6px; /* 간격 상향 */
  width: 100%;
}

.phase-queue .queue-items {
  display: grid;
  grid-template-columns: repeat(4, 1fr); /* 4열 배치 강제 */
  gap: 6px;
  width: 100%;
}

/* U-037: Phase Item 식별성 극대화 */
.phase-item {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 4px;
  padding: 6px 2px;
  background-color: rgba(0, 20, 0, 0.95); /* 배경 더 어둡게 */
  border: 1px solid var(--text-dim);
  border-radius: 2px;
  font-family: var(--font-micro-en);
  font-size: 0.8125rem; /* 13px로 상향 */
  font-weight: 600; /* 더 굵게 */
  letter-spacing: 0.02em;
  box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.8);
}

/* 텍스트 선명도 및 글로우 최적화 (번짐 방지) */
.phase-item > * {
  position: relative;
  z-index: 2;
  text-shadow: none !important; /* 번짐 방지를 위해 그림자 제거 */
  filter: drop-shadow(0 0 1px rgba(51, 255, 0, 0.3)); /* 미세 테두리 */
  opacity: 1 !important;
}

/* 상태별 색상 대비 상향 */
.phase-item.pending {
  color: #88ff88 !important; /* 더 밝은 녹색 */
  border-color: rgba(51, 255, 0, 0.4);
}

.phase-item.in_progress,
.phase-item.in-progress {
  color: #ff00ff !important;
  border-color: #ff00ff;
  background-color: rgba(30, 0, 30, 0.95);
  box-shadow: 0 0 8px rgba(255, 0, 255, 0.4);
}

/* 씬 플레이스홀더 서브 메시지 가독성 (Critical) */
.scene-status-message {
  color: var(--text-color) !important;
  opacity: 1 !important;
  text-shadow: 0 1px 3px rgba(0, 0, 0, 1) !important;
  font-size: 0.9375rem !important; /* 15px로 상향 */
  font-weight: 500 !important;
  margin-top: var(--spacing-sm);
  z-index: 10;
  position: relative;
}

/* 씬 플레이스홀더 서브 메시지 보호 */
.scene-placeholder .status-sub {
  color: var(--text-color);
  opacity: 0.9;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 1);
  font-size: var(--font-size-sm);
}

/* Scene Canvas는 여전히 강력한 CRT 분위기 유지 (Q2: Option A) */
.scene-canvas::after {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.3) 50%);
  background-size: 100% 4px;
  pointer-events: none;
  z-index: 5;
  animation: flicker 0.15s infinite;
}

/* Economy HUD 및 기타 Critical 텍스트 보호 */
.currency-value,
.action-card-cost {
  position: relative;
  z-index: 2;
  font-family: var(--font-micro-en);
  text-shadow: 0 0 2px rgba(51, 255, 0, 0.3);
}

/* U-037: pending 상태 - 밝은 색상 + 배경 대비 */
.phase-item.pending {
  color: var(--text-color);
  background-color: rgba(0, 20, 0, 0.5);
  border-color: rgba(51, 255, 0, 0.3);
  opacity: 0.8;
}

.phase-item.in_progress,
.phase-item.in-progress {
  color: var(--accent-color);
  background-color: rgba(40, 0, 40, 0.5);
  border-color: var(--accent-color);
  box-shadow: 0 0 5px var(--accent-color);
  animation: pulse 1s infinite;
}

.phase-item.completed {
  color: var(--text-color);
  background-color: rgba(0, 30, 0, 0.5);
  border-color: var(--text-color);
}

.phase-item.failed {
  color: var(--error-color);
  background-color: rgba(40, 0, 0, 0.5);
  border-color: var(--error-color);
}

.phase-icon {
  font-size: 0.5rem;
}

.phase-icon.in-progress {
  animation: spin 2s linear infinite;
}

@keyframes spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

.phase-label {
  white-space: nowrap;
}

/* 배지 패널 */
.badges-panel {
  padding: var(--spacing-xs);
  border-top: 1px solid var(--text-dim);
}

.badges-panel .badges-label {
  font-size: 0.625rem;
  text-transform: uppercase;
  letter-spacing: 1px;
  color: var(--text-dim);
  margin-bottom: var(--spacing-xs);
}

.badges-panel .badges-empty {
  color: var(--text-color);
  font-size: 0.8125rem; /* 13px로 상향 */
  font-weight: 500;
  text-align: center;
  padding: var(--spacing-sm);
  opacity: 0.9;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 1);
  position: relative;
  z-index: 2;
}

/* 배지 그리드 가독성 상향 (U-037) */
.badge-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 4px 6px;
  background-color: rgba(0, 20, 0, 0.9);
  border: 1px solid var(--text-dim);
  font-family: var(--font-micro-en);
  font-size: 0.75rem;
  z-index: 2;
  position: relative;
}

.badge-label {
  color: var(--text-color);
  opacity: 0.8;
}

.badge-status {
  font-weight: bold;
  text-transform: uppercase;
}

/* Auto-repair 트레이스 */
.repair-trace {
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
  padding: var(--spacing-xs);
  border-top: 1px solid var(--text-dim);
  font-size: 0.625rem;
}

.repair-trace .repair-label {
  color: var(--text-dim);
}

.repair-trace .repair-count {
  color: var(--warning-color);
  font-weight: bold;
}

.repair-trace .repair-status {
  color: var(--warning-color);
  font-size: 0.5rem;
}

/* 에러 표시 */
.agent-error {
  display: flex;
  align-items: flex-start;
  gap: var(--spacing-xs);
  padding: var(--spacing-xs);
  background-color: rgba(255, 51, 51, 0.1);
  border: 1px solid var(--error-color);
  font-size: 0.625rem;
}

.agent-error .error-icon {
  color: var(--error-color);
}

.agent-error .error-message {
  color: var(--error-color);
  flex: 1;
  word-break: break-word;
}

.agent-error .error-code {
  color: var(--text-dim);
  font-size: 0.5rem;
}

/* ============================================
   17. 내러티브 스트리밍 효과
   ============================================ */

.narrative-entry.streaming {
  opacity: 0.8;
}

.cursor-blink {
  animation: blink 1s infinite;
  color: var(--accent-color);
}

@keyframes blink {
  0%,
  50% {
    opacity: 1;
  }
  51%,
  100% {
    opacity: 0;
  }
}

/* ============================================
   18. 액션 카드 비활성화 상태
   ============================================ */

.action-card:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  border-color: var(--text-dim);
}

.action-card:disabled:hover {
  border-color: var(--text-dim);
  box-shadow: none;
}

/* ============================================
   19. Economy HUD 아이콘 (U-029: nanobanana 에셋)
   ============================================ */

.economy-hud .shard-icon {
  margin-left: var(--spacing-sm);
}

/* 에셋 아이콘 래퍼 - 폴백 패턴 (U-029/U-030) */
.icon-wrapper {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  position: relative;
}

.icon-wrapper .icon-img {
  width: 20px;
  height: 20px;
  object-fit: contain;
  /* (U-029) 흰 배경 아이콘인 경우 screen/lighten 등으로 조절 가능하지만 rembg 완료됨 */
  display: block;
}

.icon-wrapper .icon-img.hidden {
  display: none;
}

/* 폴백 텍스트는 기본 숨김, 이미지 로드 실패 시 표시 */
.icon-wrapper .icon-fallback {
  display: none;
  font-size: 1rem;
}

/* 이미지 숨김 시 폴백 표시 */
.icon-wrapper .icon-img.hidden + .icon-fallback {
  display: inline;
}

/* Risk 등급별 아이콘 필터링 (필요 시) */
.icon-img.risk-low {
  filter: drop-shadow(0 0 2px var(--text-color));
}

.icon-img.risk-high {
  filter: drop-shadow(0 0 2px var(--error-color));
}

/* 배지 아이콘 (Agent Console) */
.badge-icon-img {
  width: 14px;
  height: 14px;
  object-fit: contain;
  vertical-align: middle;
  margin-right: 2px;
}

/* ============================================
   20. Flex 유틸리티
   ============================================ */

.flex-1 {
  flex: 1;
}

/* ============================================
   21. 중요도 기반 레이어링 (U-037: critical/ambient)
   - critical: 어두운 배경/패널 내부의 작은 텍스트 (마이크로 텍스트)
   - ambient: 분위기/장식, 로고/타이틀/패널 헤더 (기본 스타일)
   - Scene Canvas 중심으로 CRT 분위기 집중 (Q2: Option A)
   ============================================ */

/*
 * Critical 영역 기준 (U-037 재정의):
 * - 박스/패널 내부 콘텐츠 (어두운 배경 위 텍스트)
 * - 마이크로 텍스트 (0.75rem 이하: 배지, 비용, 타임스탬프 등)
 * - 배경색이 다양할 수 있는 영역 (에러 박스 등)
 *
 * Non-Critical (기본 스타일):
 * - 로고/타이틀 (UNKNOWN WORLD) - 충분히 크고 밝음
 * - 패널 헤더/라벨 (INVENTORY, QUEST 등) - 밝은 배경
 * - 액션 카드 제목 (탐색하기 등) - 충분히 큰 폰트
 */

/* Critical 영역: 패널 내부 작은 텍스트 가독성 보장 */
[data-ui-importance='critical'],
.ui-critical {
  /* 텍스트 대비 강화 - 어두운 배경에서 읽힘 보장 */
  color: var(--text-color);
  text-shadow:
    0 0 2px var(--text-color),
    0 1px 1px rgba(0, 0, 0, 0.9);
}

/* Critical 영역 내 보조 텍스트(dim)도 가독성 보장 */
[data-ui-importance='critical'] .text-dim,
.ui-critical .text-dim {
  color: var(--text-dim);
  text-shadow: 0 1px 1px rgba(0, 0, 0, 0.9);
}

/* Ambient 영역: CRT 분위기 허용 (기본값) */
[data-ui-importance='ambient'],
.ui-ambient {
  /* 기본 CRT 스타일 유지 - 로고/타이틀/패널 헤더 */
}

/* ============================================
   21.1 마이크로 텍스트 Critical 적용 (작은 폰트)
   - 0.75rem 이하 텍스트는 자동 Critical
   ============================================ */

/* Action Card 비용/위험 정보 (작은 텍스트, 어두운 카드 배경) */
.action-card-cost {
  text-shadow:
    0 0 2px currentColor,
    0 1px 1px rgba(0, 0, 0, 0.9);
}

/* 에러/차단 메시지 (배경색 다양, 중요 정보) */
.agent-error {
  text-shadow:
    0 0 2px var(--error-color),
    0 1px 1px rgba(0, 0, 0, 0.9);
}

/* 배지 상태 텍스트 (작은 폰트, 패널 내부) */
.badge-status {
  text-shadow: 0 0 1px currentColor;
}

/* 내러티브 타임스탬프 (작은 폰트) */
.narrative-timestamp {
  text-shadow: 0 1px 1px rgba(0, 0, 0, 0.8);
}

/* 복구 트레이스 (작은 폰트, 경고 정보) */
.repair-trace .repair-count {
  text-shadow: 0 0 2px var(--warning-color);
}

/* ============================================
   21.1 Scene Canvas 중심 CRT 분위기 (Q2: Option A)
   - 전역 오버레이 대신 Scene Canvas에 효과 집중
   ============================================ */

/* 전역 CRT 오버레이: 강도 약화 (critical 영역 보호) - U-050: 0.3 → 0.25 */
.crt-overlay {
  opacity: 0.25;
}

/* Scene Canvas: CRT 분위기 강화 (ambient 영역) */
.scene-canvas {
  position: relative;
}

/* U-050 v5: Scene Canvas CRT 효과 - 스캔라인 강조, 깜빡임 완화 */
.scene-canvas::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  /* 스캔라인: 적당히 */
  background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.4) 50%);
  background-size: 100% 2px;
  pointer-events: none;
  z-index: 1;
  /* 플리커: 느리게 */
  animation: flicker 0.5s infinite;
  opacity: 0.8;
}

/* Scene Canvas placeholder는 분위기 유지하면서 텍스트 읽힘 보장 */
.scene-placeholder {
  position: relative;
  z-index: 2;
}

/* ============================================
   22. 마이크로 텍스트 가독성 상향 (U-028→U-037)
   - 0.625rem → --font-size-xs (0.75rem)
   - Critical 영역은 자동 가독성 보장
   ============================================ */

/* Agent Console 기본 폰트 상향 */
.agent-console-content {
  font-size: var(--font-size-xs);
}

/* 큐 라벨 폰트 상향 */
.phase-queue .queue-label {
  font-size: calc(var(--font-size-xs) * 0.85);
}

/* 단계 아이템 폰트 상향 */
.phase-item {
  font-size: calc(var(--font-size-xs) * 0.85);
}

/* 배지 패널 라벨 상향 */
.badges-panel .badges-label {
  font-size: calc(var(--font-size-xs) * 0.85);
}

.badges-panel .badges-empty {
  font-size: calc(var(--font-size-xs) * 0.85);
}

/* 배지 아이템 상향 */
.badge-item {
  font-size: calc(var(--font-size-xs) * 0.85);
}

/* 복구 트레이스 상향 */
.repair-trace {
  font-size: calc(var(--font-size-xs) * 0.85);
}

.repair-trace .repair-status {
  font-size: calc(var(--font-size-xs) * 0.7);
}

/* 에러 표시 상향 */
.agent-error {
  font-size: calc(var(--font-size-xs) * 0.85);
}

.agent-error .error-code {
  font-size: calc(var(--font-size-xs) * 0.7);
}

/* 내러티브 타임스탬프 상향 */
.narrative-timestamp {
  font-size: var(--font-size-xs);
}

/* 단계 아이콘 상향 */
.phase-icon {
  font-size: calc(var(--font-size-xs) * 0.7);
}

/* ============================================
   22.1 접근성 가드 (U-037: prefers-reduced-motion)
   - 광과민/피로 방지를 위한 자동 완화
   ============================================ */

@media (prefers-reduced-motion: reduce) {
  /* 플리커 애니메이션 비활성화 - U-050: opacity 더 낮춤 */
  .crt-overlay {
    animation: none;
    opacity: 0.12;
  }

  .scene-canvas::after {
    animation: none;
    opacity: 0.2;
  }

  /* 글리치 효과 비활성화 */
  .glitch::before,
  .glitch::after {
    animation: none;
    opacity: 0;
  }

  /* 펄스 애니메이션 비활성화 */
  .status-indicator {
    animation: none;
  }

  .streaming-status .status-dot.active {
    animation: none;
  }

  .phase-item.in_progress,
  .phase-item.in-progress {
    animation: none;
  }

  /* 로딩 펄스 비활성화 */
  .scene-canvas.scene-status-loading .scene-placeholder {
    animation: none;
  }

  /* 스태틱 노이즈 비활성화 */
  .scene-canvas.scene-status-offline::before {
    animation: none;
    opacity: 0.2;
  }

  /* 커서 깜빡임 정적 표시 */
  .cursor-blink {
    animation: none;
    opacity: 1;
  }

  /* 스핀 애니메이션 비활성화 */
  .phase-icon.in-progress {
    animation: none;
  }
}

/* ============================================
   22.2 고대비 모드 지원 (prefers-contrast)
   ============================================ */

@media (prefers-contrast: more) {
  /* Critical 텍스트 대비 추가 상향 */
  [data-ui-importance='critical'],
  .ui-critical,
  .economy-hud,
  .action-card-title,
  .action-card-cost {
    text-shadow:
      0 0 4px var(--text-color),
      0 2px 2px rgba(0, 0, 0, 1);
  }

  /* 배경 대비 강화 */
  .panel-content,
  .narrative-feed {
    background-color: rgba(0, 0, 0, 0.9);
  }

  /* 테두리 대비 강화 */
  .panel,
  .action-card {
    border-width: 2px;
  }
}

/* ============================================
   22.3 Economy HUD 스타일 (U-014)
   - RULE-005: 예상 비용/확정 비용/잔액 부족 표시
   ============================================ */

/* Economy HUD 컨테이너 */
.economy-hud {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  padding: var(--spacing-xs) var(--spacing-sm);
  border: 1px solid var(--text-dim);
  background-color: rgba(0, 0, 0, 0.5);
}

.economy-hud-full {
  flex-direction: column;
  align-items: stretch;
  padding: var(--spacing-sm);
  gap: var(--spacing-sm);
  min-height: 0; /* U-049: flex 자식 축소 허용 */
  flex: 1; /* U-049: panel-content 내에서 확장 */
}

/* 잔액 부족 시 경고 스타일 */
.economy-hud.economy-hud-low,
.economy-hud-low {
  border-color: var(--warning-color);
  background-color: rgba(255, 170, 0, 0.1);
}

/* 잔액 표시 */
.economy-balance {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  flex-wrap: wrap;
}

.economy-balance.balance-low {
  animation: balance-warning-pulse 1.5s ease-in-out infinite;
}

@keyframes balance-warning-pulse {
  0%,
  100% {
    opacity: 1;
  }
  50% {
    opacity: 0.7;
  }
}

.balance-item {
  display: flex;
  align-items: center;
  gap: 4px;
}

.balance-value {
  font-family: var(--font-micro-en);
  font-weight: bold;
  font-size: var(--font-size-sm);
}

.balance-label {
  font-size: var(--font-size-xs);
  color: var(--text-dim);
  text-transform: uppercase;
  letter-spacing: 1px;
}

/* 잔액 부족 경고 */
.balance-warning {
  display: flex;
  align-items: center;
  gap: 4px;
  margin-left: var(--spacing-xs);
  padding: 2px 6px;
  background-color: rgba(255, 170, 0, 0.2);
  border: 1px solid var(--warning-color);
  border-radius: 2px;
}

.balance-warning .warning-icon {
  color: var(--warning-color);
}

.balance-warning .warning-text {
  font-size: var(--font-size-xs);
  color: var(--warning-color);
  text-transform: uppercase;
  letter-spacing: 1px;
}

.balance-warning-icon {
  color: var(--warning-color);
  margin-left: var(--spacing-xs);
  animation: blink 1s infinite;
}

/* 비용 표시 */
.economy-cost {
  padding: var(--spacing-xs);
  background-color: rgba(0, 20, 0, 0.8);
  border: 1px solid var(--text-dim);
  border-radius: 2px;
}

.economy-cost.cost-estimate {
  border-color: var(--accent-color);
  border-style: dashed;
}

.economy-cost.cost-confirmed {
  border-color: var(--text-color);
}

.economy-cost.cost-unaffordable {
  border-color: var(--error-color);
  background-color: rgba(255, 51, 51, 0.1);
}

.cost-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: var(--spacing-xs);
}

.cost-title {
  font-size: var(--font-size-xs);
  color: var(--text-dim);
  text-transform: uppercase;
  letter-spacing: 1px;
}

.cost-label {
  font-size: 0.625rem;
  color: var(--accent-color);
  padding: 1px 4px;
  background-color: rgba(255, 0, 255, 0.1);
  border: 1px solid var(--accent-color);
  border-radius: 2px;
}

.cost-values {
  display: flex;
  align-items: center;
  gap: 4px;
  flex-wrap: wrap;
}

.cost-item {
  display: inline-flex;
  align-items: center;
  gap: 2px;
}

.cost-separator {
  color: var(--text-dim);
  margin: 0 2px;
}

.cost-value {
  font-family: var(--font-micro-en);
  font-weight: bold;
  font-size: var(--font-size-sm);
  color: var(--warning-color);
}

.cost-warning {
  margin-top: var(--spacing-xs);
  padding: 2px 4px;
  background-color: rgba(255, 51, 51, 0.2);
  border-radius: 2px;
}

.cost-warning .warning-text {
  font-size: var(--font-size-xs);
  color: var(--error-color);
  text-transform: uppercase;
  letter-spacing: 1px;
}

/* 예상 비용 미니 표시 (헤더용) */
.economy-estimate-mini {
  display: inline-flex;
  align-items: center;
  gap: 2px;
  margin-left: var(--spacing-xs);
  padding: 1px 6px;
  background-color: rgba(255, 0, 255, 0.1);
  border: 1px dashed var(--accent-color);
  border-radius: 2px;
  font-family: var(--font-micro-en);
  font-size: var(--font-size-xs);
  color: var(--accent-color);
}

.economy-estimate-mini.unaffordable {
  border-color: var(--error-color);
  background-color: rgba(255, 51, 51, 0.1);
  color: var(--error-color);
}

.estimate-prefix {
  opacity: 0.7;
}

.estimate-value {
  font-weight: bold;
}

/* 대안 안내 */
.economy-alternatives {
  padding: var(--spacing-sm);
  background-color: rgba(51, 255, 0, 0.05);
  border: 1px dashed var(--text-color);
  border-radius: 2px;
}

.alternatives-header {
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
  margin-bottom: var(--spacing-xs);
}

.alternatives-icon {
  font-size: 1rem;
}

.alternatives-title {
  font-size: var(--font-size-xs);
  color: var(--text-color);
  text-transform: uppercase;
  letter-spacing: 1px;
}

.alternatives-list {
  list-style: none;
  padding-left: calc(1rem + var(--spacing-xs));
}

.alternatives-list li {
  font-size: var(--font-size-xs);
  color: var(--text-dim);
  line-height: 1.5;
}

.alternatives-list li::before {
  content: '• ';
  color: var(--text-color);
}

/* ===========================================
   22.4 Economy Ledger 스타일 (U-049)
   - 거래 장부 영역만 내부 스크롤
   - 잔액/비용 영역은 고정
   =========================================== */

.economy-ledger {
  display: flex;
  flex-direction: column;
  min-height: 0; /* U-049: flex 자식 축소 허용 (필수) */
  flex: 1; /* 남은 공간 차지 */
  border-top: 1px solid var(--text-dim);
  margin-top: var(--spacing-sm);
  padding-top: var(--spacing-sm);
}

.ledger-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: var(--spacing-xs);
  flex-shrink: 0; /* U-049: 헤더는 축소하지 않음 */
}

.ledger-title {
  font-size: var(--font-size-xs);
  color: var(--text-dim);
  text-transform: uppercase;
  letter-spacing: 1px;
}

/* U-049: ledger-list만 스크롤 (핵심) */
.ledger-list {
  display: flex;
  flex-direction: column;
  gap: 4px;
  overflow-y: auto;
  overflow-x: hidden; /* U-049: 불필요한 가로 스크롤 방지 */
  scrollbar-width: thin; /* Firefox: 얇은 스크롤바 */
  min-height: 0; /* U-049: flex 자식 축소 허용 */
  max-height: 120px; /* U-049: 최대 높이 제한하여 스크롤 유도 */
  padding-right: var(--spacing-xs); /* 스크롤바 공간 */
}

.ledger-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--spacing-xs);
  background-color: rgba(0, 20, 0, 0.5);
  border: 1px solid var(--text-dim);
  border-radius: 2px;
  font-size: var(--font-size-xs);
}

.ledger-info {
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
  flex: 1;
  min-width: 0;
}

.ledger-turn {
  font-family: var(--font-micro-en);
  font-weight: bold;
  color: var(--text-color);
  flex-shrink: 0;
}

.ledger-reason {
  color: var(--text-dim);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.ledger-values {
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
  flex-shrink: 0;
}

.ledger-cost {
  font-family: var(--font-micro-en);
  color: var(--warning-color);
  font-weight: bold;
}

.ledger-model {
  font-family: var(--font-micro-en);
  font-size: 0.625rem;
  color: var(--accent-color);
  padding: 1px 3px;
  background-color: rgba(255, 0, 255, 0.1);
  border: 1px solid var(--accent-color);
  border-radius: 2px;
}

.ledger-empty {
  font-size: var(--font-size-xs);
  color: var(--text-dim);
  text-align: center;
  padding: var(--spacing-sm);
}

/* reduced-motion: 경고 애니메이션 비활성화 */
@media (prefers-reduced-motion: reduce) {
  .economy-balance.balance-low {
    animation: none;
  }

  .balance-warning-icon {
    animation: none;
    opacity: 1;
  }
}

/* ============================================
   23. UI 스케일 컨트롤 버튼 스타일 (U-028→U-037)
   ============================================ */

.ui-controls {
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
}

.ui-scale-btn {
  background: transparent;
  color: var(--text-color);
  border: 1px solid var(--text-dim);
  padding: 2px 6px;
  font-family: var(--font-main);
  font-size: var(--font-size-xs);
  cursor: pointer;
  text-transform: uppercase;
  transition:
    border-color 0.2s,
    color 0.2s,
    box-shadow 0.2s;
  min-width: 28px;
  text-align: center;
}

.ui-scale-btn:hover {
  border-color: var(--accent-color);
  color: var(--accent-color);
}

.ui-scale-btn:disabled {
  opacity: 0.4;
  cursor: not-allowed;
}

.ui-scale-btn:disabled:hover {
  border-color: var(--text-dim);
  color: var(--text-dim);
}

.ui-scale-display {
  font-size: var(--font-size-xs);
  color: var(--text-dim);
  min-width: 32px;
  text-align: center;
}

/* ============================================
   24. UI Chrome Pack (U-032)
   - 패널/카드에 적용되는 장식(코너/프레임)
   - Readable 모드에서 완화
   ============================================ */

/* Chrome 에셋 경로 변수 */
:root {
  --chrome-panel-corner: url('/ui/chrome/panel-corner-br.png');
  --chrome-card-frame: url('/ui/chrome/card-frame.png');
  --chrome-scanner-frame: url('/ui/chrome/scanner-frame.png');
  --chrome-corner-size: 32px;
  --chrome-glow-color: rgba(51, 255, 0, 0.3);
}

/* Game Header Chrome - 상단 코너 (U-032) */
.game-header.has-chrome {
  position: relative;
}

.game-header.has-chrome::before,
.game-header.has-chrome::after {
  content: '';
  position: absolute;
  width: var(--chrome-corner-size);
  height: var(--chrome-corner-size);
  background-image: var(--chrome-panel-corner);
  background-size: contain;
  background-repeat: no-repeat;
  pointer-events: none;
  opacity: 0.9;
  filter: drop-shadow(0 0 5px var(--chrome-glow-color));
  z-index: 2;
}

.game-header.has-chrome::before {
  top: -2px;
  left: -2px;
  transform: rotate(90deg);
}

.game-header.has-chrome::after {
  top: -2px;
  right: -2px;
  transform: rotate(180deg);
}

/* Panel Header Chrome - 코너 장식 (4방향 CSS transform) */
.panel-header.has-chrome {
  position: relative;
}

.panel-header.has-chrome::before,
.panel-header.has-chrome::after {
  content: '';
  position: absolute;
  width: var(--chrome-corner-size);
  height: var(--chrome-corner-size);
  background-image: var(--chrome-panel-corner);
  background-size: contain;
  background-repeat: no-repeat;
  pointer-events: none;
  opacity: 0.8;
  filter: drop-shadow(0 0 4px var(--chrome-glow-color));
}

/* 좌상단 코너 */
.panel-header.has-chrome::before {
  top: -2px;
  left: -2px;
  transform: rotate(90deg);
}

/* 우상단 코너 */
.panel-header.has-chrome::after {
  top: -2px;
  right: -2px;
  transform: rotate(180deg);
}

/* Panel Chrome - 하단 코너용 래퍼 */
.panel.has-chrome {
  position: relative;
}

.panel.has-chrome .panel-content {
  position: relative;
}

.panel.has-chrome .panel-content::before,
.panel.has-chrome .panel-content::after {
  content: '';
  position: absolute;
  width: var(--chrome-corner-size);
  height: var(--chrome-corner-size);
  background-image: var(--chrome-panel-corner);
  background-size: contain;
  background-repeat: no-repeat;
  pointer-events: none;
  opacity: 0.6;
  filter: drop-shadow(0 0 3px var(--chrome-glow-color));
}

/* 좌하단 코너 */
.panel.has-chrome .panel-content::before {
  bottom: 0;
  left: -2px;
  transform: rotate(0deg);
}

/* 우하단 코너 (원본 방향) */
.panel.has-chrome .panel-content::after {
  bottom: 0;
  right: -2px;
  transform: rotate(270deg);
}

/* Action Card Chrome - 프레임 오버레이 */
.action-card.has-chrome {
  position: relative;
  overflow: visible;
}

.action-card.has-chrome::before {
  content: '';
  position: absolute;
  top: -4px;
  left: -4px;
  right: -4px;
  bottom: -4px;
  background-image: var(--chrome-card-frame);
  background-size: 100% 100%;
  background-repeat: no-repeat;
  pointer-events: none;
  /* U-049: 배경 투명도 낮춰서 텍스트 가독성 향상 */
  opacity: 0.4;
  filter: drop-shadow(0 0 6px var(--chrome-glow-color));
  /* U-049: z-index를 낮춰서 텍스트 뒤에 위치 */
  z-index: 0;
}

/* U-049: 카드 내용은 chrome 배경 위에 표시 */
.action-card.has-chrome > * {
  position: relative;
  z-index: 1;
}

/* Scanner Slot Chrome - 장식 프레임 (U-032) */
.scanner-slot.has-chrome {
  position: relative;
  min-height: 100px;
  border: 1px dashed var(--text-dim);
  display: flex;
  align-items: center;
  justify-content: center;
  margin: var(--spacing-md) var(--spacing-sm);
  background-color: rgba(0, 0, 0, 0.4);
}

/* ============================================
   31. Scanner Slot 스타일 (U-022[Mvp])
   - PRD 6.7: 이미지 드랍/업로드 → 아이템화
   - RULE-002: 게임 UI로 상시 노출
   - Q1 Option B: 사용자 확인 후 인벤토리 추가
   ============================================ */

.scanner-slot-container {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-sm);
  min-height: 120px;
  padding: var(--spacing-xs);
}

/* 드랍존 기본 스타일 */
.scanner-dropzone {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: var(--spacing-xs);
  min-height: 100px;
  padding: var(--spacing-md);
  border: 2px dashed var(--text-dim);
  border-radius: var(--border-radius);
  background-color: rgba(0, 20, 0, 0.5);
  /* 격자 무늬 배경 추가 (기존 배경의 느낌을 계승) */
  background-image:
    linear-gradient(rgba(0, 255, 0, 0.05) 1px, transparent 1px),
    linear-gradient(90deg, rgba(0, 255, 0, 0.05) 1px, transparent 1px);
  background-size: 20px 20px;
  cursor: pointer;
  transition:
    border-color 0.2s,
    background-color 0.2s,
    box-shadow 0.2s;
  position: relative;
  overflow: hidden;
}

/* 스캔라인 애니메이션 추가 (장치 느낌) */
.scanner-dropzone::after {
  content: '';
  position: absolute;
  top: -100%;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(to bottom, transparent, rgba(0, 255, 0, 0.05) 50%, transparent);
  animation: scanning-idle 4s linear infinite;
  pointer-events: none;
}

@keyframes scanning-idle {
  0% {
    top: -100%;
  }
  100% {
    top: 100%;
  }
}

.scanner-dropzone:hover:not(.disabled) {
  border-color: var(--text-color);
  background-color: rgba(0, 30, 0, 0.6);
  background-image:
    linear-gradient(rgba(0, 255, 0, 0.08) 1px, transparent 1px),
    linear-gradient(90deg, rgba(0, 255, 0, 0.08) 1px, transparent 1px);
}

.scanner-dropzone:focus-visible {
  outline: 2px solid var(--accent-color);
  outline-offset: 2px;
}

/* 드래그 오버 상태 */
.scanner-dropzone.drag-over {
  border-color: var(--accent-color);
  background-color: rgba(40, 0, 40, 0.4);
  box-shadow:
    0 0 15px var(--accent-color),
    inset 0 0 10px rgba(255, 0, 255, 0.1);
}

/* 비활성화 상태 */
.scanner-dropzone.disabled {
  cursor: not-allowed;
  opacity: 0.5;
  border-color: var(--text-dim);
}

.scanner-dropzone.disabled:hover {
  border-color: var(--text-dim);
  background-color: rgba(0, 20, 0, 0.5);
}

.scanner-dropzone-icon {
  font-size: 2rem;
  opacity: 0.8;
}

.scanner-dropzone-text {
  font-size: var(--font-size-sm);
  color: var(--text-color);
  text-transform: uppercase;
  letter-spacing: 1px;
  text-align: center;
}

.scanner-dropzone-hint {
  font-size: var(--font-size-xs);
  color: var(--text-dim);
  text-align: center;
}

/* 프리뷰 이미지 */
.scanner-preview {
  width: 100%;
  max-height: 80px;
  display: flex;
  align-items: center;
  justify-content: center;
  border: 1px solid var(--text-dim);
  border-radius: 2px;
  overflow: hidden;
  background-color: rgba(0, 0, 0, 0.5);
}

.scanner-preview-img {
  max-width: 100%;
  max-height: 80px;
  object-fit: contain;
}

.scanner-preview-small {
  width: 48px;
  height: 48px;
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  border: 1px solid var(--text-dim);
  border-radius: 2px;
  overflow: hidden;
  background-color: rgba(0, 0, 0, 0.5);
}

.scanner-preview-img-small {
  max-width: 100%;
  max-height: 100%;
  object-fit: cover;
}

/* 로딩 상태 */
.scanner-loading {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: var(--spacing-sm);
  padding: var(--spacing-md);
}

.scanner-loading-content {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: var(--spacing-xs);
}

.scanner-loading-spinner {
  width: 24px;
  height: 24px;
  border: 3px solid var(--text-dim);
  border-top-color: var(--accent-color);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

.scanner-loading-text {
  font-size: var(--font-size-sm);
  color: var(--accent-color);
  text-transform: uppercase;
  letter-spacing: 1px;
}

/* 에러 상태 */
.scanner-error {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: var(--spacing-sm);
  padding: var(--spacing-md);
}

.scanner-error-content {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: var(--spacing-xs);
}

.scanner-error-icon {
  font-size: 1.5rem;
}

.scanner-error-message {
  font-size: var(--font-size-sm);
  color: var(--warning-color);
  text-align: center;
}

/* 결과 상태 */
.scanner-result {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-sm);
  padding: var(--spacing-xs);
}

.scanner-result-header {
  display: flex;
  align-items: flex-start;
  gap: var(--spacing-sm);
}

.scanner-result-info {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.scanner-caption {
  font-size: var(--font-size-sm);
  color: var(--text-color);
  line-height: 1.3;
}

.scanner-stats {
  font-size: var(--font-size-xs);
  color: var(--text-dim);
}

/* 아이템 후보 목록 */
.scanner-candidates {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-xs);
}

.scanner-candidates-title {
  font-size: var(--font-size-xs);
  color: var(--text-color);
  text-transform: uppercase;
  letter-spacing: 1px;
  padding-bottom: var(--spacing-xs);
  border-bottom: 1px solid rgba(51, 255, 0, 0.2);
}

.scanner-candidates-list {
  display: flex;
  flex-direction: column;
  gap: 4px;
  max-height: 150px;
  overflow-y: auto;
  overflow-x: hidden;
  scrollbar-width: thin;
}

.scanner-candidate {
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
  padding: var(--spacing-xs);
  background-color: rgba(0, 20, 0, 0.5);
  border: 1px solid var(--text-dim);
  border-radius: 2px;
  cursor: pointer;
  transition:
    border-color 0.2s,
    background-color 0.2s;
  text-align: left;
  width: 100%;
  font-family: var(--font-main);
}

.scanner-candidate:hover {
  border-color: var(--text-color);
  background-color: rgba(0, 30, 0, 0.7);
}

.scanner-candidate.selected {
  border-color: var(--accent-color);
  background-color: rgba(40, 0, 40, 0.4);
}

.scanner-candidate-checkbox {
  font-size: 0.875rem;
  color: var(--text-color);
  flex-shrink: 0;
}

.scanner-candidate.selected .scanner-candidate-checkbox {
  color: var(--accent-color);
}

.scanner-candidate-icon {
  font-size: 1.25rem;
  flex-shrink: 0;
}

.scanner-candidate-info {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 1px;
  min-width: 0;
}

.scanner-candidate-name {
  font-size: var(--font-size-sm);
  color: var(--text-color);
  font-weight: bold;
}

.scanner-candidate-desc {
  font-size: var(--font-size-xs);
  color: var(--text-dim);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.scanner-candidate-type {
  font-size: 0.625rem;
  color: var(--accent-color);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.scanner-no-candidates {
  font-size: var(--font-size-sm);
  color: var(--text-dim);
  text-align: center;
  padding: var(--spacing-md);
}

/* 액션 버튼 */
.scanner-actions {
  display: flex;
  justify-content: flex-end;
  gap: var(--spacing-xs);
  margin-top: var(--spacing-xs);
}

.scanner-btn {
  padding: var(--spacing-xs) var(--spacing-sm);
  font-family: var(--font-main);
  font-size: var(--font-size-xs);
  text-transform: uppercase;
  letter-spacing: 1px;
  cursor: pointer;
  transition:
    background-color 0.2s,
    border-color 0.2s,
    color 0.2s;
}

.scanner-btn-cancel,
.scanner-btn-retry {
  background: transparent;
  border: 1px solid var(--text-dim);
  color: var(--text-color);
}

.scanner-btn-cancel:hover,
.scanner-btn-retry:hover {
  border-color: var(--text-color);
}

.scanner-btn-add {
  background: var(--text-color);
  border: 1px solid var(--text-color);
  color: var(--bg-color);
}

.scanner-btn-add:hover:not(:disabled) {
  background: var(--accent-color);
  border-color: var(--accent-color);
  color: white;
}

.scanner-btn-add:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* reduced-motion */
@media (prefers-reduced-motion: reduce) {
  .scanner-loading-spinner {
    animation: none;
    border-color: var(--accent-color);
  }

  .scanner-dropzone {
    transition: none;
  }

  .scanner-candidate {
    transition: none;
  }
}

.scanner-slot.has-chrome::before {
  content: '';
  position: absolute;
  top: -10px;
  left: -10px;
  right: -10px;
  bottom: -10px;
  background-image: var(--chrome-scanner-frame);
  background-size: 100% 100%;
  background-repeat: no-repeat;
  pointer-events: none;
  opacity: 0.8;
  filter: drop-shadow(0 0 8px var(--chrome-glow-color));
  z-index: 1;
}

/* Chrome 호버 효과 강화 */
.action-card.has-chrome:hover::before,
.scanner-slot.has-chrome:hover::before {
  opacity: 1;
  filter: drop-shadow(0 0 10px var(--accent-color));
}

/* reduced-motion: Chrome 효과 완화 */
@media (prefers-reduced-motion: reduce) {
  .game-header.has-chrome::before,
  .game-header.has-chrome::after,
  .panel-header.has-chrome::before,
  .panel-header.has-chrome::after,
  .panel.has-chrome .panel-content::before,
  .panel.has-chrome .panel-content::after {
    filter: none;
  }

  .action-card.has-chrome::before,
  .scanner-slot.has-chrome::before {
    filter: none;
  }

  .action-card.has-chrome:hover::before,
  .scanner-slot.has-chrome:hover::before {
    filter: none;
  }
}

/* Chrome 폴백: 이미지 로딩 실패 시 CSS 테두리로 대체 */
.panel-header.has-chrome.chrome-fallback::before,
.panel-header.has-chrome.chrome-fallback::after,
.panel.has-chrome.chrome-fallback .panel-content::before,
.panel.has-chrome.chrome-fallback .panel-content::after {
  background-image: none;
  background-color: var(--text-color);
  width: 8px;
  height: 8px;
  border-radius: 1px;
}

.action-card.has-chrome.chrome-fallback::before,
.scanner-slot.has-chrome.chrome-fallback::before {
  background-image: none;
  border: 1px solid var(--text-color);
  background-color: transparent;
}

/* ============================================
   25. Inventory Panel 스타일 (U-011)
   - RULE-002: 게임 UI로 상시 노출
   - dnd-kit 드래그 가능 아이템
   ============================================ */

.inventory-panel-content {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-sm);
  height: 100%;
  min-height: 120px;
  overflow: hidden; /* 드래그 중 스크롤바 생성 방지 */
}

/* 인벤토리 그리드 */
.inventory-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
  gap: var(--spacing-xs);
  padding: var(--spacing-xs);
}

/* 빈 인벤토리 */
.inventory-empty {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: var(--spacing-xs);
  padding: var(--spacing-lg);
  color: var(--text-dim);
  text-align: center;
}

.inventory-empty-icon {
  font-size: 2rem;
  opacity: 0.5;
}

.inventory-empty-text {
  font-size: var(--font-size-sm);
  text-transform: uppercase;
  letter-spacing: 1px;
}

/* 인벤토리 아이템 */
.inventory-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: var(--spacing-xs);
  padding: var(--spacing-sm);
  border: 1px solid var(--text-dim);
  border-radius: var(--border-radius);
  background: linear-gradient(180deg, rgba(0, 30, 0, 0.8) 0%, rgba(0, 15, 0, 0.9) 100%);
  cursor: grab;
  transition:
    border-color 0.2s,
    box-shadow 0.2s,
    transform 0.15s,
    opacity 0.2s;
  user-select: none;
  touch-action: none;
}

/* 아이템 호버 */
.inventory-item:hover:not(.disabled):not(.dragging) {
  border-color: var(--text-color);
  box-shadow: 0 0 8px rgba(51, 255, 0, 0.3);
  transform: translateY(-2px);
}

/* 아이템 선택 상태 */
.inventory-item.selected {
  border-color: var(--accent-color);
  box-shadow:
    0 0 10px var(--accent-color),
    inset 0 0 5px rgba(255, 0, 255, 0.1);
}

/* 아이템 드래그 중 */
.inventory-item.dragging {
  opacity: 0.3; /* 드래그 중인 원본은 더 투명하게 */
  cursor: grabbing;
  border-style: dashed;
  box-shadow: none; /* 드래그 중인 원본 글로우 제거 */
}

/* 아이템 비활성화 */
.inventory-item.disabled {
  cursor: not-allowed;
  opacity: 0.5;
  border-color: var(--text-dim);
}

.inventory-item.disabled:hover {
  transform: none;
  box-shadow: none;
}

/* 드래그 오버레이 (커서 따라다니는 아이템) */
.inventory-item.overlay {
  border-color: var(--accent-color);
  box-shadow:
    0 0 20px var(--accent-color),
    0 8px 24px rgba(0, 0, 0, 0.6);
  transform: scale(1.05) rotate(3deg);
  cursor: grabbing;
  z-index: 10001;
  pointer-events: none;
  opacity: 1 !important;
}

/* 아이템 아이콘 */
.inventory-item-icon {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 44px; /* 40px -> 44px */
  height: 44px;
  border: 1px solid var(--text-dim);
  border-radius: 2px;
  background-color: rgba(0, 0, 0, 0.4);
}

.inventory-item-icon-img {
  width: 36px; /* 32px -> 36px */
  height: 36px;
  object-fit: contain;
  image-rendering: pixelated;
}

.inventory-item-icon-emoji {
  font-size: 1.8rem; /* 1.5rem -> 1.8rem */
}

/* 아이템 정보 */
.inventory-item-info {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 2px;
  width: 100%;
}

.inventory-item-name {
  font-size: var(--font-size-xs);
  color: var(--text-color);
  text-align: center;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 100%;
  display: block;
}

.inventory-item-quantity {
  font-family: var(--font-micro-en); /* 수치 식별성을 위해 마이크로 폰트 적용 */
  font-size: var(--font-size-sm);
  color: var(--warning-color);
  font-weight: bold;
  text-shadow: 0 0 5px rgba(0, 0, 0, 0.9);
}

/* 포커스 상태 (접근성) */
.inventory-item:focus-visible {
  outline: 2px solid var(--accent-color);
  outline-offset: 2px;
}

.inventory-item:focus:not(:focus-visible) {
  outline: none;
}

/* 모바일 조정 */
@media (max-width: 768px) {
  .inventory-grid {
    grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
    gap: 4px;
  }

  .inventory-item {
    padding: var(--spacing-xs);
  }

  .inventory-item-icon {
    width: 32px;
    height: 32px;
  }

  .inventory-item-icon-img {
    width: 24px;
    height: 24px;
  }

  .inventory-item-icon-emoji {
    font-size: 1.2rem;
  }

  .inventory-item-name {
    font-size: 0.625rem;
  }
}

/* reduced-motion: 드래그 애니메이션 완화 */
@media (prefers-reduced-motion: reduce) {
  .inventory-item {
    transition: none;
  }

  .inventory-item:hover:not(.disabled):not(.dragging) {
    transform: none;
  }

  .inventory-item.overlay {
    transform: none;
  }
}

/* ============================================
   26. Quest Panel 스타일 (U-013)
   - RULE-002: 게임 UI로 상시 노출
   - 체크리스트 형태로 목표 표시
   ============================================ */

.quest-panel-content {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-sm);
  padding: var(--spacing-xs);
}

/* 빈 상태 */
.quest-empty {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: var(--spacing-xs);
  padding: var(--spacing-md);
  min-height: 80px;
}

.quest-empty-icon {
  font-size: 1.5rem;
  opacity: 0.5;
}

.quest-empty-text {
  font-size: var(--font-size-sm);
  color: var(--text-dim);
  text-transform: uppercase;
  letter-spacing: 1px;
  text-align: center;
}

/* 섹션 */
.quest-section {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-xs);
}

.quest-section-title {
  font-size: var(--font-size-xs);
  color: var(--text-dim);
  text-transform: uppercase;
  letter-spacing: 1px;
  padding-bottom: var(--spacing-xs);
  border-bottom: 1px solid rgba(51, 255, 0, 0.2);
}

/* 퀘스트 목록 */
.quest-list {
  list-style: none;
  display: flex;
  flex-direction: column;
  gap: 4px;
}

/* 개별 퀘스트 아이템 */
.quest-item {
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
  padding: var(--spacing-xs);
  background-color: rgba(0, 20, 0, 0.5);
  border: 1px solid var(--text-dim);
  border-radius: 2px;
  transition:
    border-color 0.2s,
    background-color 0.2s;
}

.quest-item.quest-active {
  border-color: var(--text-color);
}

.quest-item.quest-completed {
  border-color: var(--text-dim);
  opacity: 0.7;
}

.quest-checkbox {
  font-size: 0.875rem;
  color: var(--text-color);
  flex-shrink: 0;
}

.quest-item.quest-completed .quest-checkbox {
  color: var(--text-dim);
}

.quest-label {
  font-size: var(--font-size-sm);
  color: var(--text-color);
  flex: 1;
  line-height: 1.3;
}

.quest-item.quest-completed .quest-label {
  color: var(--text-dim);
  text-decoration: line-through;
}

.quest-status-badge {
  font-size: 0.625rem;
  color: var(--accent-color);
  text-transform: uppercase;
  letter-spacing: 1px;
  padding: 2px 4px;
  background-color: rgba(255, 0, 255, 0.1);
  border: 1px solid var(--accent-color);
  border-radius: 2px;
}

/* 완료된 퀘스트 목록 */
.quest-list-completed {
  max-height: 100px;
  overflow-y: auto;
  overflow-x: hidden;
  scrollbar-width: thin;
}

/* ============================================
   27. Rule Board 스타일 (U-013)
   - RULE-002: 게임 UI로 상시 노출
   - 룰 카드 형태로 규칙 표시
   ============================================ */

.rule-board-content {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-sm);
  padding: var(--spacing-xs);
}

/* 빈 상태 */
.rule-board-empty {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: var(--spacing-xs);
  padding: var(--spacing-md);
  min-height: 80px;
}

.rule-board-empty-icon {
  font-size: 1.5rem;
  opacity: 0.5;
}

.rule-board-empty-text {
  font-size: var(--font-size-sm);
  color: var(--text-dim);
  text-transform: uppercase;
  letter-spacing: 1px;
  text-align: center;
}

/* 헤더 */
.rule-board-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding-bottom: var(--spacing-xs);
  border-bottom: 1px solid rgba(51, 255, 0, 0.2);
}

.rule-board-count {
  font-size: var(--font-size-xs);
  color: var(--text-dim);
  text-transform: uppercase;
  letter-spacing: 1px;
}

/* 룰 카드 리스트 */
.rule-card-list {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-xs);
}

/* 개별 룰 카드 */
.rule-card {
  display: flex;
  flex-direction: column;
  gap: 4px;
  padding: var(--spacing-sm);
  background: linear-gradient(180deg, rgba(0, 30, 0, 0.8) 0%, rgba(0, 15, 0, 0.9) 100%);
  border: 1px solid var(--border-color);
  border-radius: var(--border-radius);
  transition:
    border-color 0.2s,
    box-shadow 0.2s;
}

.rule-card:hover {
  border-color: var(--accent-color);
  box-shadow: 0 0 8px rgba(255, 0, 255, 0.2);
}

.rule-card-header {
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
}

.rule-card-icon {
  font-size: 0.875rem;
  color: var(--warning-color);
  flex-shrink: 0;
}

.rule-card-label {
  font-size: var(--font-size-sm);
  font-weight: bold;
  color: var(--text-color);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.rule-card-description {
  font-size: var(--font-size-xs);
  color: var(--text-dim);
  line-height: 1.3;
  padding-left: calc(0.875rem + var(--spacing-xs));
}

/* ============================================
   28. Mutation Timeline 스타일 (U-013)
   - PRD 6.4: Rule Mutation Timeline
   - 시간순 이벤트 표시
   ============================================ */

.mutation-timeline-content {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-sm);
  padding: var(--spacing-xs);
  margin-top: var(--spacing-sm);
  border-top: 1px dashed var(--text-dim);
}

/* 빈 상태 */
.timeline-empty {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: var(--spacing-xs);
  padding: var(--spacing-md);
  min-height: 60px;
}

.timeline-empty-icon {
  font-size: 1.5rem;
  opacity: 0.5;
}

.timeline-empty-text {
  font-size: var(--font-size-sm);
  color: var(--text-dim);
  text-transform: uppercase;
  letter-spacing: 1px;
  text-align: center;
}

/* 헤더 */
.timeline-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding-bottom: var(--spacing-xs);
}

.timeline-title {
  font-size: var(--font-size-xs);
  color: var(--text-color);
  text-transform: uppercase;
  letter-spacing: 1px;
}

.timeline-count {
  font-size: var(--font-size-xs);
  color: var(--text-dim);
}

/* 타임라인 이벤트 리스트 */
.timeline-events {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-xs);
  max-height: 150px;
  overflow-y: auto;
  overflow-x: hidden;
  scrollbar-width: thin;
}

/* 개별 타임라인 이벤트 */
.timeline-event {
  display: flex;
  align-items: flex-start;
  gap: var(--spacing-xs);
  padding: var(--spacing-xs);
  background-color: rgba(0, 20, 0, 0.5);
  border-left: 3px solid var(--text-color);
  border-radius: 0 2px 2px 0;
  transition: background-color 0.2s;
}

.timeline-event:hover {
  background-color: rgba(0, 30, 0, 0.7);
}

/* 이벤트 유형별 테두리 색상 */
.timeline-event-added {
  border-left-color: var(--text-color);
}

.timeline-event-modified {
  border-left-color: var(--warning-color);
}

.timeline-event-removed {
  border-left-color: var(--error-color);
}

/* 이벤트 마커 */
.timeline-event-marker {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 2px;
  flex-shrink: 0;
  min-width: 40px;
}

.timeline-event-icon {
  font-size: 0.75rem;
}

.timeline-event-turn {
  font-family: var(--font-micro-en);
  font-size: 0.625rem;
  color: var(--text-dim);
  text-transform: uppercase;
}

/* 이벤트 내용 */
.timeline-event-content {
  display: flex;
  flex-direction: column;
  gap: 2px;
  flex: 1;
  min-width: 0;
}

.timeline-event-label {
  font-size: var(--font-size-xs);
  color: var(--text-color);
  font-weight: bold;
}

.timeline-event-type {
  font-size: 0.625rem;
  color: var(--text-dim);
  text-transform: uppercase;
  letter-spacing: 1px;
}

.timeline-event-description {
  font-size: var(--font-size-xs);
  color: var(--text-dim);
  line-height: 1.2;
}

/* 더보기 표시 */
.timeline-more {
  display: flex;
  justify-content: center;
  padding: var(--spacing-xs);
}

.timeline-more-text {
  font-size: 0.625rem;
  color: var(--text-dim);
  text-transform: uppercase;
  letter-spacing: 1px;
}

/* 모바일 조정 */
@media (max-width: 768px) {
  .quest-panel-content,
  .rule-board-content,
  .mutation-timeline-content {
    padding: 4px;
  }

  .quest-item,
  .rule-card,
  .timeline-event {
    padding: 4px;
  }

  .timeline-events {
    max-height: 100px;
  }
}

/* ============================================
   29. 프로필 선택 화면 스타일 (U-015[Mvp])
   - PRD 6.9: 데모 프로필 3종 + 즉시 시작
   ============================================ */

/* U-044: 언어 선택 토글 (프로필 선택 화면 우측 상단) */
.language-toggle-container {
  position: fixed;
  top: var(--spacing-lg);
  right: var(--spacing-lg);
  z-index: 100;
}

.language-toggle-btn {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  padding: var(--spacing-sm) var(--spacing-md);
  background: rgba(0, 30, 0, 0.9);
  border: 1px solid var(--text-dim);
  border-radius: var(--border-radius);
  color: var(--text-color);
  font-family: var(--font-main);
  font-size: var(--font-size-sm);
  cursor: pointer;
  transition:
    border-color 0.2s,
    box-shadow 0.2s;
}

.language-toggle-btn:hover {
  border-color: var(--text-color);
  box-shadow: 0 0 10px var(--text-dim);
}

.language-toggle-btn:focus-visible {
  outline: 2px solid var(--accent-color);
  outline-offset: 2px;
}

.language-toggle-icon {
  font-size: 1.2rem;
}

.language-toggle-label {
  text-transform: uppercase;
  letter-spacing: 1px;
}

.profile-select-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 100vh;
  padding: var(--spacing-xl);
  background: radial-gradient(ellipse at center, rgba(0, 30, 0, 0.3) 0%, var(--bg-color) 70%);
}

/* 타이틀 헤더 */
.profile-select-header {
  text-align: center;
  margin-bottom: var(--spacing-xl);
}

.profile-select-title {
  font-size: 3rem;
  color: var(--text-color);
  text-transform: uppercase;
  letter-spacing: 8px;
  margin-bottom: var(--spacing-md);
  text-shadow: 0 0 20px var(--text-color);
}

.profile-select-subtitle {
  font-size: var(--font-size-lg);
  color: var(--text-dim);
  text-transform: uppercase;
  letter-spacing: 3px;
}

/* 프로필 카드 그리드 */
.profile-card-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: var(--spacing-lg);
  max-width: 900px;
  margin-bottom: var(--spacing-xl);
}

@media (max-width: 900px) {
  .profile-card-grid {
    grid-template-columns: repeat(2, 1fr);
  }
}

@media (max-width: 600px) {
  .profile-card-grid {
    grid-template-columns: 1fr;
  }
}

/* 프로필 카드 */
.profile-card {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: var(--spacing-md);
  padding: var(--spacing-xl);
  min-width: 220px;
  min-height: 280px;
  border: 2px solid var(--text-dim);
  border-radius: var(--border-radius);
  background: linear-gradient(180deg, rgba(0, 30, 0, 0.9) 0%, rgba(0, 10, 0, 0.95) 100%);
  cursor: pointer;
  transition:
    border-color 0.3s,
    box-shadow 0.3s,
    transform 0.2s;
  text-align: center;
}

.profile-card:hover {
  border-color: var(--profile-accent, var(--accent-color));
  box-shadow:
    0 0 30px var(--profile-accent, var(--accent-color)),
    inset 0 0 20px rgba(0, 0, 0, 0.5);
  transform: translateY(-8px) scale(1.02);
}

.profile-card:focus-visible {
  outline: 2px solid var(--accent-color);
  outline-offset: 4px;
}

.profile-card-icon {
  font-size: 4rem;
  filter: drop-shadow(0 0 10px var(--profile-accent, var(--text-color)));
}

.profile-card-name {
  font-size: var(--font-size-xl);
  font-weight: bold;
  color: var(--text-color);
  text-transform: uppercase;
  letter-spacing: 2px;
  text-shadow: 0 0 8px var(--text-dim);
}

.profile-card-description {
  font-size: var(--font-size-sm);
  color: var(--text-dim);
  line-height: 1.4;
  padding: 0 var(--spacing-sm);
}

/* 계속하기 섹션 */
.profile-continue-section {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: var(--spacing-md);
  margin-bottom: var(--spacing-lg);
}

.profile-continue-divider {
  display: flex;
  align-items: center;
  gap: var(--spacing-md);
  color: var(--text-dim);
  font-size: var(--font-size-sm);
  text-transform: uppercase;
  letter-spacing: 2px;
}

.profile-continue-divider::before,
.profile-continue-divider::after {
  content: '';
  width: 60px;
  height: 1px;
  background-color: var(--text-dim);
}

.profile-continue-btn {
  padding: var(--spacing-sm) var(--spacing-lg);
  font-size: var(--font-size-lg);
  background: transparent;
  border: 2px dashed var(--text-color);
  color: var(--text-color);
  text-transform: uppercase;
  letter-spacing: 2px;
  cursor: pointer;
  transition:
    background-color 0.2s,
    border-style 0.2s,
    box-shadow 0.2s;
}

.profile-continue-btn:hover {
  background-color: rgba(51, 255, 0, 0.1);
  border-style: solid;
  box-shadow: 0 0 15px var(--text-color);
}

/* 하단 안내 */
.profile-select-footer {
  text-align: center;
}

.profile-select-hint {
  font-size: var(--font-size-sm);
  color: var(--text-dim);
  font-style: italic;
}

/* ============================================
   30. 리셋 버튼 스타일 (U-015[Mvp])
   ============================================ */

.reset-button-wrapper {
  display: inline-flex;
  align-items: center;
  gap: var(--spacing-xs);
}

.reset-button {
  display: inline-flex;
  align-items: center;
  gap: var(--spacing-xs);
  padding: var(--spacing-xs) var(--spacing-sm);
  background: transparent;
  border: 1px solid var(--text-dim);
  color: var(--text-color);
  font-size: var(--font-size-xs);
  text-transform: uppercase;
  letter-spacing: 1px;
  cursor: pointer;
  transition:
    border-color 0.2s,
    background-color 0.2s,
    color 0.2s;
}

.reset-button:hover:not(:disabled) {
  border-color: var(--warning-color);
  color: var(--warning-color);
}

.reset-button.confirming {
  border-color: var(--error-color);
  background-color: rgba(255, 51, 51, 0.1);
  color: var(--error-color);
  animation: confirm-pulse 0.5s ease-in-out infinite;
}

@keyframes confirm-pulse {
  0%,
  100% {
    opacity: 1;
  }
  50% {
    opacity: 0.7;
  }
}

.reset-button.compact {
  padding: var(--spacing-xs);
  min-width: 28px;
  justify-content: center;
}

.reset-button:disabled {
  opacity: 0.4;
  cursor: not-allowed;
}

.reset-icon {
  font-size: 0.875rem;
}

.reset-text {
  white-space: nowrap;
}

.reset-cancel-button {
  padding: 2px 6px;
  background: transparent;
  border: 1px solid var(--text-dim);
  color: var(--text-dim);
  font-size: 0.75rem;
  cursor: pointer;
  transition:
    border-color 0.2s,
    color 0.2s;
}

.reset-cancel-button:hover {
  border-color: var(--text-color);
  color: var(--text-color);
}

/* 프로필 변경 버튼 */
.change-profile-button {
  display: inline-flex;
  align-items: center;
  gap: var(--spacing-xs);
  padding: var(--spacing-xs) var(--spacing-sm);
  background: transparent;
  border: 1px solid var(--text-dim);
  color: var(--text-color);
  font-size: var(--font-size-xs);
  text-transform: uppercase;
  letter-spacing: 1px;
  cursor: pointer;
  transition:
    border-color 0.2s,
    color 0.2s;
}

.change-profile-button:hover:not(:disabled) {
  border-color: var(--accent-color);
  color: var(--accent-color);
}

.change-profile-button:disabled {
  opacity: 0.4;
  cursor: not-allowed;
}

.change-profile-icon {
  font-size: 0.875rem;
}

.change-profile-text {
  white-space: nowrap;
}

/* reduced-motion: 프로필 선택 애니메이션 완화 */
@media (prefers-reduced-motion: reduce) {
  .profile-card:hover {
    transform: none;
  }

  .reset-button.confirming {
    animation: none;
  }
}
