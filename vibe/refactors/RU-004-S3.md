# [ID: RU-004-S3] RU-004 이후 “SaveGame/프로필/리셋/복원” 수동 검증 시나리오 패키지(데모 10분 루프)

## 📌 기본 정보

| 항목               | 내용                                                                 |
| ------------------ | -------------------------------------------------------------------- |
| **ID**             | RU-004-S3                                                            |
| **심각도**         | Medium                                                               |
| **카테고리**       | 수동 검증 시나리오 (Manual Verification)                             |
| **영향 범위**      | RU-004 관련 변경 파일 전반(`App.tsx`, `saveGame.ts`, `demoProfiles.ts`, stores) |
| **예상 작업 시간** | 20~40분                                                              |

---

## 🔍 문제점 상세 분석

### 현재 상황

RU-004는 기능 추가가 아니라 “세션 경계(프로필/리셋/세이브/복원)” 리팩토링입니다.  
이 영역은 자동 테스트보다 **데모 체감(Reset/Continue가 끊기지 않는지)**이 훨씬 중요하지만, RU-004 전용으로 “최소 시나리오 묶음”이 고정되어 있지 않습니다.

### 문제가 되는 이유

1. 세션 경계는 작은 변경이 큰 회귀를 만들기 쉬우며, 데모 직전에야 발견될 수 있습니다.
2. PRD 6.9(데모 프로필/즉시 리셋)는 심사자 경험의 핵심이므로, **수동 검증이 사실상 품질 게이트**입니다.

---

## 💡 개선 방안

### 제안하는 접근법

RU-004에서 바뀔 수 있는 핵심 경로만 최소 7개 시나리오로 고정합니다.

- 목표: “10분 데모 루프”가 끊기지 않음을 확인
- 금지: 자동화 테스트 코드 제안(본 문서에서는 수동 절차만)

---

## 🧪 검증 방법 (수동 검증 중심)

## 시나리오 1: 프로필 3종 선택 → 초기 상태가 올바른지 확인

- **목적**: 프로필 프리셋/초기 SaveGame/스토어 주입이 정상인지 확인
- **실행 방법**
  - 앱 시작 → 프로필 선택 화면에서 Narrator/Explorer/Tech 각각 1회씩 선택(매번 프로필 변경으로 돌아가 반복)
- **기대 결과**
  - ✅ Economy HUD: 프로필별 Signal/Shard 초기값이 맞다
  - ✅ Inventory: 프로필별 초기 아이템이 맞다
  - ✅ Quest/Rule Board/Mutation Timeline: 초기 값이 맞다(있다면)
  - ✅ Scene hotspot: 프로필별 오브젝트가 표시된다
  - ✅ NarrativeFeed: 환영 메시지가 turn 0에 1개 존재한다

## 시나리오 2: 1~2턴 진행 → autosave가 실제로 동작하는지 확인

- **목적**: 턴 완료 후 자동 저장이 세션 상태를 반영하는지 확인
- **실행 방법**
  - 임의 프로필 선택 → Action Deck 카드 1개 클릭(또는 입력)으로 1턴 진행
  - 1턴 후 Economy HUD의 원장(ledger) 항목이 생성되는지 확인
- **기대 결과**
  - ✅ worldStore: turnCount가 증가(내러티브 turn이 증가)
  - ✅ Economy HUD: last cost/ledger가 갱신
  - ✅ 저장 키(localStorage)가 갱신됨(개발자 도구로 확인 가능)

## 시나리오 3: 새로고침 → Continue → 상태 복원이 정확한지 확인

- **목적**: Continue/Reload의 핵심(저장된 상태를 정확히 복원)을 검증
- **실행 방법**
  - 시나리오 2 상태에서 새로고침
  - profile_select 화면에서 Continue가 보이면 클릭
- **기대 결과**
  - ✅ Economy HUD 잔액이 저장 당시와 동일
  - ✅ ledger 순서가 최신순이며 lastCost가 최신 항목과 정합(S1)
  - ✅ Inventory/Quest/Rules/Hotspots가 저장 당시와 동일
  - ✅ Reset 버튼이 정상 동작(프로필 ID 드리프트 없음, S2)

## 시나리오 4: Reset → “프로필 초기 상태”로 완전히 복구되는지 확인

- **목적**: Reset이 초기 SaveGame SSOT를 기준으로 정확히 복구되는지 확인
- **실행 방법**
  - 2턴 이상 진행 후 Reset 실행(확인 모드 포함)
- **기대 결과**
  - ✅ 잔액/원장/인벤토리/퀘스트/룰/핫스팟이 프로필 초기 상태로 복귀
  - ✅ Action Deck이 초기 상태(기본 카드/초기 상태)로 보이며, 이전 세션 카드가 남지 않음(S2)
  - ✅ Agent Console이 초기 상태(이전 에러/배지 잔재 없음)로 보임(S2)

## 시나리오 5: 프로필 변경 → profile_select로 복귀 + 이전 세션 흔적 정리

- **목적**: “프로필 변경”이 데모 반복을 막지 않도록 안전한 클린업을 수행하는지 확인
- **실행 방법**
  - playing 상태에서 “프로필 변경” 버튼 클릭
- **기대 결과**
  - ✅ profile_select 화면으로 이동
  - ✅ Continue가 노출되지 않거나(정책에 따라), 노출되더라도 유효한 저장만 대상(S2)
  - ✅ world/economy/inventory/actionDeck/agent 상태가 이전 세션에서 끌려오지 않음

## 시나리오 6: 손상된 세이브 데이터(의도적) → 안전 폴백 확인

- **목적**: localStorage가 비정상일 때도 데모가 “막히지 않는지” 확인(S2)
- **실행 방법**
  - 개발자 도구에서 `unknown_world_savegame`에 깨진 JSON 또는 스키마 불일치 데이터 저장
  - 새로고침
- **기대 결과**
  - ✅ profile_select로 진입(playing으로 잘못 진입하지 않음)
  - ✅ Continue 버튼이 숨겨지거나 클릭 시 안전 폴백(클린업 + 안내)

## 시나리오 7: 언어 복원 일관성(가능한 범위)

- **목적**: RULE-006(ko/en 혼합 출력 금지) 관점에서 복원 시 언어가 흔들리지 않는지 확인(S1)
- **실행 방법**
  - 언어를 변경(가능한 범위)한 뒤 1턴 진행 → 새로고침 → Continue
- **기대 결과**
  - ✅ 복원 직후 UI 문자열이 저장된 언어로 표시(혼합 없음)

---

## 📈 기대 효과

- ✅ RU-004 변경 후 데모 “10분 루프”가 끊기지 않는지 빠르게 확인 가능
- ✅ Reset/Continue 회귀를 데모 직전이 아니라 리팩토링 직후 발견 가능

---

## ⚠️ 주의사항 및 고려사항

1. 본 시나리오는 자동화 테스트가 아니라 데모 품질을 위한 수동 절차입니다.
2. 시나리오 6은 개발자 도구 조작이 필요하며, 배포 빌드에는 포함하지 않습니다.

---

## 🔧 실행 가이드

1. RU-004 변경 적용 후 시나리오 1~7을 순서대로 수행
2. 실패 시 “어느 시나리오에서 깨졌는지”를 기록하고, 관련 제안서(S1/S2/Q4/Q1/Q5)로 되돌아가 원인을 추적

---

## 📚 참고 자료

- `vibe/prd.md` 6.6(세이브/로드), 6.9(데모 프로필/리셋)
- `vibe/unit-results/U-015[Mvp].md`
- `vibe/unit-plans/RU-004[Mvp].md`
- (관련) `vibe/unit-runbooks/CP-MVP-02-click-drag-demo-runbook.md` (데모 UX 루프 참고)

---

## 🏷️ 태그

`#refactoring` `#manual-verification` `#medium` `#savegame` `#demo-loop`

---

## 📝 노트

- RU-004의 성공 기준은 “코드가 예쁘다”가 아니라, 심사자가 몇 번 Reset/Continue를 반복해도 **막히지 않는 데모 루프**입니다.

