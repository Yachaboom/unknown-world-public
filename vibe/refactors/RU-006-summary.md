# RU-006[Mvp] 리팩토링 코드 리뷰 요약 보고서

## Executive Summary

### 전반적 평가
RU-006은 **media/artifacts 스토리지 추상화**를 목표로 하며, 현재 U-019(이미지 생성), U-021(스캐너 백엔드), U-022(스캐너 UI) 구현에서 파일 저장 로직이 각 서비스에 산재되어 있습니다. MVP 단계에서 로컬 파일 시스템 기반으로 동작하지만, MMP의 GCS 확장을 대비한 인터페이스 추상화가 필요합니다.

### 핵심 발견사항

**강점**:
- RULE-007(비밀정보 노출 금지), RULE-004(안전 폴백) 원칙이 잘 적용됨
- Mock/Real 모드 하이브리드 패턴이 일관되게 구현됨
- bbox 0~1000 정규화(RULE-009)가 엄격히 준수됨

**개선 필요**:
- 저장 경로/파일명 생성 로직이 여러 서비스에 중복 분산됨
- 파일 크기/타입 제한 검증 로직이 2곳(image_generation, image_understanding)에서 각각 정의됨
- 정적 파일 서빙 경로 하드코딩(`/static/images/`)이 여러 파일에 흩어져 있음

**기술 부채**:
- Scanner에서 업로드된 이미지의 임시 저장 정책 미정의 (메모리 처리 후 폐기)
- `DEFAULT_OUTPUT_DIR` 상수가 services와 api 계층에서 직접 참조됨

### 제안 통계
- **총 제안 수**: 4개
- **Critical**: 0개
- **High**: 2개
- **Medium**: 2개
- **Low**: 0개

### 리팩토링 유닛 우선순위 목록

| 순위 | ID | 심각도 | 카테고리 | 기대효과 요약 |
|:---:|:---|:---:|:---|:---|
| 1 | RU-006-Q4 | High | 모듈 설계 | 스토리지 인터페이스 도입으로 GCS 확장 기반 마련 |
| 2 | RU-006-Q1 | High | 코드 중복 | 파일 검증/제한 로직 중앙화로 일관성 확보 |
| 3 | RU-006-Q5 | Medium | 하드코딩 | 경로/URL 상수 SSOT 단일화로 유지보수성 향상 |
| 4 | RU-006-S1 | Medium | 잠재적 오류 | 업로드 이미지 임시 저장 정책 명확화 |

---

## 비유닛 작업 커밋 메시지 추천

```
docs(vibe): RU-006[Mvp] 스토리지 추상화 리팩토링 제안서 생성

- 이미지 생성/스캐너 저장 로직 분석 및 개선점 도출
- 4개 리팩토링 제안서(Q1, Q4, Q5, S1) 작성
- MMP GCS 확장 대비 스토리지 인터페이스 설계 가이드 포함

**Progress:**
- 유닛: RU-006[Mvp] 분석 완료, 구현 대기
```

---

## 진행 순서 (Execution Order / File-based)

| 순서 | 파일명 | 선행 의존성 | 이유 (1줄) |
|:---:|:---|:---|:---|
| 1 | `vibe/refactors/RU-006-Q4.md` | 없음 | 스토리지 인터페이스가 다른 개선의 기반 |
| 2 | `vibe/refactors/RU-006-Q1.md` | Q4 선행 권장 | 검증 로직을 스토리지 계층에 통합 |
| 3 | `vibe/refactors/RU-006-Q5.md` | Q4 선행 필수 | 경로 상수가 스토리지 인터페이스에 의존 |
| 4 | `vibe/refactors/RU-006-S1.md` | Q4 선행 권장 | 임시 저장 정책이 스토리지 인터페이스 활용 |

---

## 생성된 파일 목록

### 코드 품질 개선 파일
- `vibe/refactors/RU-006-Q1.md` - 파일 검증/제한 로직 중복 제거
- `vibe/refactors/RU-006-Q4.md` - 스토리지 인터페이스 모듈 설계
- `vibe/refactors/RU-006-Q5.md` - 경로/URL 하드코딩 제거

### 안정성 확보 파일
- `vibe/refactors/RU-006-S1.md` - 업로드 이미지 임시 저장 정책 명확화

---

## 카테고리별 분포

### 코드 품질 개선
| 카테고리 | 개수 |
|:---|:---:|
| Q1 - 코드 중복 | 1 |
| Q4 - 모듈 설계 | 1 |
| Q5 - 하드코딩 | 1 |

### 안정성 확보
| 카테고리 | 개수 |
|:---|:---:|
| S1 - 잠재적 오류 | 1 |

---

_본 보고서는 AI Agent에 의해 자동 생성되었습니다._
