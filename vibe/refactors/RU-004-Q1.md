# [ID: RU-004-Q1] ì½”ë“œ ì¤‘ë³µ: SaveGame ìƒì„± ê²½ë¡œ ì´ì›í™”(createSaveGame vs createSaveGameFromProfile)ë¡œ ìŠ¤í‚¤ë§ˆ ë“œë¦¬í”„íŠ¸ ìœ„í—˜

## ğŸ“Œ ê¸°ë³¸ ì •ë³´

| í•­ëª©               | ë‚´ìš©                                                                 |
| ------------------ | -------------------------------------------------------------------- |
| **ID**             | RU-004-Q1                                                            |
| **ì‹¬ê°ë„**         | Medium                                                               |
| **ì¹´í…Œê³ ë¦¬**       | ì½”ë“œ ì¤‘ë³µ (Duplication)                                              |
| **ì˜í–¥ ë²”ìœ„**      | `frontend/src/save/saveGame.ts`, `frontend/src/data/demoProfiles.ts`, (ê°„ì ‘) `frontend/src/App.tsx` |
| **ì˜ˆìƒ ì‘ì—… ì‹œê°„** | 25~60ë¶„                                                              |

---

## ğŸ” ë¬¸ì œì  ìƒì„¸ ë¶„ì„

### í˜„ì¬ ìƒí™©

SaveGameì€ ë‘ ê°œì˜ â€œìƒì„± ê²½ë¡œâ€ë¥¼ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.

1. **ì¼ë°˜ ì €ì¥ ê²½ë¡œ**: `createSaveGame(input: SaveGameInput): SaveGame` (`frontend/src/save/saveGame.ts`)
2. **í”„ë¡œí•„ ì‹œì‘ ê²½ë¡œ**: `createSaveGameFromProfile(profile, language, t): SaveGame` (`frontend/src/data/demoProfiles.ts`)

ë‘ ê²½ë¡œëŠ” ëª¨ë‘ ë™ì¼í•œ ê²°ê³¼ íƒ€ì…(`SaveGame`)ì„ ë§Œë“¤ì–´ ë‚´ì§€ë§Œ, ë°ì´í„° ì¡°ë¦½ ë¡œì§ì´ ë¶„ë¦¬ë˜ì–´ ìˆì–´ **í•„ë“œ ì¶”ê°€/ìˆ˜ì • ì‹œ í•œìª½ë§Œ ì—…ë°ì´íŠ¸ë˜ëŠ” ë“œë¦¬í”„íŠ¸ ìœ„í—˜**ì´ ìˆìŠµë‹ˆë‹¤.

ì˜ˆ: SaveGameì— ìƒˆ í•„ë“œ(ì˜ˆ: memory pins, scene meta ë“±)ë¥¼ ì¶”ê°€í•  ë•Œ

- `SaveGameSchema`ëŠ” ì—…ë°ì´íŠ¸í–ˆëŠ”ë° `createSaveGameFromProfile`ëŠ” ëˆ„ë½
- í˜¹ì€ `createSaveGame`ì€ ì—…ë°ì´íŠ¸í–ˆëŠ”ë° í”„ë¡œí•„ ì‹œì‘ SaveGameì—ëŠ” ëˆ„ë½

ì´ëŠ” â€œí”„ë¡œí•„ ì„ íƒ ì§í›„(í„´ 0)â€ë¶€í„° SaveGame í˜•íƒœê°€ ë‹¤ë¥¸ ë¬¸ì œë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ë¬¸ì œê°€ ë˜ëŠ” ì´ìœ 

1. **ì´ˆê¸° ìƒíƒœ SSOT ì•½í™”(RU-004 ëª©í‘œ ìœ„ë°˜ ìœ„í—˜)**: â€œReset SSOT = í”„ë¡œí•„ ì´ˆê¸° SaveGameâ€ì„ ê³ ì •í•˜ë ¤ë©´, í”„ë¡œí•„ ê²½ë¡œë„ SaveGame SSOT ìƒì„±ê¸°ë¥¼ ê³µìœ í•´ì•¼ í•©ë‹ˆë‹¤.
2. **ìŠ¤í‚¤ë§ˆ ë³€ê²½ ë¹„ìš© ì¦ê°€**: SaveGame êµ¬ì¡°ê°€ ëŠ˜ì–´ë‚ ìˆ˜ë¡ ë‘ ê³³ì„ ë™ì‹œì— ë§ì¶°ì•¼ í•˜ê³ , ëˆ„ë½ ì‹œ ëŸ°íƒ€ì„ì—ì„œë§Œ ë°œê²¬ë©ë‹ˆë‹¤.
3. **migrate/ë²„ì „ ì •ì±…ê³¼ ì¶©ëŒ ê°€ëŠ¥**: ìƒì„± ê²½ë¡œê°€ ë¶„ì‚°ë˜ë©´ â€œë²„ì „/ê¸°ë³¸ê°’/ëˆ„ë½ í•„ë“œ ë³´ì •â€ ì •ì±…ì´ í•œ ê³³ì—ì„œ ì¼ê´€ë˜ê²Œ ì ìš©ë˜ê¸° ì–´ë µìŠµë‹ˆë‹¤.

### ì˜í–¥ë°›ëŠ” ì½”ë“œ ìœ„ì¹˜

- `frontend/src/save/saveGame.ts`
  - `SaveGameSchema`, `createSaveGame`, (í–¥í›„) migrate/hydrate ì •ì±…
- `frontend/src/data/demoProfiles.ts`
  - `createSaveGameFromProfile`ì—ì„œ SaveGame êµ¬ì¡°ë¥¼ ì§ì ‘ ì¡°ë¦½

---

## ğŸ’¡ ê°œì„  ë°©ì•ˆ

### ì œì•ˆí•˜ëŠ” ì ‘ê·¼ë²•

**SaveGame ìƒì„±ì€ í•œ ê³³(`createSaveGame`)ì—ì„œë§Œ ìˆ˜í–‰**í•˜ê³ , ë‹¤ë¥¸ ëª¨ë“  ê²½ë¡œëŠ” â€œì…ë ¥ ë³€í™˜(input adapter)â€ë§Œ ë‹´ë‹¹í•˜ë„ë¡ ë°”ê¿‰ë‹ˆë‹¤.

ê¶Œì¥ êµ¬ì¡°:

- `createSaveGame(input)` = SaveGame ìƒì„± SSOT
- `profileToSaveGameInput(profile, language, t)` = í”„ë¡œí•„ ì´ˆê¸° ìƒíƒœë¥¼ SaveGameInputìœ¼ë¡œ ë³€í™˜
- `createSaveGameFromProfile`ëŠ” deprecated(ë˜ëŠ” ì–‡ì€ wrapper)ë¡œ ìœ ì§€ ê°€ëŠ¥

### êµ¬ì²´ì  ì‹¤í–‰ ë‹¨ê³„

#### Step 1: í”„ë¡œí•„ â†’ SaveGameInput ë³€í™˜ í•¨ìˆ˜ ë„ì…

ì˜ˆì‹œ(ê°œë…):

```ts
// demoProfiles.ts (ê°œë… ì˜ˆì‹œ)
export function profileToSaveGameInput(
  profile: DemoProfile,
  language: SupportedLanguage,
  t: (key: string) => string,
): SaveGameInput {
  const now = Date.now();
  return {
    language,
    profileId: profile.id,
    seed: `demo-${profile.id}-${now}`,
    economy: profile.initialState.economy,
    economyLedger: [],
    turnCount: 0,
    narrativeHistory: [{ turn: 0, text: t(profile.initialState.welcomeMessageKey) }],
    inventory: profile.initialState.inventoryDefs.map((item) => ({
      id: item.id,
      name: t(item.nameKey),
      icon: item.icon,
      quantity: item.quantity,
    })),
    quests: profile.initialState.questDefs.map((q) => ({
      id: q.id,
      label: t(q.labelKey),
      is_completed: q.is_completed,
    })),
    activeRules: profile.initialState.ruleDefs.map((r) => ({
      id: r.id,
      label: t(r.labelKey),
      description: r.descriptionKey ? t(r.descriptionKey) : null,
    })),
    mutationTimeline: /* ë™ì¼ ê·œì¹™ìœ¼ë¡œ ìƒì„± */,
    sceneObjects: /* ë™ì¼ ê·œì¹™ìœ¼ë¡œ ìƒì„± */,
  };
}
```

#### Step 2: `createSaveGameFromProfile`ë¥¼ wrapperë¡œ ë‹¨ìˆœí™”

```ts
export function createSaveGameFromProfile(profile, language, t): SaveGame {
  return createSaveGame(profileToSaveGameInput(profile, language, t));
}
```

#### Step 3: SaveGame í•„ë“œ í™•ì¥ ì‹œ â€œí•œ ê³³ë§Œ ìˆ˜ì •â€í•˜ë„ë¡ ê·œì¹™ ê³ ì •

- SaveGame êµ¬ì¡° ë³€ê²½(í•„ë“œ ì¶”ê°€/ì‚­ì œ/ê¸°ë³¸ê°’ ë³€ê²½)ì€ `save/saveGame.ts`ë§Œ SSOTë¡œ ì·¨ê¸‰
- í”„ë¡œí•„ì€ â€œì´ˆê¸° ì…ë ¥ ìƒì„±â€ë§Œ ë‹´ë‹¹

### ëŒ€ì•ˆì  ì ‘ê·¼ë²• (ì„ íƒì‚¬í•­)

- **ëŒ€ì•ˆ 1**: `createSaveGameFromProfile`ë¥¼ SSOTë¡œ ë‘ê³  `createSaveGame`ì„ wrapperë¡œ ë§Œë“¤ê¸°  
  - ì¥ì : í”„ë¡œí•„ ì¤‘ì‹¬ ì„¤ê³„
  - ë‹¨ì : autosave ê²½ë¡œê°€ ì…ë ¥ ë³€í™˜ì„ ë” ë§ì´ í•„ìš”ë¡œ í•¨(ìŠ¤í† ì–´ â†’ input ë³€í™˜ì´ ë” ë³µì¡)

---

## ğŸ“ˆ ê¸°ëŒ€ íš¨ê³¼

### ì¦‰ê°ì  íš¨ê³¼

- âœ… SaveGame êµ¬ì¡° ë³€ê²½ ì‹œ ìˆ˜ì • ì§€ì ì´ 1ê³³ìœ¼ë¡œ ê³ ì •ë˜ì–´ ë“œë¦¬í”„íŠ¸ ìœ„í—˜ ê°ì†Œ
- âœ… RU-004ì˜ â€œReset SSOT = í”„ë¡œí•„ ì´ˆê¸° SaveGameâ€ ì •í•©ì„±ì´ ê°•í™”

### ì¥ê¸°ì  íš¨ê³¼

- ğŸ¯ SaveGame ë§ˆì´ê·¸ë ˆì´ì…˜/ê¸°ë³¸ê°’ ì •ì±…ì„ `saveGame.ts` ì¤‘ì‹¬ìœ¼ë¡œ ì¼ê´€ë˜ê²Œ ìœ ì§€ ê°€ëŠ¥

---

## âš ï¸ ì£¼ì˜ì‚¬í•­ ë° ê³ ë ¤ì‚¬í•­

### ë¦¬íŒ©í† ë§ ì‹œ ì£¼ì˜í•  ì 

1. í”„ë¡œí•„ ì‹œì‘ SaveGameì´ â€œí„´ 0â€ì—ì„œ ì´ë¯¸ í•„ìš”í•œ í•„ë“œë¥¼ ëª¨ë‘ ê°–ì¶”ë„ë¡(quests/rules/sceneObjects ë“±) input ë³€í™˜ì„ ê¼¼ê¼¼íˆ ë§ì¶°ì•¼ í•©ë‹ˆë‹¤.
2. ì´ ë³€ê²½ì€ â€œì¶œë ¥ JSON êµ¬ì¡°â€ ìì²´ë¥¼ ë°”ê¾¸ì§€ ì•Šê³ , ìƒì„± ë¡œì§ë§Œ í†µí•©í•˜ëŠ” ê²ƒì´ ëª©ì ì…ë‹ˆë‹¤.

### í˜¸í™˜ì„± ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] í”„ë¡œí•„ ì„ íƒ ì§í›„ SaveGameì˜ í•„ë“œë“¤ì´ ê¸°ì¡´ê³¼ ë™ì¼í•œê°€?
- [ ] autosaveë¡œ ìƒì„±ë˜ëŠ” SaveGameê³¼ í”„ë¡œí•„ start SaveGameì˜ êµ¬ì¡°ê°€ ë™ì¼í•œê°€?

---

## ğŸ§ª ê²€ì¦ ë°©ë²• (ìˆ˜ë™ ê²€ì¦ ì¤‘ì‹¬)

- í”„ë¡œí•„ ì„ íƒ í›„ ì¦‰ì‹œ ìƒˆë¡œê³ ì¹¨ â†’ Continue â†’ ì •ìƒ ë³µì›
- Reset í›„ ì¦‰ì‹œ ìƒˆë¡œê³ ì¹¨ â†’ Continue â†’ ì •ìƒ ë³µì›

> ìƒì„¸ëŠ” `RU-004-S3.md`ë¥¼ ì°¸ì¡°í•©ë‹ˆë‹¤.

---

## ğŸ”§ ì‹¤í–‰ ê°€ì´ë“œ

1. `demoProfiles.ts`ì— profileâ†’input ë³€í™˜ í•¨ìˆ˜ ì¶”ê°€
2. `createSaveGameFromProfile`ë¥¼ wrapperë¡œ ì¶•ì†Œ(ë˜ëŠ” ì œê±°)
3. App/ì„¸ì…˜ ëª¨ë“ˆì´ `createSaveGameFromProfile` ëŒ€ì‹  `createSaveGame(profileToSaveGameInput(...))`ë¥¼ ì‚¬ìš©í•˜ë„ë¡ ì •ë¦¬

---

## ğŸ“š ì°¸ê³  ìë£Œ

- `vibe/unit-plans/RU-004[Mvp].md` (ì´ˆê¸° ìƒíƒœ SSOT, ì¤‘ë³µ ì œê±°)
- `frontend/src/save/saveGame.ts`
- `frontend/src/data/demoProfiles.ts`

---

## ğŸ·ï¸ íƒœê·¸

`#refactoring` `#duplication` `#medium` `#savegame` `#ssot`

---

## ğŸ“ ë…¸íŠ¸

- ë³¸ ì œì•ˆì€ ì½”ë“œ ë¼ì¸ ìˆ˜ë¥¼ ì¤„ì´ëŠ” ê²ƒ ìì²´ë³´ë‹¤, â€œSaveGame ë³€ê²½ ì‹œ ì‹¤ìˆ˜ ê°€ëŠ¥ì„±â€ì„ ë‚®ì¶”ëŠ” ê²ƒì´ í•µì‹¬ì…ë‹ˆë‹¤.

