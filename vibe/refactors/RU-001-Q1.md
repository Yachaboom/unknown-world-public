# [ID: RU-001-Q1] 실행 방법/문서/설정의 중복과 불일치 제거 (roadmap vs 코드 주석 vs 루트 스크립트 vs Pyright 설정)

## 📌 기본 정보

| 항목               | 내용                     |
| ------------------ | ------------------------ |
| **ID**             | RU-001-Q1                |
| **심각도**         | High                     |
| **카테고리**       | 코드 중복 (Duplication)  |
| **영향 범위**      | `vibe/roadmap.md`, `backend/src/unknown_world/main.py`, `package.json`, `backend/pyproject.toml`, `backend/pyrightconfig.json` |
| **예상 작업 시간** | 30~60분                  |

---

## 🔍 문제점 상세 분석

### 현재 상황

현재 레포에는 “실행 방법”과 “툴 설정”이 여러 군데에 흩어져 있으며, 일부는 서로 모순됩니다.

- `vibe/roadmap.md`의 **빠른 실행**은 `venv + pip + requirements.txt` 및 `--port 8000` 예시를 포함합니다.
- 백엔드 엔트리포인트(`backend/src/unknown_world/main.py`) docstring의 실행 예시는 `uvicorn ... --reload`만 제시되어 기본 포트(8000)로 해석될 수 있습니다.
- 반면 루트 `package.json`은 백엔드를 `--port 8011`로 실행하도록 표준화했습니다.
- Pyright 설정은 `backend/pyproject.toml`와 `backend/pyrightconfig.json`에 **중복**되어 있으며, include 범위가 다릅니다.

이 불일치는 RU-001 목표(“경로/버전/실행 방식의 흔들림 제거”)와 RULE-011(포트 정책), RULE-010(표준 고정) 관점에서 High 리스크입니다.

### 문제가 되는 이유

1. **RULE-011 위반 유도**: 문서/주석이 8000 포트를 유도하면 CORS/연동이 어긋나고 디버깅 비용이 폭증합니다.
2. **팀 표준이 깨짐**: 루트 스크립트/로드맵/주석이 서로 다르면, 신규 유닛(U-005~U-008)에서 실행 환경이 분기됩니다.
3. **Pyright 결과가 실행 위치에 따라 달라질 수 있음**: config가 중복이고 include가 다르면 “왜 어떤 파일은 검사되고 어떤 파일은 안 되는지”가 불명확해집니다.

### 영향받는 코드 위치

- 파일: `vibe/roadmap.md`
  - 라인: 185-199 (“빠른 실행” 섹션)
- 파일: `backend/src/unknown_world/main.py`
  - 라인: 6-9 (docstring 실행 예시)
- 파일: `package.json`
  - 라인: 8-13 (dev 스크립트/포트)
- 파일: `backend/pyproject.toml`
  - 라인: 61-64 (`[tool.pyright]`)
- 파일: `backend/pyrightconfig.json`
  - 라인: 1-4 (`include: ["."]`)

### 현재 코드 예시

```markdown
# vibe/roadmap.md (발췌)
uvicorn unknown_world.main:app --reload --port 8000
```

```python
# backend/src/unknown_world/main.py (발췌)
실행 방법:
    cd backend
    uvicorn unknown_world.main:app --reload
```

```json
// package.json (발췌)
"dev:back": "cd backend && uv run uvicorn unknown_world.main:app --reload --port 8011"
```

---

## 💡 개선 방안

### 제안하는 접근법

**“실행/설정의 단일 출처(SSOT)”를 정하고, 나머지는 그 SSOT를 참조하게 만듭니다.**

권장 SSOT:

- **실행 커맨드 SSOT**: 루트 `package.json` 스크립트
- **문서 SSOT(빠른 실행)**: `vibe/roadmap.md`는 위 스크립트를 그대로 안내
- **툴 설정 SSOT**: Pyright는 한 곳(`pyrightconfig.json` 또는 `pyproject.toml`)으로 통일

### 구체적 실행 단계

#### Step 1: `vibe/roadmap.md` “빠른 실행”을 현재 구조(uv, 포트 정책)에 맞게 정리

**변경 전(문제 예시):**

```bash
# Backend (예시: venv + pip)
python -m venv .venv
source .venv/Scripts/activate
pip install -r backend/requirements.txt
uvicorn unknown_world.main:app --reload --port 8000
```

**변경 후(권장):**

```bash
# Frontend (RULE-011: 8001~8010)
pnpm -C frontend install
pnpm -C frontend dev

# Backend (uv 기반, RULE-011: 8011~8020)
cd backend
uv sync
uv run uvicorn unknown_world.main:app --reload --port 8011
```

> 주의: `frontend/vite.config.ts`가 기본 포트 8001을 사용하도록 설정되어 있으므로, roadmap에는 “8001에서 뜬다”를 명시합니다.

#### Step 2: `backend/src/unknown_world/main.py` docstring 실행 예시를 루트 스크립트/포트 정책과 일치

**변경 전:**

```python
실행 방법:
    cd backend
    uvicorn unknown_world.main:app --reload
```

**변경 후:**

```python
실행 방법:
    cd backend
    uv sync
    uv run uvicorn unknown_world.main:app --reload --port 8011
```

#### Step 3: 루트 `package.json`의 프론트 실행을 `pnpm -C`로 통일 (경로/쉘 의존성 감소)

**변경 전:**

```json
"dev:front": "cd frontend && pnpm dev"
```

**변경 후:**

```json
"dev:front": "pnpm -C frontend dev"
```

#### Step 4: Pyright 설정을 단일화 (중복/불일치 제거)

권장안(둘 중 하나를 선택):

- **Option A(권장)**: `backend/pyrightconfig.json`만 SSOT로 사용하고 `pyproject.toml`의 `[tool.pyright]` 제거
  - 이유: IDE/CI에서 `pyrightconfig.json`을 가장 표준적으로 인식
- **Option B**: `pyproject.toml`만 SSOT로 사용하고 `backend/pyrightconfig.json` 제거

추가로, include 범위를 명확히 권장:

- MVP 기준으로는 **`src`만** 포함(테스트는 필요 시 별도)

### 대안적 접근법 (선택사항)

- **대안 1(최소 변경)**: 문서(`vibe/roadmap.md`)만 최신화하고, 코드 주석/스크립트는 그대로 둠
  - 장점: 변경량 최소
  - 단점: 시간이 지나면 주석/스크립트가 다시 분기되어 drift 재발 가능
- **대안 2(강경 SSOT)**: `vibe/roadmap.md`에서 “빠른 실행”을 삭제하고 루트 스크립트만 안내
  - 장점: SSOT를 강제할 수 있음(복사/붙여넣기 방지)
  - 단점: 문서가 너무 불친절해질 수 있어, 최소한의 예시는 남기는 편이 현실적
- **대안 3(추가 도구 도입)**: `justfile`/`Makefile` 등으로 실행 표준을 추가
  - 장점: 명령 표준화 강화
  - 단점: RU-001 범위를 넘어설 수 있음(팀 도구 합의 필요)

---

## 📈 기대 효과

### 즉각적 효과

- ✅ 문서/주석/스크립트가 동일한 실행 커맨드와 포트를 안내 → 온보딩/디버깅 비용 급감
- ✅ RULE-011 포트 정책의 “문서 유도 위반” 제거
- ✅ Pyright 검사 범위가 일관되어 “환경에 따라 결과가 달라짐” 문제 감소

### 장기적 효과

- 🎯 U-005~U-008에서 스키마/스트리밍 구현에 집중 가능(실행 환경 혼란 제거)
- 🎯 RU 계열 리팩토링이 “설정 정리 vs 기능 추가” 경계를 유지하기 쉬워짐

### 정량적 개선 (가능한 경우)

| 지표                         | 현재                 | 개선 후                       | 변화율 |
| ---------------------------- | -------------------- | ----------------------------- | ------ |
| 신규 개발자 실행 성공 시간   | 편차 큼              | 루트 스크립트 기반으로 고정   | ↓      |
| 포트/CORS 관련 이슈 재발률   | 문서/주석 때문에 재발 | 정책(8011/8001) 일관 안내     | ↓      |

---

## ⚠️ 주의사항 및 고려사항

### 리팩토링 시 주의할 점

1. roadmap의 “빠른 실행”은 자주 복사/붙여넣기 되므로, 반드시 최신화 후 유지해야 합니다.
2. Pyright 설정 단일화는 IDE 설정과 충돌 가능성이 있으므로, 선택한 SSOT를 명시해야 합니다.
3. Windows 환경(RU-001 사용자 환경)에서 `cd`/쉘 차이를 줄이기 위해 `pnpm -C`를 권장합니다.

### 영향받는 다른 모듈

- **U-003 런북/문서**: 실행 가이드와 충돌 시 업데이트 필요
- **U-004 런북/문서**: 프론트 실행 포트 안내와 정합성 필요

### 호환성 체크리스트

- [ ] 기존 루트 스크립트로 프론트/백엔드가 정상 실행되는가?
- [ ] 프론트 8001, 백엔드 8011 정책이 문서/주석/스크립트에서 일치하는가?
- [ ] Pyright가 같은 범위를 검사하는가(실행 위치/IDE 상관없이)?

---

## 🧪 검증 방법 (수동 검증 중심)

### 변경 전 확인 사항

1. `vibe/roadmap.md`의 빠른 실행을 그대로 따라 했을 때 8000으로 백엔드가 떠서 혼선이 생기는지 확인
2. Pyright 실행 위치에 따라 include 범위가 달라지는지 확인(backend 루트 vs repo 루트)

### 변경 후 검증 시나리오

#### 시나리오 1: 문서/스크립트대로 실행했을 때 같은 결과가 나는지

- **실행 방법**:

```bash
pnpm dev:front
pnpm dev:back
```

- **기대 결과**:
  - 프론트가 `http://localhost:8001`에서 접근 가능
  - 백엔드 `http://localhost:8011/health`가 정상 응답

#### 시나리오 2: Pyright 설정 단일화 후 검사 범위 일관성 확인

- **실행 방법**:
  - IDE에서 backend 파일 열기 → pyright 진단 범위 확인
  - CLI에서 `cd backend && uv run pyright` 실행(팀 표준 커맨드로 고정)

- **기대 결과**:
  - 검사 대상이 의도한 범위(`src`)로 고정

### 회귀 확인 체크리스트

- [ ] 기존 실행 커맨드가 깨지지 않았는가?
- [ ] 문서/주석이 오래된 안내로 되돌아가지 않았는가?

---

## 🔧 실행 가이드

### 개발자를 위한 실행 지침

1. **준비 사항**
   - RULE-011(포트 정책), U-003 결과(uv 사용), 현재 루트 스크립트 확인

2. **실행 절차**

```bash
# 문서(roadmap)와 주석(main.py), 루트 scripts를 함께 정합화
# 변경 후에는 루트 scripts만 보고도 실행 가능해야 함
pnpm dev:front
pnpm dev:back
```

3. **검증 절차**
   - 브라우저로 8001 접근
   - `/health`(8011) 응답 확인

4. **롤백 계획** (필요시)
   - 문서/주석 변경은 쉽게 되돌릴 수 있음
   - 스크립트 변경은 `git checkout package.json`로 복구 가능

### 예상 소요 시간

- 문서/주석/스크립트 정리: 20~40분
- 수동 검증: 10~20분
- 총 예상 시간: 30~60분

---

## 📚 참고 자료

- `vibe/roadmap.md` (빠른 실행 섹션)
- `backend/src/unknown_world/main.py` (docstring)
- `.cursor/rules/00-core-critical.mdc` (RULE-010/011)
- `vibe/unit-results/U-003[Mvp].md` (uv 기반)

---

## 🏷️ 태그

`#refactoring` `#code-quality` `#duplication` `#docs` `#ports` `#tooling`

---

## 📝 노트

- RU-001의 “설정 정리”는 이후 유닛의 개발 속도를 좌우합니다. 기능 추가보다 **정합성(일관된 실행 경험)** 자체가 성능입니다.


