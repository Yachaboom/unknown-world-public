# [ID: RU-003-Q1] DnD/Turn ì´ë²¤íŠ¸ ì¤‘ë³µ ì œê±°: drag/drop íƒ€ì… ìƒìˆ˜í™” + ê³µí†µ ë°ì´í„° êµ¬ì¡° ì •ë¦¬

## ğŸ“Œ ê¸°ë³¸ ì •ë³´

| í•­ëª©               | ë‚´ìš©                |
| ------------------ | ------------------- |
| **ID**             | RU-003-Q1           |
| **ì‹¬ê°ë„**         | Medium              |
| **ì¹´í…Œê³ ë¦¬**       | ì½”ë“œ ì¤‘ë³µ (Duplication) |
| **ì˜í–¥ ë²”ìœ„**      | `frontend/src/App.tsx`, `frontend/src/components/InventoryPanel.tsx`, `frontend/src/components/SceneCanvas.tsx`, (ì°¸ì¡°) `frontend/src/stores/inventoryStore.ts`, (ê°„ì ‘) `frontend/src/components/DndInteraction.test.tsx` |
| **ì˜ˆìƒ ì‘ì—… ì‹œê°„** | 20~40ë¶„             |

---

## ğŸ” ë¬¸ì œì  ìƒì„¸ ë¶„ì„

### í˜„ì¬ ìƒí™©

DnD(Inventory â†’ Hotspot) íë¦„ì—ì„œ â€œë“œë˜ê·¸/ë“œë¡­ ë°ì´í„°ì˜ íƒ€ì…ê³¼ êµ¬ì¡°â€ê°€ ì—¬ëŸ¬ íŒŒì¼ì— **ë¬¸ìì—´/shapeë¡œ ì¤‘ë³µ**ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

- ë“œë˜ê·¸ íƒ€ì… ë¬¸ìì—´:
  - `'inventory-item'` (`App.tsx` 526/547, `InventoryPanel.tsx` 48)
- ë“œë¡­ íƒ€ì… ë¬¸ìì—´:
  - `'hotspot'` (`App.tsx` 556, `SceneCanvas.tsx` 112)
- ë“œë¡­ íƒ€ê²Ÿ ë°ì´í„° êµ¬ì¡°:
  - `{ type, object_id, box_2d, label }`ê°€ `SceneCanvas.tsx`ì— ì •ì˜ë˜ê³ , `App.tsx`ê°€ ì´ë¥¼ ì•”ë¬µì ìœ¼ë¡œ ê°€ì •í•´ ì‚¬ìš©

### ë¬¸ì œê°€ ë˜ëŠ” ì´ìœ 

1. **ë“œë¦¬í”„íŠ¸ ìœ„í—˜**: ë¬¸ìì—´/í•„ë“œëª…ì´ í•œ êµ°ë°ë§Œ ë°”ë€Œì–´ë„ ëŸ°íƒ€ì„ì—ì„œ ì¡°ìš©íˆ ê¹¨ì§‘ë‹ˆë‹¤(â€œë“œë¡­ì´ ë¬´ë°˜ì‘â€ ê°™ì€ ë°ëª¨ ì¹˜ëª…ì  ì¦ìƒ).  
2. **ê²½ê³„ ë¶ˆëª…í™•**: DnD ë°ì´í„° ê³„ì•½ì´ â€œì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ êµ¬í˜„ ë””í…Œì¼â€ì²˜ëŸ¼ í©ì–´ì ¸ ìˆì–´, RU-003ì˜ ëª©í‘œ(ê²½ê³„/ì¤‘ë³µ ì •ë¦¬)ë¥¼ ë°©í•´í•©ë‹ˆë‹¤.  
3. **íƒ€ì… ì•ˆì „ì„± ë¶€ì¡±**: `active.data.current` / `over.data.current`ë¥¼ `any`ì²˜ëŸ¼ ì‚¬ìš©í•˜ë©´, ì´í›„ í™•ì¥(Scanner drop, multi-target ë“±) ì‹œ ì•ˆì •ì„±ì´ ë–¨ì–´ì§‘ë‹ˆë‹¤.

### ì˜í–¥ë°›ëŠ” ì½”ë“œ ìœ„ì¹˜

- `frontend/src/components/InventoryPanel.tsx`: `useDraggable` dataì— `{ type: 'inventory-item', item_id: ... }` (`48~53`)
- `frontend/src/components/SceneCanvas.tsx`: `useDroppable` dataì— `{ type: 'hotspot', object_id, box_2d, label }` (`109~118`)
- `frontend/src/App.tsx`: ë¬¸ìì—´ ë¹„êµ ë° í•„ë“œ ì ‘ê·¼ (`526~587`)

### í˜„ì¬ ì½”ë“œ ì˜ˆì‹œ

```ts
// InventoryPanel.tsx
data: {
  type: 'inventory-item',
  item_id: item.id,
  item,
}
```

```ts
// SceneCanvas.tsx
data: {
  type: 'hotspot',
  object_id: object.id,
  box_2d: object.box_2d,
  label: object.label,
}
```

---

## ğŸ’¡ ê°œì„  ë°©ì•ˆ

### ì œì•ˆí•˜ëŠ” ì ‘ê·¼ë²•

DnD ë°ì´í„° ê³„ì•½ì„ â€œì‘ì€ SSOT ëª¨ë“ˆâ€ë¡œ ë¶„ë¦¬í•´, ëª¨ë“  ì‚¬ìš©ì²˜ê°€ **ë™ì¼ ìƒìˆ˜/ë™ì¼ íƒ€ì…**ì„ ì“°ë„ë¡ ê³ ì •í•©ë‹ˆë‹¤.

ê¶Œì¥ ì‹ ê·œ íŒŒì¼:

- `frontend/src/dnd/types.ts` (ë˜ëŠ” `frontend/src/types/dnd.ts`)
  - `DND_TYPE` ìƒìˆ˜
  - `InventoryDragData`, `HotspotDropData` íƒ€ì…
  - `isInventoryDragData(...)`, `isHotspotDropData(...)` íƒ€ì… ê°€ë“œ(ì„ íƒ)

### êµ¬ì²´ì  ì‹¤í–‰ ë‹¨ê³„

#### Step 1: DnD íƒ€ì…/ë°ì´í„° ê³„ì•½ì„ ìƒìˆ˜+íƒ€ì…ìœ¼ë¡œ ì •ì˜

```ts
// frontend/src/dnd/types.ts (ê°œë… ì˜ˆì‹œ)
import type { Box2D } from '../schemas/turn';
import type { InventoryItem } from '../stores/inventoryStore';

export const DND_TYPE = {
  INVENTORY_ITEM: 'inventory-item',
  HOTSPOT: 'hotspot',
} as const;

export type DndType = (typeof DND_TYPE)[keyof typeof DND_TYPE];

export type InventoryDragData = {
  type: typeof DND_TYPE.INVENTORY_ITEM;
  item_id: string;
  item: InventoryItem;
};

export type HotspotDropData = {
  type: typeof DND_TYPE.HOTSPOT;
  object_id: string;
  box_2d: Box2D;
  label: string;
};
```

#### Step 2: InventoryPanel/SceneCanvasì—ì„œ ìƒìˆ˜/íƒ€ì… ì‚¬ìš©

- `InventoryPanel.tsx`: `type: DND_TYPE.INVENTORY_ITEM`
- `SceneCanvas.tsx`: `type: DND_TYPE.HOTSPOT`

#### Step 3: App.tsxì—ì„œ ë¬¸ìì—´ ë¹„êµ/í•„ë“œ ì ‘ê·¼ì„ íƒ€ì… ê°€ë“œë¡œ ì¹˜í™˜

í˜„ì¬ëŠ” ì•„ë˜ì²˜ëŸ¼ â€œë¬¸ìì—´ ë¹„êµ + ì„ì˜ í•„ë“œ ì ‘ê·¼â€ì¸ë°:

```ts
if (activeData?.type !== 'inventory-item') return;
const itemId = activeData.item_id as string;
```

ê¶Œì¥ í˜•íƒœëŠ”:

- `active.data.current`ê°€ `InventoryDragData`ì¸ì§€ í™•ì¸
- `over.data.current`ê°€ `HotspotDropData`ì¸ì§€ í™•ì¸

ì¶”ê°€ ê°œì„ (ì¤‘ë³µ ì œê±°):

- `inventoryStore.findItemById` ìœ í‹¸ì„ `App.tsx`ì—ì„œ ì‚¬ìš©í•´ `items.find(...)` ì¤‘ë³µ ì œê±°

---

## ğŸ“ˆ ê¸°ëŒ€ íš¨ê³¼

### ì¦‰ê°ì  íš¨ê³¼

- âœ… â€œë“œë¡­ ë¬´ë°˜ì‘â€ë¥˜ì˜ ëŸ°íƒ€ì„ ê¹¨ì§ì„ íƒ€ì…/ìƒìˆ˜ ë ˆë²¨ì—ì„œ ì˜ˆë°©
- âœ… DnD ê³„ì•½ì´ í•œ êµ°ë°ì— ëª¨ì—¬ ìœ ì§€ë³´ìˆ˜ ë¹„ìš© ê°ì†Œ

### ì¥ê¸°ì  íš¨ê³¼

- ğŸ¯ Scanner drop, multi-target ë“± í™•ì¥ ì‹œì—ë„ ë°ì´í„° ê³„ì•½ ë“œë¦¬í”„íŠ¸ ë°©ì§€

---

## âš ï¸ ì£¼ì˜ì‚¬í•­ ë° ê³ ë ¤ì‚¬í•­

- DnD ë°ì´í„° ê³„ì•½ ë¶„ë¦¬ëŠ” **ê¸°ëŠ¥ ì¶”ê°€ê°€ ì•„ë‹ˆë¼ â€˜ë™ì¼ ë™ì‘ì„ ë” ì•ˆì „í•˜ê²Œâ€™** ë§Œë“œëŠ” ë¦¬íŒ©í† ë§ì…ë‹ˆë‹¤.
- ë‹¨ì¼ íŒŒì¼ì— íƒ€ì…/ìƒìˆ˜ë§Œ ë‘ê³ , ë¡œì§ì€ App/ì»´í¬ë„ŒíŠ¸ì— ë‚¨ê²¨ â€œê³¼ë„í•œ ì¶”ìƒí™”â€ë¥¼ í”¼í•©ë‹ˆë‹¤( RU-003 ì£¼ì˜ì‚¬í•­ ì¤€ìˆ˜ ).

---

## ğŸ§ª ê²€ì¦ ë°©ë²• (ìˆ˜ë™ ê²€ì¦ ì¤‘ì‹¬)

- ì¸ë²¤í† ë¦¬ ì•„ì´í…œì„ ë“œë˜ê·¸í•´ í•«ìŠ¤íŒŸ ìœ„ë¡œ ì˜¬ë ¸ì„ ë•Œ í•˜ì´ë¼ì´íŠ¸ê°€ ìœ ì§€ë˜ëŠ”ì§€ í™•ì¸
- í•«ìŠ¤íŒŸì— ë“œë¡­ ì‹œ í„´ ì‹¤í–‰ì´ íŠ¸ë¦¬ê±°ë˜ëŠ”ì§€ í™•ì¸
- ìœ íš¨í•˜ì§€ ì•Šì€ ì˜ì—­ ë“œë¡­ ì‹œ ì¦‰ì‹œ í”¼ë“œë°±ì´ ì¶œë ¥ë˜ëŠ”ì§€ í™•ì¸

---

## ğŸ”§ ì‹¤í–‰ ê°€ì´ë“œ

1. `frontend/src/dnd/types.ts` ìƒì„±
2. `InventoryPanel.tsx` / `SceneCanvas.tsx` / `App.tsx`ì—ì„œ ë¬¸ìì—´/í•„ë“œ ì ‘ê·¼ì„ ìƒìˆ˜/íƒ€ì… ê¸°ë°˜ìœ¼ë¡œ ì¹˜í™˜
3. `RU-003-S3` ìˆ˜ë™ ì‹œë‚˜ë¦¬ì˜¤ë¡œ íšŒê·€ í™•ì¸

---

## ğŸ“š ì°¸ê³  ìë£Œ

- `vibe/unit-results/U-011[Mvp].md`, `vibe/unit-results/U-012[Mvp].md` (DnD ê³„ì•½ ë° ë“œë¡­ ì´ë²¤íŠ¸ íë¦„)
- `frontend/src/components/SceneCanvas.tsx`, `frontend/src/components/InventoryPanel.tsx`, `frontend/src/App.tsx`

---

## ğŸ·ï¸ íƒœê·¸

`#refactoring` `#duplication` `#medium` `#dnd-kit` `#contract`

