# U-075 ì•„ì´í…œ ì•„ì´ì½˜ ë™ì  ìƒì„± ì‹¤í–‰ ê°€ì´ë“œ

## 1. ê°œìš”

ì¸ë²¤í† ë¦¬ ì•„ì´í…œ íšë“ ì‹œ **ì•„ì´í…œ ì„¤ëª…ì„ ê¸°ë°˜ìœ¼ë¡œ 64x64 í”½ì…€ ì•„íŠ¸ ì•„ì´ì½˜ì„ ë™ì  ìƒì„±**í•˜ëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤. rembg ë°°ê²½ ì œê±°, ìºì‹±, í˜„ì¬ ì–¸ì–´ ê¸°ë°˜ ì´ë¦„ ì •í•©ì„±ì„ ë³´ì¥í•©ë‹ˆë‹¤.

**í˜ì–´ë§ ì§ˆë¬¸ ê²°ì •**:
- Q1: **Option B** - placeholder ë¨¼ì € í‘œì‹œ í›„ ë°±ê·¸ë¼ìš´ë“œ ìƒì„±
- Q2: **Option A** - 64x64 í”½ì…€
- Q3: **Option A** - í”½ì…€ ì•„íŠ¸ ìŠ¤íƒ€ì¼ (CRT í…Œë§ˆ)

**ì˜ˆìƒ ì†Œìš” ì‹œê°„**: 10ë¶„

**ì˜ì¡´ì„±**:
- ì˜ì¡´ ìœ ë‹›: U-011[Mvp] (Inventory íŒ¨ë„), U-035[Mvp] (rembg ë°°ê²½ ì œê±°)
- ì„ í–‰ ì™„ë£Œ í•„ìš”: ë°±ì—”ë“œ ì„œë²„ ì‹¤í–‰ ì¤‘

---

## 2. ë¹ ë¥¸ ì‹œì‘ (Quick Start)

### 2.1 í™˜ê²½ ì¤€ë¹„

```bash
# ë°±ì—”ë“œ ì˜ì¡´ì„± ì„¤ì¹˜
cd backend
uv sync

# í”„ë¡ íŠ¸ì—”ë“œ ì˜ì¡´ì„± ì„¤ì¹˜
cd ../frontend
pnpm install
```

### 2.2 í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

ë°±ì—”ë“œ `.env` íŒŒì¼ í™•ì¸:

```bash
# backend/.env
UW_MODE=mock  # ë˜ëŠ” real (ì‹¤ì œ Gemini API ì‚¬ìš© ì‹œ)
GOOGLE_API_KEY=your_api_key_here  # real ëª¨ë“œì—ì„œ í•„ìš”
```

### 2.3 ì„œë²„ ì‹¤í–‰

```bash
# í„°ë¯¸ë„ 1: ë°±ì—”ë“œ ì„œë²„
cd backend
uv run uvicorn unknown_world.main:app --reload --port 8011

# í„°ë¯¸ë„ 2: í”„ë¡ íŠ¸ì—”ë“œ ì„œë²„
cd frontend
pnpm dev
```

### 2.4 ì²« í™”ë©´ í™•ì¸

- ë¸Œë¼ìš°ì €ì—ì„œ `http://localhost:8001` ì ‘ì†
- ì¸ë²¤í† ë¦¬ íŒ¨ë„ì´ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸
- ì„±ê³µ ì§€í‘œ: ì¸ë²¤í† ë¦¬ ì˜ì—­ì´ "ê²Œì„ UI"ë¡œ ë³´ì„

---

## 3. í•µì‹¬ ê¸°ëŠ¥ ì‹œë‚˜ë¦¬ì˜¤

### ì‹œë‚˜ë¦¬ì˜¤ A: ì•„ì´ì½˜ ìƒì„± API ì§ì ‘ í…ŒìŠ¤íŠ¸

**ëª©ì **: ì•„ì´ì½˜ ìƒì„± APIê°€ ì •ìƒ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸

**ì‹¤í–‰**:

```bash
curl -X POST "http://localhost:8011/api/item/icon" \
  -H "Content-Type: application/json" \
  -d '{
    "item_id": "test_sword_001",
    "description": "ë¹›ë‚˜ëŠ” ë§ˆë²• ê²€",
    "language": "ko-KR",
    "wait": false
  }'
```

**ê¸°ëŒ€ ê²°ê³¼**:

```json
{
  "status": "pending",
  "icon_url": "/ui/icons/placeholder_item.png",
  "item_id": "test_sword_001",
  "is_placeholder": true,
  "message": "ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì•„ì´ì½˜ì„ ìƒì„± ì¤‘ì…ë‹ˆë‹¤."
}
```

**í™•ì¸ í¬ì¸íŠ¸**:
- âœ… statusê°€ "pending" ë˜ëŠ” "cached"
- âœ… icon_urlì´ ë°˜í™˜ë¨
- âœ… is_placeholderê°€ ì ì ˆíˆ ì„¤ì •ë¨

---

### ì‹œë‚˜ë¦¬ì˜¤ B: ìºì‹œ ë™ì‘ í™•ì¸

**ëª©ì **: ë™ì¼ ì„¤ëª…ì˜ ì•„ì´í…œì€ ìºì‹œì—ì„œ ë°˜í™˜ë˜ëŠ”ì§€ í™•ì¸

**ì‹¤í–‰**:

```bash
# ì²« ë²ˆì§¸ ìš”ì²­ (wait=trueë¡œ ì™„ë£Œê¹Œì§€ ëŒ€ê¸°)
curl -X POST "http://localhost:8011/api/item/icon" \
  -H "Content-Type: application/json" \
  -d '{
    "item_id": "cache_test_001",
    "description": "í™©ê¸ˆ ì—´ì‡ ",
    "language": "ko-KR",
    "wait": true
  }'

# ë‘ ë²ˆì§¸ ìš”ì²­ (ë™ì¼ ì„¤ëª…)
curl -X POST "http://localhost:8011/api/item/icon" \
  -H "Content-Type: application/json" \
  -d '{
    "item_id": "cache_test_002",
    "description": "í™©ê¸ˆ ì—´ì‡ ",
    "language": "ko-KR",
    "wait": false
  }'
```

**ê¸°ëŒ€ ê²°ê³¼**:
- ë‘ ë²ˆì§¸ ìš”ì²­ì˜ statusê°€ "cached"
- generation_time_msê°€ ë§¤ìš° ì§§ìŒ (< 10ms)

**í™•ì¸ í¬ì¸íŠ¸**:
- âœ… ìºì‹œ íˆíŠ¸ ì‹œ statusê°€ "cached"
- âœ… ë™ì¼ icon_url ë°˜í™˜

---

### ì‹œë‚˜ë¦¬ì˜¤ C: í”„ë¡ íŠ¸ì—”ë“œ í†µí•© í…ŒìŠ¤íŠ¸

**ëª©ì **: ì¸ë²¤í† ë¦¬ì— ì•„ì´í…œ ì¶”ê°€ ì‹œ ì•„ì´ì½˜ì´ ë™ì  ìƒì„±ë˜ëŠ”ì§€ í™•ì¸

**ì‹¤í–‰ ìˆœì„œ**:

1. **Step 1**: ê°œë°œì ë„êµ¬ ì½˜ì†”ì—ì„œ ì•„ì´í…œ ì¶”ê°€

   ```javascript
   // ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ ì‹¤í–‰
   const store = window.__ZUSTAND_STORES__?.inventory;
   if (store) {
     store.getState().addItems([
       { id: 'demo_potion', name: 'ì²´ë ¥ ë¬¼ì•½', description: 'ë¶‰ì€ ì²´ë ¥ íšŒë³µ ë¬¼ì•½', quantity: 1 }
     ]);
   }
   ```

   - ê²°ê³¼: ì¸ë²¤í† ë¦¬ì— ì•„ì´í…œ ì¶”ê°€ë¨, ğŸ“¦ placeholder í‘œì‹œ

2. **Step 2**: ë¡œë”© ìŠ¤í”¼ë„ˆ í™•ì¸
   - ê²°ê³¼: ì•„ì´ì½˜ ìœ„ì— ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ í‘œì‹œ

3. **Step 3**: ì•„ì´ì½˜ ìƒì„± ì™„ë£Œ ëŒ€ê¸° (15-30ì´ˆ)
   - ìµœì¢… ê²°ê³¼: placeholderê°€ ìƒì„±ëœ í”½ì…€ ì•„íŠ¸ ì•„ì´ì½˜ìœ¼ë¡œ êµì²´ë¨

---

### ì‹œë‚˜ë¦¬ì˜¤ D: rembg ë°°ê²½ ì œê±° í™•ì¸ (U-035 ì—°ë™)

**ëª©ì **: ìƒì„±ëœ ì•„ì´ì½˜ì— ë°°ê²½ ì œê±°ê°€ ì ìš©ë˜ëŠ”ì§€ í™•ì¸

**ì „ì œ ì¡°ê±´**:
- rembgê°€ ì„¤ì¹˜ë˜ì–´ ìˆì–´ì•¼ í•¨ (U-035 ëŸ°ë¶ ì°¸ì¡°)
- `birefnet-general` ëª¨ë¸ ì‚¬ì „ ë‹¤ìš´ë¡œë“œ ì™„ë£Œ

**í™•ì¸ ë°©ë²•**:

1. ì•„ì´ì½˜ ìƒì„± í›„ `.data/images/generated/icons/` ë””ë ‰í† ë¦¬ í™•ì¸
2. ìƒì„±ëœ PNG íŒŒì¼ì˜ ë°°ê²½ì´ íˆ¬ëª…í•œì§€ í™•ì¸ (ì´ë¯¸ì§€ ë·°ì–´ì—ì„œ)

**í™•ì¸ í¬ì¸íŠ¸**:
- âœ… ì•„ì´ì½˜ PNG íŒŒì¼ ìƒì„±ë¨
- âœ… ë°°ê²½ì´ íˆ¬ëª… ì²˜ë¦¬ë¨ (ì•ŒíŒŒ ì±„ë„)
- âœ… ì˜¤ë¸Œì íŠ¸ ì™¸ê³½ì´ ê¹”ë”í•˜ê²Œ ë¶„ë¦¬ë¨

---

## 4. ì‹¤í–‰ ê²°ê³¼ í™•ì¸

### 4.1 ë¡œê·¸ í™•ì¸

ë°±ì—”ë“œ ë¡œê·¸ì—ì„œ ë‹¤ìŒ ë©”ì‹œì§€ í™•ì¸:

```
[ItemIconGenerator] ì•„ì´ì½˜ ìƒì„± ìš”ì²­ item_id=... desc_hash=...
[ItemIconGenerator] ì•„ì´ì½˜ ìƒì„± ì™„ë£Œ item_id=... elapsed_ms=...
[IconCache] ì•„ì´ì½˜ ìºì‹œ ì €ì¥ cache_key=... size_bytes=...
```

### 4.2 ìƒì„± íŒŒì¼

- ìœ„ì¹˜: `.data/images/generated/icons/`
- íŒŒì¼ëª…: `{MD5í•´ì‹œ}.png`
- í¬ê¸°: 64x64 í”½ì…€, PNG í˜•ì‹

### 4.3 ì„±ëŠ¥ ì§€í‘œ

- ì•„ì´ì½˜ ìƒì„± ì‹œê°„: Mock ëª¨ë“œ ~100ms, ì‹¤ì œ API ~15-20ì´ˆ
- ìºì‹œ íˆíŠ¸ ì‹œê°„: < 10ms

### 4.4 ì„±ê³µ/ì‹¤íŒ¨ íŒë‹¨ ê¸°ì¤€

**ì„±ê³µ**:
- âœ… APIê°€ 200 OK ì‘ë‹µ ë°˜í™˜
- âœ… placeholder ì•„ì´ì½˜ì´ í‘œì‹œë¨
- âœ… ë°±ê·¸ë¼ìš´ë“œ ìƒì„± í›„ ì•„ì´ì½˜ êµì²´ë¨
- âœ… ìºì‹œ ë™ì‘ ì •ìƒ

**ì‹¤íŒ¨ ì‹œ í™•ì¸**:
- âŒ 500 ì—ëŸ¬ â†’ ë°±ì—”ë“œ ë¡œê·¸ í™•ì¸
- âŒ ì•„ì´ì½˜ ë¯¸ìƒì„± â†’ UW_MODE ë° GOOGLE_API_KEY í™•ì¸
- âŒ ë°°ê²½ ì œê±° ì‹¤íŒ¨ â†’ rembg preflight ìƒíƒœ í™•ì¸ (`/health` ì—”ë“œí¬ì¸íŠ¸)

---

## 5. ë¬¸ì œ í•´ê²° (Troubleshooting)

### 5.1 ì¼ë°˜ì ì¸ ì˜¤ë¥˜

**ì˜¤ë¥˜**: `rembg preflightê°€ ì™„ë£Œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤`

- **ì›ì¸**: rembg ëª¨ë¸ì´ ë‹¤ìš´ë¡œë“œë˜ì§€ ì•ŠìŒ
- **í•´ê²°**:
  1. `/health` ì—”ë“œí¬ì¸íŠ¸ì—ì„œ rembg ìƒíƒœ í™•ì¸
  2. U-035 ëŸ°ë¶ì˜ preflight ì ˆì°¨ ì‹¤í–‰

**ì˜¤ë¥˜**: `ì´ë¯¸ì§€ ìƒì„± í´ë¼ì´ì–¸íŠ¸ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤`

- **ì›ì¸**: GOOGLE_API_KEY ë¯¸ì„¤ì • (real ëª¨ë“œ)
- **í•´ê²°**:
  1. `backend/.env`ì— GOOGLE_API_KEY ì„¤ì •
  2. ë˜ëŠ” `UW_MODE=mock`ìœ¼ë¡œ ë³€ê²½

**ì˜¤ë¥˜**: ì•„ì´ì½˜ì´ placeholderì—ì„œ ë³€ê²½ë˜ì§€ ì•ŠìŒ

- **ì›ì¸**: í´ë§ ì‹¤íŒ¨ ë˜ëŠ” ìƒì„± íƒ€ì„ì•„ì›ƒ
- **í•´ê²°**:
  1. ë¸Œë¼ìš°ì € ë„¤íŠ¸ì›Œí¬ íƒ­ì—ì„œ API ìš”ì²­ í™•ì¸
  2. ë°±ì—”ë“œ ë¡œê·¸ì—ì„œ ìƒì„± ìƒíƒœ í™•ì¸

### 5.2 í™˜ê²½ë³„ ì£¼ì˜ì‚¬í•­

- **Windows**: ê²½ë¡œì— í•œê¸€ì´ í¬í•¨ë˜ë©´ ë¬¸ì œ ë°œìƒ ê°€ëŠ¥ â†’ ì˜ë¬¸ ê²½ë¡œ ê¶Œì¥
- **macOS/Linux**: rembg ì²« ì‹¤í–‰ ì‹œ ëª¨ë¸ ë‹¤ìš´ë¡œë“œ ì§€ì—° (~30ì´ˆ)

---

## 6. API ì°¸ì¡°

### POST /api/item/icon

ì•„ì´í…œ ì•„ì´ì½˜ ìƒì„± ìš”ì²­

**ìš”ì²­ ë³¸ë¬¸**:
```json
{
  "item_id": "string",
  "description": "string",
  "language": "ko-KR" | "en-US",
  "wait": false
}
```

**ì‘ë‹µ**:
```json
{
  "status": "pending" | "generating" | "completed" | "failed" | "cached",
  "icon_url": "string",
  "item_id": "string",
  "is_placeholder": boolean,
  "message": "string | null"
}
```

### GET /api/item/icon/{item_id}/status

ì•„ì´ì½˜ ìƒì„± ìƒíƒœ ì¡°íšŒ

**ì‘ë‹µ**:
```json
{
  "item_id": "string",
  "status": "pending" | "generating" | "completed" | "failed"
}
```

---

## 7. ë‹¤ìŒ ë‹¨ê³„

ì´ ìœ ë‹› ì™„ë£Œ í›„:
- CP-MVP-03: ë™ì  ì•„ì´ì½˜ì´ í‘œì‹œë˜ëŠ” ë°ëª¨ ì‹œë‚˜ë¦¬ì˜¤ ê²€ì¦
- MMP ê³„íš: ì•„ì´ì½˜ ìŠ¤íƒ€ì¼ ì»¤ìŠ¤í„°ë§ˆì´ì§•, ê³ í•´ìƒë„ ì•„ì´ì½˜ ì§€ì›
