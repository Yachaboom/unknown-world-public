# U-114 Agent Console 레이아웃 변경 - 검증배지 접기 + 대기열 상시 노출 실행 가이드

## 1. 개요

Agent Console의 레이아웃을 변경하여 **대기열(Queue)을 항상 노출**하고 **검증 배지(Badges)를 기본 접힌 상태**로 전환했습니다. 에이전트의 단계별 진행 상황(Queue)이 실시간으로 보이는 것이 "채팅이 아닌 에이전트 시스템"을 증명하는 핵심 UX입니다.

**예상 소요 시간**: 5분

**의존성**:

- 의존 유닛: U-082[Mvp] (Agent Console 축소 레이아웃), U-008[Mvp] (Agent Console 기본 구조)
- 선행 완료 필요: U-082 런북 실행 필요 없음 (이미 완료)

---

## 2. 빠른 시작 (Quick Start)

### 2.1 환경 준비

```bash
pnpm install
```

### 2.2 즉시 실행

```bash
# Frontend (RULE-011: 포트 8001)
pnpm run dev:front
# → http://localhost:8001

# Backend (RULE-011: 포트 8011)
pnpm run dev:back
# → http://localhost:8011/health
```

### 2.3 첫 화면 확인

- 프로필 선택 화면에서 아무 프로필 선택
- 게임 화면의 **우측 사이드바**에서 Agent Console 패널 확인
- 성공 지표: Queue 영역에 "대기 중..." 텍스트가 보이고, 배지 영역은 접힌 상태(▼ 배지 토글 버튼만 보임)

---

## 3. 핵심 기능 시나리오

### 시나리오 A: Queue 상시 노출 (idle 상태)

**목적**: 턴 미처리 상태에서 Queue가 "대기 중..." 텍스트로 표시되는지 확인

**실행**:

1. 게임 진입 후 아무 행동도 하지 않은 상태
2. Agent Console 패널을 확인

**기대 결과**:

- "대기열" 라벨이 보임
- "대기 중..." 텍스트가 Queue 영역에 표시
- StreamingStatus가 "IDLE" 상태 표시

**확인 포인트**:

- ✅ Queue 영역이 항상 보임 (접힘/숨김 없음)
- ✅ "대기 중..." 텍스트가 가독성 있게 표시됨

---

### 시나리오 B: Queue 실시간 진행 (턴 처리 중)

**목적**: 턴 처리 시 7단계 큐가 실시간 업데이트되는지 확인

**실행**:

1. 텍스트 입력 또는 액션 카드 클릭으로 턴 실행
2. Agent Console의 Queue 영역 관찰

**기대 결과**:

- Parse → Validate → Plan → Resolve → Render → Verify → Commit 단계가 순차 표시
- 현재 진행 중 단계: ◎ (마젠타 색상 + 펄스 애니메이션)
- 완료된 단계: ● (녹색)
- 대기 중 단계: ○ (회색)

**확인 포인트**:

- ✅ 7단계 큐가 4열 그리드로 정렬
- ✅ 실시간 상태 전환이 시각적으로 구분됨
- ✅ 스트리밍 종료 후에도 완료된 단계 상태가 유지됨

---

### 시나리오 C: 배지 접힘/펼침 토글

**목적**: 검증 배지가 기본 접힌 상태이며, 토글로 펼침/접힘이 동작하는지 확인

**실행**:

1. 턴 1회 이상 실행하여 배지가 생성된 상태에서
2. "▼ 검증 배지" 토글 버튼 클릭 → 배지 펼침
3. "▲ 검증 배지" 토글 버튼 클릭 → 배지 접힘

**기대 결과**:

접힌 상태:
- 토글 버튼에 "▼ 검증 배지 4/4 OK" 축약 표시 (모두 통과 시)
- 또는 "▼ 검증 배지 ⚠ N" 경고 표시 (실패 있을 시)

펼친 상태:
- Schema OK/FAIL, Economy OK/FAIL, Safety OK/FAIL, Consistency OK/FAIL 전체 배지 표시
- Auto-repair 트레이스 표시 (있는 경우)

**확인 포인트**:

- ✅ 기본 상태가 접힘
- ✅ 접힌 상태에서 축약 요약("4/4 OK" 또는 "⚠ N")이 표시됨
- ✅ 펼침 시 전체 배지 그리드가 표시됨
- ✅ 토글 애니메이션이 CRT 테마에 어울림

---

### 시나리오 D: 실패 배지 경고 (접힌 상태)

**목적**: 검증 실패 시 접힌 상태에서도 경고 아이콘이 표시되는지 확인

**실행**:

1. 의도적으로 검증 실패를 유발하거나 Mock 모드에서 fail 배지를 설정
2. 접힌 상태의 배지 토글 버튼 확인

**기대 결과**:

- "⚠" 경고 아이콘 + 실패 개수가 빨간색으로 표시
- 접힌 상태에서도 실패 존재를 즉시 인지 가능

**확인 포인트**:

- ✅ 실패 경고 아이콘이 빨간색(error-color)으로 눈에 띔
- ✅ 실패 개수가 정확히 표시됨

---

### 시나리오 E: 전체 레이아웃 안정성

**목적**: U-082에서 확보한 Agent Console 축소 범위가 유지되는지 확인

**실행**:

1. 창 크기를 다양하게 변경 (특히 세로 축소)
2. Agent Console + Economy HUD + Scanner 간 레이아웃 경합 확인

**기대 결과**:

- Agent Console이 U-082 이전보다 같거나 더 작은 공간을 차지
- Economy HUD가 정상적으로 확대된 상태 유지
- 스크롤 발생 시 패널 내부 스크롤로 처리

**확인 포인트**:

- ✅ Agent Console이 Economy HUD 공간을 침범하지 않음
- ✅ 배지 접힌 상태에서 공간이 절약됨
- ✅ 작은 화면에서도 Queue + 토글 버튼이 보임

---

## 4. 실행 결과 확인

### 4.1 성공/실패 판단 기준

**성공**:

- ✅ Queue(대기열)가 항상 노출됨 (idle: "대기 중...", 활성: 7단계 큐)
- ✅ Badges(검증배지)가 기본 접힌 상태이며 토글로 펼침 가능
- ✅ 접힌 상태에서 축약 요약 ("4/4 OK" 또는 "⚠ N") 표시
- ✅ 실패 배지가 접힌 상태에서도 경고 아이콘으로 가시화
- ✅ Agent Console 전체 크기가 U-082 축소 범위 유지

**실패 시 확인**:

- ❌ Queue가 안 보임 → `agent-queue-always` CSS 클래스 확인
- ❌ 토글이 동작하지 않음 → React state `badgesExpanded` 로직 확인
- ❌ 축약 요약이 안 보임 → `BadgesSummary` 컴포넌트와 badges store 연결 확인
- ❌ 레이아웃 깨짐 → `style.css`의 flex 분배와 `panel-agent-console` 스타일 확인

---

## 5. 문제 해결 (Troubleshooting)

### 5.1 일반적인 오류

**오류**: Queue 영역이 보이지 않음

- **원인**: CSS 클래스 미적용 또는 `agent-queue-always` 스타일 누락
- **해결**: `frontend/src/style.css`에서 `.agent-queue-always` 규칙 확인

**오류**: 토글 버튼 클릭 시 반응 없음

- **원인**: `badgesExpanded` 상태 관리 오류
- **해결**: React DevTools에서 `AgentConsole` 컴포넌트의 state 확인

**오류**: 배지 축약 요약이 표시되지 않음

- **원인**: `BadgesSummary` 컴포넌트가 badges 배열을 올바르게 읽지 못함
- **해결**: `agentStore`의 `selectBadges` 셀렉터와 `BADGE_INFO` 매핑 확인

### 5.2 환경별 주의사항

- **Windows**: `pnpm kill` 명령으로 포트 정리 후 재시작
- **macOS/Linux**: 기본 동작 동일

---

## 6. 다음 단계

- CP-MVP-03: 대기열 상시 노출 상태에서 "에이전트 시스템" 데모 체감 검증
- U-087: 입력 잠금 시 대기열 진행 상황이 실시간으로 보이는지 통합 확인
