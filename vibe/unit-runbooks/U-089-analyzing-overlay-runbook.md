# U-089 정밀분석 전용 로딩 프로그레스 UX 실행 가이드

## 1. 개요

정밀분석(Agentic Vision) 실행 시 **기존 Scene 이미지를 유지하면서** 분석 전용 오버레이(시안 스캔라인 스윕 + "장면 분석 중..." 라벨)를 표시하는 기능입니다. 기존 이미지 생성 로딩(`processingPhase: image_pending`)과 시각적으로 명확히 구분되어, 사용자가 "기존 장면을 분석하는 중"임을 인지할 수 있습니다.

**예상 소요 시간**: 5분

**의존성**:
- 의존 유닛: U-076[Mvp] (정밀분석 기능 전체), U-071[Mvp] (Scene 로딩 인디케이터 패턴)
- 선행 완료 필요: 프론트엔드/백엔드 개발 서버 실행

---

## 2. 빠른 시작 (Quick Start)

### 2.1 환경 준비

```bash
# 의존성 설치
pnpm -C frontend install
```

### 2.2 서버 실행

```bash
# 프론트엔드 (터미널 1)
pnpm -C frontend dev
# → http://localhost:8001

# 백엔드 (터미널 2)
cd backend
uv run uvicorn src.unknown_world.main:app --host 0.0.0.0 --port 8011 --reload
# → http://localhost:8011/health
```

### 2.3 첫 화면 확인

- 브라우저에서 `http://localhost:8001` 접속
- 프로필을 선택하여 게임 시작 (예: "탐험가")
- Scene Canvas에 이미지가 표시되고 핫스팟이 보이면 준비 완료

---

## 3. 핵심 기능 시나리오

### 시나리오 A: 정밀분석 실행 시 분석 전용 오버레이 확인

**목적**: 정밀분석 실행 시 기존 이미지가 유지되고, 분석 전용 오버레이가 표시되는지 검증

**실행**:
1. Scene 이미지가 존재하는 상태에서 명령 입력창에 `정밀분석` 입력
2. "실행" 버튼 클릭 또는 Enter

**기대 결과**:
- 기존 Scene 이미지가 **사라지지 않고** 화면에 유지됨
- 이미지가 어둡게 처리됨 (opacity 0.5 + 시안 틴트)
- 시안색 스캔라인이 위에서 아래로 반복 스윕
- "장면 분석 중..." 시안 글로우 텍스트 표시
- "오브젝트를 탐색하고 있습니다" 서브텍스트 표시

**확인 포인트**:
- ✅ 기존 이미지가 사라지지 않고 반투명으로 유지
- ✅ 시안(cyan) 스캔라인 스윕 애니메이션 동작
- ✅ "장면 분석 중..." 텍스트 시안 글로우 효과
- ✅ 기존 CRT 스피너(processing overlay)가 아닌 분석 전용 오버레이

---

### 시나리오 B: 분석 완료 후 오버레이 해제 확인

**목적**: 분석이 완료되면 오버레이가 사라지고 정상 상태로 복귀하는지 검증

**전제 조건**:
- 시나리오 A에서 정밀분석이 실행 중인 상태

**실행**:
- 턴 처리가 완료될 때까지 대기 (Agent Console에서 Commit 단계까지)

**기대 결과**:
- 분석 오버레이가 사라짐 (fade-out)
- Scene 이미지의 opacity가 1.0으로 원복
- 새 핫스팟이 등장하거나, 기존 핫스팟이 유지됨
- 내러티브 로그에 분석 결과가 표시됨

**확인 포인트**:
- ✅ 오버레이 자연스럽게 사라짐
- ✅ 이미지 밝기 원복 (opacity 1.0)
- ✅ 핫스팟 정상 동작 (클릭 가능)
- ✅ Agent Console이 "대기 중"으로 복귀

---

### 시나리오 C: 일반 턴과 정밀분석 턴의 시각적 구분

**목적**: 일반 턴과 정밀분석 턴의 로딩 UI가 명확히 구분되는지 검증

**실행 순서**:

1. **일반 턴 실행**: "탐색하기" 액션 카드 클릭
   - 기대: 기존 이미지 **숨김** + CRT 스피너 + "장면 생성 중..." 표시

2. 턴 완료 대기

3. **정밀분석 턴 실행**: "정밀분석" 액션 카드 클릭 또는 명령 입력
   - 기대: 기존 이미지 **유지(어둡게)** + 시안 스캔라인 + "장면 분석 중..." 표시

**결과 비교**:
| 항목 | 일반 턴 | 정밀분석 턴 |
|------|---------|-------------|
| 기존 이미지 | 숨김 | 유지(opacity 0.5) |
| 오버레이 | CRT 스피너(녹색/마젠타) | 시안 스캔라인 스윕 |
| 텍스트 | "장면 생성 중..." | "장면 분석 중..." |
| 컬러 테마 | 녹색/마젠타 | 시안(cyan) |

**확인 포인트**:
- ✅ 두 모드의 시각적 차이가 명확
- ✅ 일반 턴에서 기존 processing overlay 정상 동작 (회귀 없음)

---

### 시나리오 D: 접근성 (prefers-reduced-motion)

**목적**: 모션 감소 설정 시 애니메이션 대신 정적 오버레이가 표시되는지 검증

**실행**:
1. 브라우저 개발자 도구 → Rendering → "Emulate CSS media feature prefers-reduced-motion: reduce" 활성화
2. "정밀분석" 명령 실행

**기대 결과**:
- 스캔라인 스윕 애니메이션 정지 (정적 위치)
- 텍스트 펄스 애니메이션 정지
- 오버레이 자체는 정상 표시

**확인 포인트**:
- ✅ 모든 CSS 애니메이션 비활성화
- ✅ 분석 상태는 여전히 시각적으로 구분 가능

---

### 시나리오 E: 최소 표시 시간 (500ms) 검증

**목적**: 분석이 매우 빠르게 완료되어도 오버레이가 깜빡이지 않는지 검증

**실행**:
- mock 모드에서 빠른 응답이 오는 경우 관찰

**기대 결과**:
- 분석 오버레이가 최소 500ms 동안 표시됨
- 즉시 사라지지 않아 깜빡임 없음

**확인 포인트**:
- ✅ 오버레이가 충분히 인지 가능한 시간 동안 표시

---

## 4. 실행 결과 확인

### 4.1 로그 확인
- 브라우저 콘솔에서 에러 없음
- Agent Console에서 단계/배지 정상 표시

### 4.2 성공/실패 판단 기준

**성공**:
- ✅ 정밀분석 시 기존 이미지 유지 + 분석 오버레이 표시
- ✅ 분석 완료 후 오버레이 해제 + 핫스팟 등장
- ✅ 일반 턴과 시각적 구분 명확
- ✅ CRT 테마와 조화 (시안 스캔라인)
- ✅ prefers-reduced-motion 존중

**실패 시 확인**:
- ❌ 분석 시 이미지가 사라짐 → `isAnalyzing` 상태가 turnRunner에서 설정되는지 확인
- ❌ 오버레이가 안 보임 → CSS의 `.scene-analyzing-overlay` 스타일 확인
- ❌ 일반 턴에서도 분석 오버레이 → `isVisionTrigger()` 함수의 키워드 매칭 확인

---

## 5. 문제 해결 (Troubleshooting)

### 5.1 일반적인 오류

**오류**: 정밀분석 시 이미지가 사라지고 기존 로딩 스피너가 표시됨
- **원인**: `isAnalyzing` 상태가 turnRunner에서 설정되지 않음
- **해결**: `turnRunner.ts`의 `isVisionTrigger()` 함수와 트리거 키워드 목록 확인

**오류**: 오버레이가 표시되지 않음
- **원인**: CSS 스타일이 누락되었거나 z-index 문제
- **해결**: `style.css`에서 `.scene-analyzing-overlay` 스타일 확인 (z-index: 15)

**오류**: 분석 완료 후 오버레이가 사라지지 않음
- **원인**: `setIsAnalyzing(false)` 호출 누락
- **해결**: `turnRunner.ts`의 `onComplete`와 `onError` 콜백에서 `finishAnalyzing()` 호출 확인

### 5.2 환경별 주의사항

- **Windows**: 특이사항 없음
- **macOS/Linux**: 특이사항 없음

---

## 6. 다음 단계

- U-090: 핫스팟 생성을 정밀분석 전용으로 제한하여, "정밀분석 → 분석 UX → 핫스팟 등장" 파이프라인 완성
