# U-129 아이템 판매 직관적 UX 개선 실행 가이드

## 1. 개요

인벤토리 아이템 판매 UX를 개선하여, 잔액 상태와 무관하게 **항상 판매 버튼이 노출**되도록 하고, **인라인 컨펌(2단계 클릭)**으로 실수 판매를 방지합니다. 판매 가격(+5 Signal)이 버튼에 미리 표시되어 사용자가 보상을 예측할 수 있습니다.

**예상 소요 시간**: 5분

**의존성**:

- 의존 유닛: U-096[Mvp] (아이템 소비/페이드아웃), U-088[Mvp] (인벤토리 Row 레이아웃)
- 선행 완료 필요: 프론트엔드/백엔드 서버 실행

---

## 2. 빠른 시작 (Quick Start)

### 2.1 환경 준비

```bash
cd frontend
pnpm install
```

### 2.2 서버 실행

```bash
# 프론트엔드 (터미널 1)
pnpm -C frontend dev
# → http://localhost:8001

# 백엔드 (터미널 2)
cd backend
uv run uvicorn unknown_world.main:app --reload --port 8011
# → http://localhost:8011/health
```

### 2.3 첫 화면 확인

- 브라우저에서 `http://localhost:8001` 접속
- 프로필 선택 (서사꾼/탐험가/기술 전문가 중 택 1)
- 게임 UI 진입 후 인벤토리 패널 확인

---

## 3. 핵심 기능 시나리오

### 시나리오 A: 판매 버튼 항상 노출 확인

**목적**: 잔액 충분 시에도 판매 버튼이 보이는지 확인

**실행**:

1. "서사꾼" 프로필 선택 (Signal: 200, 아이템 3개)
2. 인벤토리 패널 확인

**기대 결과**:

- 모든 아이템 Row에 `⚡+5` 판매 버튼이 표시됨
- Signal 잔액이 200(충분)인데도 판매 버튼이 보임

**확인 포인트**:

- ✅ 3개 아이템 모두 판매 버튼(⚡+5) 표시
- ✅ 판매 가격 라벨이 "+5"로 표시
- ✅ Signal 아이콘(⚡) + 가격이 간결하게 표현됨

---

### 시나리오 B: 인라인 컨펌 (2단계 클릭) 테스트

**목적**: 1차 클릭 시 "확인?" 상태 전환, 2차 클릭 시 판매 실행

**실행**:

1. 아이템의 판매 버튼(⚡+5) 클릭 (1차 클릭)
2. 버튼이 "확인?"으로 변경되고 붉은색으로 펄스 애니메이션 확인
3. 2초 이내에 "확인?" 버튼 다시 클릭 (2차 클릭)

**기대 결과**:

- 1차 클릭: 버튼 텍스트 "⚡+5" → "확인?" 변경, 붉은색 스타일 적용
- 2차 클릭: 판매 실행 → 아이템 페이드아웃 → Signal 증가

**확인 포인트**:

- ✅ 1차 클릭 시 버튼 텍스트 "확인?"으로 변경
- ✅ 버튼 색상이 노란색 → 붉은색으로 변경
- ✅ 2차 클릭 시 판매 실행 (Signal +5 증가)
- ✅ 아이템 페이드아웃 애니메이션 작동
- ✅ 내러티브에 판매 기록 추가

---

### 시나리오 C: 2초 타임아웃 복귀 테스트

**목적**: 2초 경과 시 확인 상태가 자동 복귀되는지 확인

**실행**:

1. 판매 버튼(⚡+5) 클릭 (1차 클릭)
2. "확인?" 상태 확인 후 2초 이상 대기
3. 버튼이 원래 "⚡+5" 상태로 복귀하는지 확인

**기대 결과**:

- 2초 후 자동으로 "⚡+5" 상태로 복귀
- 아이템이 판매되지 않음 (Signal 변화 없음)

**확인 포인트**:

- ✅ 2초 경과 후 버튼이 "⚡+5"로 복귀
- ✅ 붉은색 스타일이 노란색으로 복귀
- ✅ Signal 잔액 변화 없음

---

### 시나리오 D: 판매 후 경제 데이터 검증

**목적**: 판매 후 Signal, 거래 장부, 내러티브가 올바르게 반영되는지 확인

**실행**:

1. 초기 Signal 확인 (예: 200)
2. 아이템 판매 실행 (2단계 클릭)
3. 판매 후 경제 데이터 확인

**기대 결과**:

| 항목 | Before | After |
|------|--------|-------|
| Signal | 200 | 205 |
| 인벤토리 아이템 수 | 3 | 2 |
| 거래 장부 | 이력 없음 | "아이템 판매: [아이템명]" 기록 |
| 내러티브 | - | "💰 [아이템]을(를) 판매하여 5 Signal을 획득했습니다." |

**확인 포인트**:

- ✅ Signal +5 증가
- ✅ 인벤토리에서 아이템 제거 (수량 1이면 Row 제거, 복수면 수량 감소)
- ✅ 거래 장부에 판매 기록 추가
- ✅ 내러티브에 판매 결과 텍스트 추가

---

### 시나리오 E: 드래그/소비 중 판매 버튼 숨김 확인

**목적**: 드래그 중이거나 소비 중일 때 판매 버튼이 숨겨지는지 확인

**실행**:

1. 아이템을 드래그 시작
2. 드래그 중 판매 버튼 표시 여부 확인

**기대 결과**:

- 드래그 중: 판매 버튼 숨김
- 드래그 종료 후: 판매 버튼 다시 표시

**확인 포인트**:

- ✅ isDragging 시 판매 버튼 비표시
- ✅ isConsuming 시 판매 버튼 비표시
- ✅ disabled 시 판매 버튼 비표시

---

## 4. 실행 결과 확인

### 4.1 성공/실패 판단 기준

**성공**:

- ✅ 모든 아이템에 판매 버튼 항상 표시 (isBalanceLow 조건 제거)
- ✅ 인라인 컨펌 (2단계 클릭) 정상 동작
- ✅ 2초 타이머 자동 복귀 동작
- ✅ 판매 후 Signal 증가 + 거래 장부 기록 + 내러티브 추가
- ✅ 드래그/소비 중 판매 버튼 숨김
- ✅ i18n 키 (ko-KR, en-US) 모두 적용

**실패 시 확인**:

- ❌ 판매 버튼 미표시 → `showSellButton` prop이 `true`인지 확인
- ❌ 인라인 컨펌 미동작 → `confirmingSellIdRef` 동기화 확인
- ❌ Signal 미변경 → `worldStore.sellItem()` 호출 여부 확인

---

## 5. 문제 해결 (Troubleshooting)

### 5.1 일반적인 오류

**오류**: 판매 버튼이 보이지 않음

- **원인**: `showSellButton` prop이 `false`로 전달됨
- **해결**: `InventoryPanel.tsx`에서 `showSellButton` prop이 `true`로 전달되는지 확인

**오류**: 2차 클릭이 판매를 실행하지 않음

- **원인**: React stale closure 문제로 `confirmingSellId` 비교 실패
- **해결**: `confirmingSellIdRef` (ref)를 통한 최신 값 참조 확인

**오류**: i18n 키 미번역 표시

- **원인**: `translation.json`에 `sell_confirm` 키 누락
- **해결**: `ko-KR/translation.json`과 `en-US/translation.json` 모두 확인

---

## 6. 다음 단계

이 유닛 완료 후 경제 루프 관련 테스트는 CP-MVP-03 (10분 데모 루프)에서 통합 검증됩니다.
