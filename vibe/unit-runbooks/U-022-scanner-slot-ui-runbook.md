# U-022[Mvp] Scanner 슬롯 UI + 업로드→아이템화 실행 가이드

## 1. 개요

Scanner 슬롯 UI를 통해 이미지를 업로드하면 백엔드에서 분석 후 아이템 후보를 추출하고, 사용자가 선택한 아이템을 인벤토리에 추가하는 기능을 검증합니다.

**예상 소요 시간**: 10분

**의존성**:

- 의존 유닛: U-021[Mvp] (Scanner 백엔드 엔드포인트), U-011[Mvp] (Inventory DnD)
- 선행 완료 필요: 백엔드 서버 실행 (`pnpm dev:back`)

---

## 2. 빠른 시작 (Quick Start)

### 2.1 환경 준비

```bash
# 프로젝트 루트에서 의존성 설치 확인
cd d:/Dev/unknown-world
pnpm install

# 백엔드 의존성 설치
cd backend
uv sync
```

### 2.2 의존 유닛 확인

```bash
# 백엔드 서버 실행 (별도 터미널)
cd d:/Dev/unknown-world
pnpm dev:back

# 헬스체크 확인
curl http://localhost:8011/health
# 기대 결과: {"status":"ok",...}

# Scanner 엔드포인트 헬스체크
curl http://localhost:8011/api/scan/health
# 기대 결과: {"status":"ok","mode":"mock",...}
```

### 2.3 즉시 실행

```bash
# 프론트엔드 개발 서버 실행 (별도 터미널)
cd d:/Dev/unknown-world
pnpm dev:front
```

### 2.4 첫 화면/결과 확인

- 브라우저에서 http://localhost:8001 접속
- 프로필 선택 → 게임 화면 진입
- 우측 사이드바의 **Scanner** 패널 확인
- 드랍존("이미지를 드롭하세요" 또는 "Drop Image Here") 표시 확인

---

## 3. 핵심 기능 시나리오

### 시나리오 A: 이미지 드롭/업로드 기본 동작

**목적**: Scanner 슬롯에 이미지를 업로드하면 분석이 시작되는지 확인

**실행**:

1. 테스트 이미지 파일 준비 (JPEG/PNG/GIF/WebP, 20MB 이하)
2. Scanner 패널의 드랍존에 이미지 파일을 드래그 앤 드롭
   - 또는 드랍존 클릭 → 파일 선택

**기대 결과**:

1. 드래그 오버 시: 드랍존 테두리가 강조 (보라색 글로우)
2. 드롭 후: "분석 중..." 상태 표시 + 로딩 스피너
3. 분석 완료 시: 결과 화면 전환
   - 이미지 프리뷰 (썸네일)
   - 캡션 텍스트
   - 감지된 오브젝트 수
   - 아이템 후보 목록

**확인 포인트**:

- ✅ 드래그 오버 시 시각적 피드백 (border/glow 변화)
- ✅ 업로드 중 로딩 상태 표시
- ✅ 분석 완료 후 결과 목록 표시

---

### 시나리오 B: 아이템 선택 및 인벤토리 추가 (Q1 Option B 검증)

**목적**: 사용자가 아이템 후보를 선택하여 인벤토리에 추가하는 흐름 검증

**전제 조건**:

- 시나리오 A 완료 (아이템 후보 목록 표시 상태)

**실행**:

1. 아이템 후보 목록에서 원하는 아이템 클릭 (체크박스 토글)
2. "추가 (N개)" 버튼 클릭

**기대 결과**:

1. 선택된 아이템: 테두리 색상 변경 (보라색)
2. "추가" 버튼: 선택 개수 표시
3. 추가 완료 시:
   - Scanner 슬롯이 초기 상태로 복귀
   - 좌측 **Inventory** 패널에 새 아이템 추가됨
   - 아이템 드래그 가능

**확인 포인트**:

- ✅ 체크박스 토글 정상 동작
- ✅ 선택된 아이템 시각적 구분
- ✅ 인벤토리에 아이템 추가됨
- ✅ 추가된 아이템 드래그 가능 (U-011 연동)

---

### 시나리오 C: 에러 처리 및 폴백

**목적**: 파일 형식 오류, 크기 초과, 네트워크 오류 시 안전한 폴백 확인

**실행**:

1. **지원하지 않는 형식**: `.txt` 또는 `.pdf` 파일 업로드 시도
2. **파일 크기 초과**: 20MB 이상 파일 업로드 시도
3. **네트워크 오류**: 백엔드 서버 중지 후 업로드 시도

**기대 결과**:

| 케이스         | 에러 메시지 (ko-KR)               | 에러 메시지 (en-US)          |
| -------------- | --------------------------------- | ---------------------------- |
| 형식 오류      | 지원하지 않는 이미지 형식입니다   | Unsupported image format     |
| 크기 초과      | 파일이 너무 큽니다 (최대 20MB)    | File too large (max 20MB)    |
| 네트워크 오류  | 네트워크 오류가 발생했습니다...   | Network error occurred...    |

**확인 포인트**:

- ✅ 에러 메시지 명확히 표시
- ✅ "다시 시도" 버튼 제공
- ✅ 게임 플레이 중단 없음 (RULE-004)

---

### 시나리오 D: 취소 동작

**목적**: 분석 결과에서 취소 시 초기 상태로 복귀 확인

**실행**:

1. 이미지 업로드 → 분석 완료 (결과 화면)
2. "취소" 버튼 클릭

**기대 결과**:

1. Scanner 슬롯이 초기 드랍존 상태로 복귀
2. 인벤토리에 아이템 추가되지 않음

**확인 포인트**:

- ✅ 취소 후 초기 상태 복귀
- ✅ 프리뷰 이미지 제거
- ✅ 인벤토리 변경 없음

---

### 시나리오 E: 비활성화 상태 (스트리밍 중)

**목적**: 턴 스트리밍 중에는 Scanner 슬롯이 비활성화되는지 확인

**실행**:

1. 게임 화면에서 액션 카드 클릭 또는 명령 입력 → 턴 실행
2. 스트리밍 중 Scanner 슬롯 상태 확인

**기대 결과**:

1. 스트리밍 중: 드랍존 비활성화 (회색, 클릭 불가)
2. 스트리밍 완료 후: 드랍존 활성화 복귀

**확인 포인트**:

- ✅ 스트리밍 중 드랍존 disabled 스타일 적용
- ✅ 스트리밍 중 드래그/클릭 무시
- ✅ 스트리밍 완료 후 정상 동작 복귀

---

## 4. 실행 결과 확인

### 4.1 브라우저 개발자 도구 로그

- 위치: 브라우저 개발자 도구 → Console
- 주요 로그:
  - `[ScannerAPI] Network error`: 네트워크 오류 발생 시
  - `[ScannerAPI] HTTP error`: 서버 오류 발생 시
  - `[ScannerAPI] Response validation failed`: 응답 스키마 오류 시

### 4.2 네트워크 탭 확인

- 요청: `POST /api/scan`
- Content-Type: `multipart/form-data`
- 응답: JSON (`ScannerResponse` 스키마)

### 4.3 성공/실패 판단 기준

**성공**:

- ✅ 이미지 드랍/업로드 동작
- ✅ 분석 결과 표시 (캡션, 오브젝트, 아이템 후보)
- ✅ 사용자 확인 후 인벤토리 추가 (Q1 Option B)
- ✅ 에러 시 안전한 폴백 (RULE-004)
- ✅ ko/en 언어별 메시지 정상 표시 (RULE-006)

**실패 시 확인**:

- ❌ 드랍존 클릭 불가 → 브라우저 콘솔 오류 확인
- ❌ 분석 실패 → 백엔드 서버 상태 및 로그 확인
- ❌ 인벤토리 미반영 → inventoryStore 상태 확인

---

## 5. 문제 해결 (Troubleshooting)

### 5.1 일반적인 오류

**오류**: `Scanner 패널이 보이지 않음`

- **원인**: 반응형 레이아웃에서 사이드바 숨겨짐
- **해결**: 브라우저 창 너비 1200px 이상으로 확대

**오류**: `업로드 후 무한 로딩`

- **원인**: 백엔드 서버 미실행 또는 네트워크 문제
- **해결**:
  1. 백엔드 서버 실행 상태 확인: `curl http://localhost:8011/health`
  2. CORS 설정 확인
  3. 브라우저 네트워크 탭에서 요청 상태 확인

**오류**: `인벤토리에 아이템이 추가되지 않음`

- **원인**: 아이템 미선택 또는 스토어 연동 문제
- **해결**:
  1. 아이템 후보 선택 상태 확인 (체크박스)
  2. 브라우저 콘솔에서 `inventoryStore` 상태 확인

### 5.2 환경별 주의사항

- **Windows**: 파일 경로에 한글이 포함된 경우 업로드 실패 가능
- **macOS/Linux**: 대소문자 구분에 유의

---

## 6. 다음 단계

- **RU-006**: media/artifacts 저장/제한/보안 정책 정리
- **CP-MVP-03**: "업로드 조작" 데모 케이스 검증
