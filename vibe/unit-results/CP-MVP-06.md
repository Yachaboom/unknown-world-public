# CP-MVP-06: Scanner 업로드 게이트(안전/좌표/비용) 개발 완료 보고서

## 메타데이터

- **작업 ID**: CP-MVP-06
- **단계 번호**: 2.3
- **작성 일시**: 2026-01-31 17:45
- **담당**: AI Agent

---

## 1. 작업 요약

Scanner(이미지 업로드) 기능의 엔드포인트(U-021)와 UI(U-022)를 통합하여, 실제 게임 환경에서의 조작 무결성과 안전 게이트를 전수 검증했습니다. 이미지 분석부터 아이템화 반영까지의 파이프라인이 0~1000 정규화 좌표계, 언어 일관성, 에러 폴백 원칙을 준수함을 확정했습니다.

---

## 2. 작업 범위

- **이미지 업로드 → 아이템화 통합 검증**: Scanner 슬롯을 통한 이미지 분석 및 인벤토리 추가 전 과정 확인
- **좌표 규약 검증 (RULE-009)**: 백엔드 반환 bbox가 0~1000 정규화 및 `[ymin, xmin, ymax, xmax]` 형식을 준수하는지 확인
- **안전 게이트 및 폴백 검증 (RULE-004)**: 지원하지 않는 형식, 파일 크기 초과, 분석 실패 시 안정적인 에러 처리 확인
- **언어 일관성 검증 (RULE-006)**: `ko-KR`/`en-US` 요청에 따른 캡션 및 아이템 이름의 언어 일관성 확인
- **비용/지연 UX 확인 (RULE-005/008)**: 분석 중 로딩 피드백 및 이미지 분석 지연에 따른 UX 안정성 확인

---

## 3. 생성/수정 파일

_(체크포인트 단계이므로 검증 보고서 및 문서 동기화 위주로 진행)_

| 파일 경로 | 유형 | 목적 |
| --- | --- | --- |
| `vibe/unit-results/CP-MVP-06.md` | 신규 | 본 검증 보고서 |
| `vibe/unit-runbooks/CP-MVP-06.md` | 신규 | 전수 검증 시나리오 및 실행 가이드 (이전 단계 생성) |
| `vibe/progress.md` | 수정 | 프로젝트 진행 상황 업데이트 |
| `vibe/roadmap.md` | 수정 | 로드맵 상태 및 진행률 업데이트 |
| `vibe/architecture.md` | 수정 | 최신 프로젝트 구조 반영 |

---

## 4. 구현 상세 (검증 결과)

### 4.1 핵심 검증 포인트

**1. 좌표 정합성 (Coordinate Invariant)**:
- Gemini Flash 모델이 반환하는 원본 좌표를 0~1000 정규화 좌표계로 변환하는 서비스 로직(`image_understanding.py`) 검증 완료.
- 프론트엔드 `ScannerSlot`에서 해당 좌표를 기반으로 오브젝트 영역을 정확히 가시화함을 확인.

**2. 언어 일관성 (Language Invariant)**:
- 세션 언어(`TurnInput.language`)와 연동된 `multipart/form-data` 필드 전송 확인.
- 백엔드에서 요청된 언어에 맞춰 캡션 및 아이템 후보 목록을 생성함을 확인 (ko/en 혼합 없음).

**3. 안전 및 폴백 (Safety Gate)**:
- 20MB 초과 파일 및 비이미지 파일 업로드 시 백엔드 유효성 검사기가 작동하여 `status: failed` 응답 및 사용자 친화적 메시지 반환 확인.
- 분석 중 예외 발생 시에도 UI가 `error` 상태로 안전하게 전이되며 재시도가 가능함을 확인.

### 4.2 설계 준수 확인

- **Option B (User Confirmed Integration)**: 분석된 아이템 후보를 사용자가 체크박스로 선택하여 인벤토리에 수동 추가하는 정책이 준수되어 게임 밸런스 및 의도적 조작성 확보.
- **Strict Schema Enforcement**: 모든 통신 데이터가 Pydantic 및 Zod 스키마를 100% 통과함.

---

## 5. 런북(Runbook) 정보

- **파일 경로**: `vibe/unit-runbooks/CP-MVP-06.md`
- **실행 결과**: 정상 경로(시나리오 A), 에러 경로(시나리오 B/C), 규약 준수(시나리오 D/E) 등 5대 핵심 시나리오 전수 통과.

---

## 6. 리스크 및 주의사항

- **모델 지연 시간**: 실제 Vertex AI 사용 시 이미지 분석에 5~10초 내외의 지연이 발생할 수 있으므로, 로딩 인디케이터의 가시성이 플레이어 경험에 결정적임.
- **이미지 보관 정책**: 현재는 업로드된 이미지를 메모리에서 처리 후 휘발시키고 있으므로, 향후 아카이빙이나 리플레이 기능을 위해 GCS 연동(MMP 단계)이 필요함.

---

## 7. 다음 단계 안내

### 7.1 후속 작업

1. **CP-MVP-03**: 멀티모달(업로드) 조작을 포함한 전체 10분 데모 루프 통합 검증
2. **U-023[Mvp]**: Autopilot 모드 토글 및 행동 큐 가시화 연동

### 7.2 의존 단계 확인

- **선행 단계**: U-021, U-022 완료
- **후속 단계**: M3 마일스톤의 최종 통합 및 데모 준비

---

## 8. 자체 점검 결과

- [x] 런북 기반 요구사항 충족 확인
- [x] Repomix 최신 구조 반영 확인
- [x] 아키텍처/네이밍/경로 일관성 유지
- [x] 파괴적 변경/리스크/가정 명시

---

_본 보고서는 AI Agent에 의해 자동 생성되었습니다._
