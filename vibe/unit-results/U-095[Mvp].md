# U-095[Mvp]: Scanner 아이템 생성 개수 랜덤화 완료 보고서

## 메타데이터

- **작업 ID**: U-095[Mvp]
- **단계 번호**: MVP
- **작성 일시**: 2026-02-07 10:45
- **담당**: AI Agent

---

## 1. 작업 요약

Scanner로 이미지를 업로드하여 아이템을 생성할 때, 생성되는 아이템 수를 1~3개 범위에서 가중치 랜덤으로 결정하도록 구현하였습니다. 발견된 아이템 수에 따라 차별화된 피드백 메시지를 제공하여 게임플레이의 기대감과 재미를 강화했습니다.

---

## 2. 작업 범위

- **서버측 랜덤 결정 로직**: 1개(60%), 2개(30%), 3개(10%) 확률 분포 구현
- **프롬프트 고도화**: LLM에게 특정 개수({count})의 아이템 추출을 명시적으로 지시
- **결과 보정 및 검증**: 모델이 반환한 아이템 개수를 목표치에 맞게 조정하고 중복 아이템 제거
- **프론트엔드 UX 개선**: 아이템 발견 개수에 따른 차별화된 피드백 메시지 표시

---

## 3. 생성/수정 파일

| 파일 경로 | 유형 | 목적 |
| --------- | ---- | ---- |
| `backend/src/unknown_world/services/image_understanding.py` | 수정 | 아이템 수 랜덤 결정 및 보정 로직 추가 |
| `backend/prompts/scan/scan_instructions.ko.md` | 수정 | 아이템 개수 지시 플레이스홀더 및 지침 추가 |
| `frontend/src/components/ScannerSlot.tsx` | 수정 | 아이템 개수별 발견 메시지 표시 로직 추가 |

---

## 4. 구현 상세

### 4.1 핵심 설계

**가중치 랜덤 결정 (Backend)**:
- `determine_item_count()`: `random.choices`를 사용하여 사전에 정의된 가중치(60/30/10)에 따라 1~3 사이의 정수 결정.

**아이템 수 보정 (Backend)**:
- `_adjust_item_count()`: 모델이 반환한 `item_candidates` 배열을 목표 개수만큼 슬라이싱하고, 중복된 `label`을 가진 아이템을 제거하여 품질 유지.

**동적 프롬프트 (Backend)**:
- `load_prompt`로 가져온 텍스트의 `{count}`를 런타임에 결정된 숫자로 치환하여 모델의 확정적 출력을 유도.

### 4.2 외부 영향 분석

- **데이터 모델**: 기존 `ScanResult` 스키마가 이미 배열 형태를 지원하므로 스키마 변경 없이 기능 확장 완료.
- **성능**: 아이템 수가 늘어남에 따라 출력 토큰량이 약간 증가할 수 있으나, `max_output_tokens`를 넉넉히 설정하여 대응.

---

## 5. 런북(Runbook) 정보

- **파일 경로**: `vibe/unit-runbooks/U-095-runbook.md` (예정)
- **주요 테스트 시나리오**: 
  - 이미지 업로드 시 1개, 2개, 3개 아이템이 확률에 따라 정상 생성되는지 확인
  - 프론트엔드에서 "세 가지를 발견했습니다!" 등의 메시지가 정상 표시되는지 확인

---

## 6. 리스크 및 주의사항

- **모델 지시 불이행**: 비전 모델이 가끔 지시된 개수보다 적거나 많은 아이템을 줄 수 있으나, 서버측 `_adjust_item_count` 로직으로 최종 응답의 일관성 보장.
- **중복 아이템**: 동일한 이미지 내에서 유사한 아이템이 여러 개 나올 경우를 대비해 중복 제거 로직 적용.

---

## 7. 다음 단계 안내

### 7.1 후속 작업

1. **U-096**: 생성된 아이템의 실제 인벤토리 상호작용 및 소모 로직 연동
2. **U-077**: 아이템이 많아질 경우를 대비한 인벤토리 스크롤 기능 강화

---

## 8. 자체 점검 결과

- [x] 런북 기반 요구사항 충족 확인
- [x] Repomix 최신 구조 반영 확인
- [x] 아키텍처/네이밍/경로 일관성 유지
- [x] 파괴적 변경/리스크/가정 명시

---

_본 보고서는 AI Agent에 의해 자동 생성되었습니다._
