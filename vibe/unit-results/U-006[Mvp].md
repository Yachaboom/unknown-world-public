# U-006[Mvp]: TurnInput/TurnOutput 스키마(Zod) 개발 완료 보고서

## 메타데이터

- **작업 ID**: U-006[Mvp]
- **단계 번호**: 2.3
- **작성 일시**: 2026-01-04 15:30
- **담당**: AI Agent

---

## 1. 작업 요약

프론트엔드와 서버 간의 데이터 교환을 위한 `TurnInput` 및 `TurnOutput` Zod 스키마를 구현하였습니다. 이를 통해 런타임 타입 검증(Strict) 및 검증 실패 시의 안전 폴백 경로를 확보하여 시스템의 안정성을 높였습니다.

---

## 2. 작업 범위

- **Zod 스키마 정의**: `TurnInput`, `TurnOutput` 및 하위 컴포넌트(ActionCard, SceneObject 등) 스키마 구현
- **규약 준수**: 좌표(0~1000), 언어(ko/en), 재화(0 이상) 등 프로젝트 핵심 규칙 반영
- **안전 폴백 구현**: `safeParseTurnOutput` 및 `createFallbackTurnOutput` 함수 구현
- **서버 정합성**: 서버 Pydantic 모델과 1:1 대응하는 구조 확보

---

## 3. 생성/수정 파일

| 파일 경로 | 유형 | 목적 |
| --------- | ---- | ---- |
| `frontend/src/schemas/turn.ts` | 신규 | TurnInput/TurnOutput Zod 스키마 및 검증 헬퍼 |

---

## 4. 구현 상세

### 4.1 핵심 설계

**주요 계약 (Zod Schemas)**:

- `TurnInputSchema`: 클라이언트에서 서버로 보내는 입력 데이터 검증
- `TurnOutputSchema`: 서버에서 받은 응답 데이터 검증 (strict 모드 적용)
- `SCHEMA_VERSION`: 스키마 버전을 통한 하위 호환성 관리 ('1.0.0')

**설계 패턴/원칙**:

- **RULE-003/004 (이중 검증 & 폴백)**: `safeParseTurnOutput`을 통해 에러 발생 시 시스템이 정의한 폴백 데이터를 반환하여 UI 중단 방지
- **RULE-005 (재화 인바리언트)**: `CurrencyAmountSchema`에서 `min(0)`을 강제하여 잔액 음수 방지
- **RULE-006 (언어 정책)**: `LanguageSchema`를 통해 `ko-KR` | `en-US` 고정
- **RULE-009 (좌표 규약)**: `Box2DSchema`에서 `ymin, xmin, ymax, xmax` 순서 및 0~1000 범위 정수 검증

### 4.2 외부 영향 분석

- **데이터/파일 시스템**: SSE를 통해 전달되는 JSON 데이터의 구조적 정합성 보장
- **빌드/의존성**: `zod` 라이브러리 활용 (v3.x 기준)

### 4.3 가정 및 제약사항

- 서버의 Pydantic 모델과 필드명이 1:1로 일치해야 함 (드리프트 주의)
- `strict()` 모드 사용으로 인해 명세에 없는 필드가 포함될 경우 검증 실패 처리됨

---

## 5. 런북(Runbook) 정보

- **파일 경로**: 해당 유닛은 순수 데이터 구조(Schema) 구현으로, 별도의 런북 시나리오 대신 유닛 테스트 또는 U-008 통합 단계에서 검증 예정
- **검증 방법**: `TurnOutputSchema.parse()`를 통한 샘플 JSON 데이터 검토 완료

---

## 6. 리스크 및 주의사항

- **스키마 드리프트**: 서버(Python)와 클라이언트(TypeScript) 간의 스키마 변경 시 동기화 누락 주의
- **폴백 텍스트**: i18n 정책에 따라 폴백 메시지도 언어별로 분기 처리됨

---

## 7. 다음 단계 안내

### 7.1 후속 작업

1. **U-008[Mvp]**: SSE 스트리밍 연동 시 Zod 검증 적용
2. **RU-002**: 서버/클라이언트 스키마 SSOT 강화(Code Generator 등)

### 7.2 의존 단계 확인

- **선행 단계**: U-002 (환경 설정), U-005 (서버 스키마)
- **후속 단계**: U-008 (연동 및 렌더링)

---

## 8. 자체 점검 결과

- [x] 런북 기반 요구사항 충족 확인 (계획서 기준)
- [x] Repomix 최신 구조 반영 확인
- [x] 아키텍처/네이밍/경로 일관성 유지
- [x] 파괴적 변경/리스크/가정 명시

---

_본 보고서는 AI Agent에 의해 자동 생성되었습니다._