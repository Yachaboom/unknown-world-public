# U-055[Mvp]: 이미지 파이프라인 Mock/Real 모드 통합 검증 개발 완료 보고서

## 메타데이터

- **작업 ID**: U-055[Mvp]
- **단계 번호**: 2.3
- **작성 일시**: 2026-02-01 19:00
- **담당**: AI Agent

---

## 1. 작업 요약

U-051~U-054에서 구축한 이미지 생성 파이프라인이 Mock 모드와 Real 모드에서 정상적으로 작동하는지 전체 루프를 통합 검증하고, 재현 가능한 런북을 작성했습니다. 검증 과정에서 발견된 모델 연동 및 스키마 복잡도 이슈를 식별하여 부채 로그에 기록했습니다.

---

## 2. 작업 범위

- **통합 검증 런북 작성**: Mock/Real 모드별 환경 설정, 실행 시나리오, 기대 결과 및 문제 해결 가이드를 포함한 상세 런북 제작
- **Mock 모드 루프 검증**: 플레이스홀더 이미지 생성, URL 반환 및 프론트엔드 SceneCanvas 렌더링 확인
- **Real 모드 스팟 테스트**: Vertex AI 연동을 통한 실제 Gemini 이미지 생성 프로세스 및 TTFB 측정
- **폴백 체계 작동 확인**: 재화 부족 및 생성 실패 시 텍스트-only 모드로의 안전한 전이 검증
- **기술적 부채 식별**: 검증 중 발견된 4대 핵심 이슈(언어 게이트, 재화 동기화, API 호출 방식, 스키마 복잡도) 상세 기록

---

## 3. 생성/수정 파일

| 파일 경로 | 유형 | 목적 |
| --- | --- | --- |
| `vibe/unit-runbooks/U-055-image-pipeline-integration-runbook.md` | 신규 | 이미지 파이프라인 통합 검증을 위한 상세 가이드 |
| `vibe/debt-log.md` | 수정 | 검증 중 발견된 기술적 이슈 및 향후 조치 계획 기록 |

---

## 4. 구현 상세

### 4.1 핵심 검증 결과

- **Mock 모드**: `UW_MODE=mock` 환경에서 턴 실행 시 약 30% 확률로 `/images/generated/img_*.png` 형태의 유효한 URL이 반환되며, 프론트엔드에서 정상 표시됨을 확인.
- **Real 모드**: Vertex AI 인증 환경에서 실제 이미지 생성이 작동하나, API 메서드 호환성 이슈 및 스키마 복잡도 제약으로 인한 안정성 개선이 필요함을 확인.
- **관측성**: Agent Console의 단계(Queue) 표시와 배지(Badges) 시스템이 이미지 생성 프로세스와 동기화되어 실시간 상태를 제공함.

### 4.2 식별된 이슈 (Debt Log)

1. **LanguageGate 충돌**: Mock 내러티브 생성 시 입력 텍스트가 포함되어 ko/en 혼합 검증을 통과하지 못하는 현상.
2. **재화 동기화 오류**: 턴 완료 후 프론트엔드에서 잔액이 0으로 초기화되는 UI/상태 관리 이슈.
3. **API 메서드 불일치**: `gemini-3-pro-image-preview` 모델은 `generate_content`를 사용해야 함.
4. **스키마 제약**: `TurnOutput`의 복잡도가 Gemini API의 구조화된 출력 한계를 초과하는 경우 발생.

### 4.3 외부 영향 분석

- **데이터/파일 시스템**: `backend/.data/images/generated/` 내에 생성된 이미지 파일들이 정상적으로 관리됨.
- **성능**: Mock 모드 응답은 1초 이내, Real 모드 이미지 생성 포함 턴은 약 15초 내외 소요 확인.

---

## 5. 런북(Runbook) 정보

- **파일 경로**: `vibe/unit-runbooks/U-055-image-pipeline-integration-runbook.md`
- **실행 결과**: Mock 모드 전체 시나리오 통과, Real 모드는 특정 제약 하에 작동 확인.
- **참조**: 상세 환경 설정 및 단계별 명령어를 포함함.

---

## 6. 리스크 및 주의사항

- **Real 모드 안정성**: 현재 Real 모드는 스키마 복잡도 이슈로 인해 실서비스 적용 전 스키마 단순화 또는 분할 생성이 선행되어야 함.
- **CORS 및 포트**: 프론트엔드(8001)와 백엔드(8011) 간의 포트 불일치 시 CORS 오류 발생 가능성 주의.

---

## 7. 다음 단계 안내

### 7.1 후속 작업

1. **CP-MVP-03**: 10분 데모 루프에 이미지 파이프라인 통합
2. **부채 해결**: `debt-log.md`에 기록된 스키마 단순화 및 API 호출 방식 수정

### 7.2 의존 단계 확인

- **선행 단계**: U-054[Mvp] 완료
- **후속 단계**: CP-MVP-03 (전체 통합 데모)

---

## 8. 자체 점검 결과

- [x] Mock/Real 모드별 검증 시나리오 수립 및 수행
- [x] 재현 가능한 런북 문서화 완료
- [x] 하드 게이트 인바리언트 준수 여부 확인
- [x] 발견된 기술적 결함의 명확한 기록 및 보고

---

_본 보고서는 AI Agent에 의해 자동 생성되었습니다._
