# U-010[Mvp]: Scene Canvas + Hotspot Overlay(0~1000 bbox) 개발 완료 보고서

## 메타데이터

- **작업 ID**: U-010[Mvp]
- **단계 번호**: 2.3
- **작성 일시**: 2026-01-17 15:30
- **담당**: AI Agent

---

## 1. 작업 요약

Scene Canvas(장면 영역)에 **0~1000 정규화 좌표계**를 기반으로 한 **핫스팟 오버레이** 시스템을 구현했습니다. 이를 통해 플레이어는 장면 내의 오브젝트를 직접 클릭하여 상호작용할 수 있으며, 클릭 정보는 구조화된 데이터(TurnInput.click)로 서버에 전송됩니다.

---

## 2. 작업 범위

- **좌표 변환 시스템 구축**: 0~1000 정규화 좌표와 픽셀 좌표 간의 상호 변환 유틸리티 구현 (RULE-009 준수).
- **Scene Canvas 컴포넌트 고도화**: `ResizeObserver`를 이용한 반응형 캔버스 크기 추적 및 핫스팟 레이어 렌더링.
- **핫스팟 상호작용 구현**: 호버 시 하이라이트/툴팁 표시 및 클릭 시 `object_id + box_2d` 데이터 패키징.
- **App 연동**: 핫스팟 클릭 이벤트를 전역 `executeTurn` 로직과 연결하여 실제 턴 실행 트리거.
- **스타일링**: CRT 레트로 미학에 어울리는 핫스팟 테두리, 글로우, 툴팁 애니메이션 적용.

---

## 3. 생성/수정 파일

| 파일 경로 | 유형 | 목적 |
| :--- | :--- | :--- |
| `frontend/src/utils/box2d.ts` | 신규 | 0~1000 ↔ px 좌표 변환 및 검증 유틸리티 |
| `frontend/src/components/SceneCanvas.tsx` | 수정 | 핫스팟 오버레이 렌더링 및 클릭 이벤트 핸들링 로직 추가 |
| `frontend/src/App.tsx` | 수정 | `handleHotspotClick` 구현 및 `SceneCanvas`와 턴 실행 로직 연동 |
| `frontend/src/style.css` | 수정 | 핫스팟 오버레이, 하이라이트, 툴팁 스타일 정의 (섹션 8.1) |
| `frontend/src/components/SceneCanvas.hotspot.test.tsx` | 신규 | 핫스팟 렌더링 및 클릭 동작 검증을 위한 단위 테스트 |

---

## 4. 구현 상세

### 4.1 핵심 설계

**좌표 규약 (RULE-009)**:
- 서버와 클라이언트 간의 데이터 교환에는 항상 **0~1000 정규화 좌표**를 사용합니다.
- `ymin, xmin, ymax, xmax` 순서의 바운딩 박스 형식을 유지합니다.
- 렌더링 직전에만 `box2dToPixel` 함수를 통해 현재 캔버스 크기에 맞는 픽셀 값으로 변환합니다.

**데이터 전송 (Q1: Option B)**:
- 클릭 시 `object_id`뿐만 아니라 클릭한 영역의 `box_2d`를 함께 전송하여 서버가 상호작용의 맥락을 정확히 파악할 수 있도록 합니다.

### 4.2 외부 영향 분석

- **인터랙션**: 핫스팟 레이어가 장면 이미지 위에 오버레이되지만, `pointer-events` 제어를 통해 필요한 영역에서만 클릭을 가로채고 이미지 자체의 가독성을 해치지 않도록 설계되었습니다.
- **반응형**: 브라우저 창 크기가 변하더라도 `ResizeObserver`가 실시간으로 캔버스 크기를 감지하여 핫스팟의 위치와 크기를 재계산합니다.

### 4.3 가정 및 제약사항

- 핫스팟은 `status === 'scene'` (정상 장면 표시 중)이거나 `status === 'default'` (플레이스홀더)일 때만 활성화됩니다.
- 스트리밍 중(`disabled={true}`)에는 핫스팟 상호작용이 차단됩니다.

---

## 5. 런북(Runbook) 정보

- **파일 경로**: `vibe/unit-runbooks/U-010-hotspot-overlay-runbook.md`
- **실행 결과**: 런북의 호버, 클릭, 리사이즈, 에러 처리 시나리오를 통해 기능 검증 완료.

---

## 6. 리스크 및 주의사항

- **좌표 오차**: 캔버스 비율(Aspect Ratio)이 서버가 상정한 이미지 비율과 크게 다를 경우 핫스팟 위치가 어색해 보일 수 있습니다. (향후 이미지 비율 고정 정책 고려 필요)

---

## 7. 다음 단계 안내

### 7.1 후속 작업

1. **U-011[Mvp]**: 인벤토리 패널 구현 및 아이템 드래그 기초 마련.
2. **U-012[Mvp]**: 핫스팟을 "드롭 타겟"으로 확장하여 아이템 사용 상호작용 구현.

### 7.2 의존 단계 확인

- **선행 단계**: U-004 (레이아웃), U-008 (스트리밍) - 완료 확인.

---

## 8. 자체 점검 결과

- [x] 0~1000 정규화 좌표계 준수 (RULE-009)
- [x] 핫스팟 호버/클릭 상호작용 및 시각적 피드백 확인
- [x] 클릭 데이터(`object_id`, `box_2d`) 전송 로직 검증
- [x] 반응형 리사이즈 대응 확인

---

_본 보고서는 AI Agent에 의해 자동 생성되었습니다._
