# U-129[Mvp]: 아이템 판매 직관적 UX 개선 개발 완료 보고서

## 메타데이터

- **작업 ID**: U-129[Mvp]
- **단계 번호**: 2.3
- **작성 일시**: 2026-02-09 10:30
- **담당**: AI Agent

---

## 1. 작업 요약

인벤토리 아이템 판매 UX를 개선하여 잔액 상태와 무관하게 항상 판매가 가능하도록 변경하고, 인라인 컨펌(2단계 클릭) 방식을 도입하여 실수 판매를 방지하고 직관적인 보상 피드백을 제공합니다.

---

## 2. 작업 범위

- [x] **판매 버튼 상시 노출**: `isBalanceLow` 조건부 노출에서 상시 노출로 변경
- [x] **인라인 컨펌 시스템**: 1차 클릭(확인 대기) -> 2차 클릭(판매 확정) 프로세스 구현
- [x] **판매 가격 가시화**: 버튼 내에 `+5 Signal` 라벨 및 아이콘 표시
- [x] **자동 복구 타이머**: 2초간 추가 입력 없을 시 컨펌 상태 자동 해제
- [x] **UI/UX 폴리싱**: 컨펌 상태 시 시각적 강조(레드 펄스) 및 드래그 중 버튼 숨김 처리
- [x] **다국어 지원**: 판매 확인 및 가격 관련 i18n 키 추가 (ko-KR, en-US)

---

## 3. 생성/수정 파일

| 파일 경로 | 유형 | 목적 |
| --- | --- | --- |
| `frontend/src/components/InventoryPanel.tsx` | 수정 | 판매 버튼 로직 변경, 인라인 컨펌 상태 및 타이머 관리 구현 |
| `frontend/src/style.css` | 수정 | 판매 버튼 스타일, 컨펌 상태(`confirming`) 애니메이션 추가 |
| `frontend/src/locales/ko-KR/translation.json` | 수정 | 한글 번역 키 추가 (`sell_confirm`, `sell_tooltip` 등) |
| `frontend/src/locales/en-US/translation.json` | 수정 | 영문 번역 키 추가 |
| `frontend/src/components/InventoryPanel.test.tsx` | 수정 | 개선된 판매 UX(2단계 클릭)에 대한 유닛 테스트 업데이트 |
| `vibe/unit-runbooks/U-129-item-sell-ux-runbook.md` | 신규 | 기능 검증을 위한 런북 가이드 작성 |

---

## 4. 구현 상세

### 4.1 핵심 설계

**인라인 컨펌 로직**:
- `confirmingSellId` (state)와 `confirmingSellIdRef` (ref)를 사용하여 UI 렌더링과 비동기 핸들러 간의 상태 일관성을 유지합니다.
- `setTimeout`을 사용하여 2초 후 컨펌 상태를 자동으로 리셋(`null`)합니다.

**상호작용 안전성**:
- `isDragging`, `isConsuming` 상태일 때 판매 버튼을 렌더링하지 않아 DnD 조작이나 애니메이션과의 충돌을 원천 차단합니다.
- `e.stopPropagation()`을 사용하여 판매 버튼 클릭이 아이템 선택(Select) 이벤트를 트리거하지 않도록 보호합니다.

### 4.2 외부 영향 분석

- **데이터/파일 시스템**: 영향 없음 (기존 `worldStore.sellItem` 사용)
- **경제 시스템**: Signal 획득 경로가 항상 열려 있어 게임 난이도 및 경제 밸런스에 긍정적 영향
- **UI 일관성**: 인벤토리 Row 레이아웃(`U-088`) 구조를 유지하면서 우측 영역에 판매 기능을 통합함

### 4.3 가정 및 제약사항

- 판매 가격은 `ITEM_SELL_PRICE_SIGNAL` 상수에 고정되어 있습니다 (현재 5).
- 아이템 수량이 0이 되면 Row가 자동으로 제거되는 기존 `U-096` 로직에 의존합니다.

---

## 5. 런북(Runbook) 정보

- **파일 경로**: `vibe/unit-runbooks/U-129-item-sell-ux-runbook.md`
- **실행 결과**: 런북에 명시된 시나리오 A~E를 통해 상시 노출, 2단계 클릭, 타이머 복귀, 경제 데이터 반영 및 예외 상황(드래그 중 숨김) 검증 완료.

---

## 6. 리스크 및 주의사항

- 판매 버튼이 항상 노출되므로 UI가 다소 복잡해질 수 있으나, 컴팩트한 디자인과 아이콘 사용으로 시각적 노이즈를 최소화했습니다.
- 실수 판매 리스크는 인라인 컨펌 절차로 완화되었습니다.

---

## 7. 다음 단계 안내

### 7.1 후속 작업

1. **통합 테스트**: 다양한 아이템 종류 및 수량 상황에서 판매 시각적 버그 확인
2. **경제 밸런싱**: `ITEM_SELL_PRICE_SIGNAL` 값이 적절한지 플레이 테스트 필요

### 7.2 의존 단계 확인

- **선행 단계**: U-096[Mvp], U-088[Mvp] (완료)
- **후속 단계**: CP-MVP-03 (경제 루프 통합 검증)

---

## 8. 자체 점검 결과

- [x] 런북 기반 요구사항 충족 확인
- [x] Repomix 최신 구조 반영 확인
- [x] i18n 정책 준수 확인
- [x] 드래그/소비 중 인터랙션 충돌 방지 확인

---

_본 보고서는 AI Agent에 의해 자동 생성되었습니다._
