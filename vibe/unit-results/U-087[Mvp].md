# U-087[Mvp] 턴 처리 중 모든 사용자 입력 잠금 개발 완료 보고서

## 메타데이터

- **작업 ID**: U-087[Mvp]
- **단계 번호**: 2.3 (핵심 UI 인터랙션)
- **작성 일시**: 2026-02-08 23:55
- **담당**: AI Agent

---

## 1. 작업 요약

턴 처리(스트리밍) 또는 이미지 생성 진행 중 모든 사용자 입력을 차단하여 "허위 액션 로그"와 "상태 경합"을 방지하는 기능을 구현했습니다. `isInputLocked` 상태를 App 레벨에서 단일화하여 관리하고, UI 오버레이와 비활성화 스타일을 통해 사용자에게 명확한 피드백을 제공합니다.

---

## 2. 작업 범위

- **입력 잠금 SSOT 정의**: `App.tsx`에서 `isStreaming`, `processingPhase`, `imageLoading` 상태를 조합하여 `isInputLocked` 계산 로직 구현.
- **입력 핸들러 가드**: 카드 클릭, 핫스팟 클릭, 아이템 드롭, 커맨드 제출 등 모든 사용자 입력 경로에 잠금 시 즉시 반환(return) 로직 적용.
- **허위 로그 생성 차단**: 서버 호출 전 즉각적인 피드백을 주던 액션 로그 생성 로직을 잠금 상태에서 차단하여 데이터 정합성 확보.
- **UI 잠금 오버레이 구현**: `z-index: 9990`의 투명 오버레이를 통해 물리적 클릭 차단 및 "처리 중…" 시각적 라벨 표시.
- **컴포넌트 비활성화 연동**: `ActionDeck`, `ScannerSlot`, `SceneCanvas`, `ResetButton` 등에 `disabled` 상태를 전파하여 시각적 일관성 확보.
- **i18n 및 접근성**: 다국어 메시지 적용 및 `prefers-reduced-motion` 대응 애니메이션 완화.

---

## 3. 생성/수정 파일

| 파일 경로 | 유형 | 목적 |
| --------- | ---- | ---- |
| `frontend/src/App.tsx` | 수정 | 입력 잠금 SSOT 정의, 핸들러 가드 및 컴포넌트 연동 |
| `frontend/src/style.css` | 수정 | 잠금 오버레이 스타일 및 비활성화 상태 시각화 |
| `frontend/src/locales/ko-KR/translation.json` | 수정 | `ui.input_locked`, `ui.wait` 등 다국어 키 추가 |
| `frontend/src/locales/en-US/translation.json` | 수정 | 동일 키의 영문 번역 추가 |

---

## 4. 구현 상세

### 4.1 핵심 설계

**입력 잠금 판정 로직**:
- `isInputLocked = isStreaming || processingPhase !== 'idle' || imageLoading === true`
- **SSOT 원칙**: `App.tsx`에서 한 번만 계산하여 프롭으로 하위 컴포넌트에 분배함으로써 상태 파편화 방지.

**물리적 차단 (Overlay)**:
- `.input-lock-overlay`에 `pointer-events: auto`와 `cursor: wait`를 적용하여 모든 마우스/터치 이벤트를 가로챔.
- `z-index: 9990`을 통해 게임 UI 요소 위에 위치하되 `crt-overlay`(9999) 아래에 배치하여 레트로 미학 유지.

### 4.2 외부 영향 분석

- **상호작용 피드백**: 사용자가 이미지를 기다리는 동안 무의미하게 버튼을 연타하여 발생하는 액션 로그 오염을 100% 방지함.
- **성능**: 단순 CSS 오버레이와 조건부 렌더링을 사용하여 런타임 오버헤드 최소화.

### 4.3 가정 및 제약사항

- **강제 잠금 정책**: 텍스트 스트리밍이 끝나도 이미지가 생성 중이면 입력을 잠그는 "완전 잠금(Option A)" 정책을 채택하여 가장 안전한 상태 관리 보장.

---

## 5. 런북(Runbook) 정보

- **파일 경로**: `vibe/unit-runbooks/U-087-input-lock-runbook.md`
- **실행 결과**: 유휴 상태 활성화, 턴 진행 중 잠금, 이미지 생성 중 잠금 유지, 완료 후 복구 등 모든 시나리오 검증 완료.

---

## 6. 리스크 및 주의사항

- **이미지 생성 지연**: 이미지 생성이 매우 길어질 경우 사용자 입력이 장시간 차단될 수 있음. 이는 U-086의 타이핑 지연 흡수와 "이미지 형성 중…" 라벨로 사용자 경험을 보완함.

---

## 7. 다음 단계 안내

### 7.1 후속 작업

1. **CP-MVP-03**: 10분 데모 루프에서 입력 잠금 및 로그 정합성 최종 검증.

### 7.2 의존 단계 확인

- **선행 단계**: U-070[Mvp], U-071[Mvp] 완료됨.
- **후속 단계**: U-023[Mvp] (Autopilot 모드) - 큐 자동 진행 시 입력 잠금 정책 재사용.

---

## 8. 자체 점검 결과

- [x] 런북 기반 요구사항 충족 확인
- [x] Repomix 최신 구조 반영 확인
- [x] 아키텍처/네이밍/경로 일관성 유지
- [x] 파괴적 변경/리스크/가정 명시

---

_본 보고서는 AI Agent에 의해 자동 생성되었습니다._
