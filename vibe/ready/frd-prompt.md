너는 숙련된 BA/PM이다. 아래 입력을 바탕으로 **기존 프로젝트에 특정 “메이저 기능”을 추가하기 위한 FRD(Feature Requirements Document, 요구사항 명세서)**를 **마크다운**으로 작성하라. 비어 있는 항목은 AI가 **[AI초안]**으로 간결히 보완한다. 완성된 FRD 본문만 출력하고 설명·질문은 금지한다.

=========================
[ 필수 참고 — 프로젝트 맥락 문서 ]
=========================
- @docs/prd.md  : 현재 프로젝트의 PRD 문서
- @docs/architecture.md : 현재 프로젝트의 아키텍쳐 문서
- @docs/tech-stack.md : 현재 프로젝트의 기술 스택 문서
- @docs/referenceses/file-search-api.md
- @docs/referenceses/gemini-pricing.md
- @docs/referenceses/google-grounding.md
- @docs/referenceses/gemini-deep-research.md
- @docs/referenceses/interactions-api.md
===============================================================

====================
[ 필수 입력 — BASIC ]
====================
- 프로젝트/서비스명:codrag/codrag-deep-research
- 기능명(추가할 메이저 기능):Codrag Deep-Research
- 기능 요약(구어체, 1-2문장): Codrag에 Gemini Deep Research 기능을 추가 합니다. 현재 지정된 저장소들의 File Search Store 대상으로 체계적이고 시각적인 연구 결과를 도출합니다.
- 배경/문제(현상·데이터·사용자 불만·운영 이슈 등): 일반 질문/답변으로 부족한 복잡한 문제, 다양한 저장소간의 관계에서 발생하는 복잡한 문제에 대해 심층적으로 연구하여 결과를 도출할 필요가 있습니다.
- 목표(2-4개):
  - 지정된 단일 Store에 대해 사용자의 질문에 대해 정확하고 깊이 있는 연구 결과를 출력합니다.
  - 복수의 Store가 지정된 경우 사용자의 질문에 대해 지정된 Store에 대한 모든 내용을 연구 하여 결과를 출력합니다.
  - 연구가 진행중일때 연구 과정에 대해 한국어로 번역하여 사용자가 과정을 볼 수 있도록 합니다.
- 레퍼런스 URL(유사 사례/경쟁사/가이드):
  - @docs/referenceses/file-search-api.md
  - @docs/referenceses/gemini-pricing.md
  - @docs/referenceses/google-grounding.md
  - @docs/referenceses/gemini-deep-research.md
  - @docs/referenceses/interactions-api.md
===============================================================

=========================
[ 권장 입력 — CONTEXT ]
=========================
- 현행 동작(As-Is) 요약: <> | (비우면 [AI초안])
- 관련 화면/사용자 흐름(As-Is): <> | (비우면 [AI초안])
- 관련 모듈/서비스/컴포넌트(영향 범위): <> | (비우면 [AI초안])
- 데이터/DB/스토리지(주요 엔티티·식별자·정합성 규칙): <> | (비우면 [AI초안])
- API/이벤트/메시징/외부 연동(계약·제약): <> | (비우면 [AI초안])
- 인증/인가/권한 모델(역할·정책·감사 로그): <> | (비우면 [AI초안])
- 성능/SLO/트래픽 특성(p95, QPS, 배치 주기 등): <> | (비우면 [AI초안])
- 운영/배포(릴리즈 방식, Feature Flag, 롤백 전략): <> | (비우면 [AI초안])
- 관측성(로그/메트릭/트레이싱/알림 기준): <> | (비우면 [AI초안])
- 보안/개인정보/컴플라이언스 요구(보관기간, 마스킹, 접근통제): <> | (비우면 [AI초안])
- 용어집(도메인 용어·약어 정의): <> | (비우면 [AI초안])
---------------------------------------------------------------

--------------------
[ 선택 입력 — EXPAND ]
--------------------
- 비즈니스 규칙/정책(가격, 제한, 승인, 상태 전이 등): <> | (비우면 [AI초안])
- 에러/예외/알림 정책(사용자 메시지, 에러 코드, 재시도): <> | (비우면 [AI초안])
- 데이터 마이그레이션/백필 필요 여부: <> | (비우면 [AI초안])
- 호환성 요구(구버전 클라이언트/레거시 API/DB 스키마): <> | (비우면 [AI초안])
- 분석/이벤트 트래킹(지표, 이벤트명, 속성): <> | (비우면 [AI초안])
- 접근성/국제화(다국어, 포맷, 키보드 내비게이션): <> | (비우면 [AI초안])
- QA/테스트 기준(필수 E2E 경로, 데이터 시드, 환경): <> | (비우면 [AI초안])
- 롤아웃 전략(점진 배포, 사용자/테넌트 분리, 실험): <> | (비우면 [AI초안])
- 리스크(+대응): <> | (비우면 [AI초안])
- 참고 링크: <> | (비우면 [AI초안] - 가능하면 웹검색을 통해 핵심 참고 링크 자동 첨부)
---------------------------------------------------------------

## 출력 규칙

### 1. 문서 구조
```markdown
# [기능명] FRD (기존 프로젝트 기능 추가)

## 1. 변경 개요
### 1.1 배경 및 문제
### 1.2 목표 및 성공 기준
### 1.3 범위 (In/Out)

## 2. 기존 시스템 맥락 (As-Is)
### 2.1 사용자/역할/권한
### 2.2 현행 사용자 흐름/화면
### 2.3 관련 구성요소(모듈/데이터/API/외부연동)
### 2.4 제약사항 및 가드레일(성능/보안/운영/호환성)

## 3. 제안 기능 개요 (To-Be)
### 3.1 핵심 컨셉
### 3.2 주요 사용자 시나리오(요약)
### 3.3 변경점 요약(UI/API/DB/권한/운영)

## 4. 요구사항 상세
### 4.1 기능 요구사항 (Functional Requirements)
### 4.2 비즈니스 규칙/정책
### 4.3 데이터 요구사항 (모델/정합성/마이그레이션)
### 4.4 API/이벤트/인터페이스 요구사항
### 4.5 UI/UX 요구사항 (상태/카피/접근성)

## 5. 비기능 요구사항 (Non-Functional Requirements)

## 6. 호환성/마이그레이션/롤백

## 7. 테스트/검증 및 수용 기준

## 8. 배포/롤아웃 계획

## 9. 위험 요소 및 대응

## 10. 가정 및 결정 필요 사항

## 11. 참고 자료
```

### 2. 요구사항 작성 규칙
- **요구사항 ID**: 기능 요구사항은 `FR-001`부터, 비기능 요구사항은 `NFR-001`부터 번호를 부여한다.
- **표 형식(필수)**: `4.1 기능 요구사항`은 아래 표를 사용한다.
  - 열(필수): ID | 요구사항 | 우선순위(P0/P1/P2) | 수용 기준(Given-When-Then) | 영향 범위(UI/API/DB/Ops) | 비고/근거
- **수용 기준**: 모든 P0 요구사항은 최소 1개 이상의 수용 기준을 포함한다.
- **모호 표현 금지**: “적절히/빠르게/가능하면/최대한” 금지. 수치·조건·예외를 명시한다.
- **질문 형식 금지**: 문서 내에 `?`, `Q1` 같은 질문 형태를 쓰지 말고, 필요한 항목은 `10. 가정 및 결정 필요 사항`에 **단정문**으로 기록한다.
- **불확실성 처리**: 입력에 근거가 없으면 함부로 단정하지 말고, `[AI초안] (가정)`으로 표시 후 `10.` 섹션에 함께 남긴다.

### 3. 작성 원칙
- **간결성**: 섹션 설명은 각 2-5문장, 대신 요구사항은 표/목록으로 압축해 밀도를 높인다.
- **실행가능성**: 개발/QA/운영이 바로 구현·검증할 수 있는 수준(데이터·API·예외·롤백 포함)으로 작성한다.
- **변경 영향 중심**: “새로 만드는 것”보다 “기존에 무엇이 어떻게 바뀌는지”를 우선적으로 명확히 한다.
- **AI초안 표기**: 보완한 내용은 반드시 `[AI초안]` 태그를 포함한다.

### 4. 금지사항
- 프롬프트 해석/메타 설명 출력
- "이해했습니다", "작성하겠습니다" 등 응답
- FRD 외 부가 설명이나 조언
- 불완전한 문서나 초안 상태 출력

### 5. 필수 포함 요소
- 모든 입력 정보 반영
- **As-Is → To-Be 변화**가 추적 가능하도록 작성(영향 범위/변경점 요약 포함)
- **마이그레이션/호환성/롤백** 섹션 포함(해당 없음이면 “해당 없음” 사유를 명시)
- **수용 기준** 포함(P0는 필수)
- 선택 입력이 비어있을 때는 `[AI초안]`으로 보완(가능하면 웹검색 참고 링크 포함)

---

## (부록) FRD 작성에 유용한 “프로젝트 맥락 자료” 체크리스트
아래 자료를 함께 제공할수록 FRD 정확도가 크게 올라간다. (문서/링크/캡처/다이어그램 어떤 형태든 가능)

- **제품/도메인**
  - 제품 한 장 요약(누가/무엇을/왜), 핵심 KPI, 용어집
- **현행 사용자 경험(As-Is)**
  - 주요 플로우(로그인~핵심행동), 화면 캡처/동영상, 에러/빈 상태 정의
- **아키텍처**
  - 시스템 구성도, 모듈 경계, 의존성, 주요 배치/워커/크론
- **데이터**
  - ERD, 주요 테이블/컬렉션, 핵심 키/인덱스, 데이터 정합성 규칙, 마이그레이션 히스토리
- **API/연동**
  - OpenAPI/Swagger/Postman 컬렉션, 이벤트 스키마, 외부 파트너 계약/쿼터/레이트리밋
- **권한/보안**
  - 역할/권한 매트릭스, 접근 정책, 감사 로그/추적 요구, 개인정보 분류/보관 기간
- **운영**
  - 배포 방식, Feature Flag 체계, 롤백 전략, 모니터링 대시보드/알람 정책
- **품질**
  - 테스트 전략(유닛/통합/E2E), QA 체크리스트, 성능 기준(SLO/SLI), 장애 대응 프로세스
- **제약/결정 기록**
  - ADR/의사결정 로그, 기술부채 리스트, “절대 바꾸면 안 되는 것” 5개

---

## (부록) 프로젝트 맥락 문서(Context Pack) 생성 프롬프트 (별도 실행용)
아래 블록은 **FRD 생성과 별개로** “컨텍스트 팩”을 먼저 만들 때 쓰는 프롬프트다. (FRD 출력에 이 블록의 본문을 포함하지 말 것)

```markdown
너는 숙련된 테크 라이터이자 솔루션 아키텍트다. 아래 입력(문서/링크/발췌/스크린샷 설명)을 바탕으로, 기능 요구사항 작성에 바로 사용할 수 있는 **프로젝트 컨텍스트 팩(Context Pack)**을 마크다운으로 작성하라. 비어 있는 항목은 **[AI초안]**으로 보완하되, 근거가 없으면 **[AI초안] (가정)**으로 표시하고 “결정 필요 사항”에 함께 기록한다. 결과물 본문만 출력하고 설명·질문은 금지한다.

====================
[ 입력 — CONTEXT PACK ]
====================
- 제품/도메인 개요(가능한 자료):
- 사용자/역할/권한 정책:
- 현행 사용자 흐름/화면(설명/캡처 링크):
- 시스템 아키텍처/모듈 구조:
- 데이터 모델/스키마/ERD:
- API/이벤트/외부연동 문서:
- 운영/배포/롤백/Feature Flag:
- 성능/SLO/트래픽 특성:
- 보안/개인정보/컴플라이언스:
- 용어집/에러코드/알림 정책:
- 참고 링크:
===============================================================

## 출력 규칙
```markdown
# 프로젝트 컨텍스트 팩

## 1. 제품/도메인 요약
## 2. 사용자/역할/권한
## 3. 현행 사용자 흐름(As-Is)
## 4. 아키텍처/모듈 경계
## 5. 데이터 모델 개요
## 6. API/이벤트/외부연동
## 7. 운영/배포/관측성
## 8. 제약사항/가드레일
## 9. 결정 필요 사항
## 10. 참고 자료
```
```

