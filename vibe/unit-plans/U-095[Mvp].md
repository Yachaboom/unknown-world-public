# U-095[Mvp]: Scanner 아이템 생성 개수 랜덤화 (1~3개, 가중치)

## 메타데이터

| 항목      | 내용                                                  |
| --------- | ----------------------------------------------------- |
| Unit ID   | U-095[Mvp]                                            |
| Phase     | MVP                                                   |
| 예상 소요 | 30분                                                  |
| 의존성    | U-022[Mvp], U-094[Mvp]                                |
| 우선순위  | Medium (게임플레이 다양성/재미)                       |

## 작업 목표

Scanner로 이미지를 업로드하여 아이템을 생성할 때, 생성되는 아이템 수를 **1~3개 범위에서 랜덤하게 결정**한다. 1개 생성 확률이 가장 높고, 3개 생성 확률이 가장 낮아 "레어 다중 발견"의 재미를 제공한다.

**배경**: 현재 Scanner로 아이템을 생성하면 항상 고정 개수(1개)가 생성된다. 업로드한 이미지에 따라 1~3개의 아이템이 발견되도록 랜덤화하면, "이번에는 몇 개 나올까?"하는 기대감과 게임플레이 다양성이 늘어난다. 확률 가중치: 1개(60%) > 2개(30%) > 3개(10%).

**완료 기준**:

- Scanner 아이템 생성 시 아이템 수가 1~3개 범위에서 랜덤 결정
- 확률 분포: 1개=60%, 2개=30%, 3개=10% (가중치 랜덤)
- 각 아이템은 고유한 이름/설명을 가짐 (동일 아이템 중복 방지)
- 프론트엔드에서 다수 아이템 발견 시 "여러 가지를 발견했습니다!" 등 피드백
- 비용 정책은 기존과 동일 (1회 스캔 비용, 아이템 수와 무관)

## 영향받는 파일

**수정**:

- `backend/prompts/scan/scan_instructions.ko.md` (또는 해당 프롬프트) - "1~3개 아이템 생성" 지시 추가
- `backend/prompts/scan/scan_instructions.en.md` - 동일 (영문)
- `backend/src/unknown_world/api/scan.py` (또는 해당 서비스) - 아이템 수 랜덤 결정 로직
- `backend/src/unknown_world/services/image_understanding.py` - 프롬프트에 아이템 수 파라미터 전달
- `frontend/src/components/ScannerSlot.tsx` (또는 해당 컴포넌트) - 다수 아이템 표시 UX

**참조**:

- `vibe/unit-results/U-022[Mvp].md` - Scanner 아이템화 결과
- `vibe/prd.md` - 6.7(Scanner 슬롯)

## 구현 흐름

### 1단계: 아이템 수 결정 로직

- Scanner 서비스에 가중치 랜덤 함수 추가:

```python
import random

def determine_item_count() -> int:
    """1~3개 아이템 수 결정 (가중치 랜덤)"""
    return random.choices(
        population=[1, 2, 3],
        weights=[60, 30, 10],
        k=1
    )[0]
```

### 2단계: 프롬프트 수정

- 스캔 프롬프트에 "이 이미지에서 {N}개의 아이템/단서를 발견하세요" 지시 추가
- 각 아이템은 고유한 이름/설명/타입을 가져야 함
- 아이템 간 연관성이 있으면 자연스러움 (예: "부러진 칼" + "칼 조각")

### 3단계: 응답 스키마 확인

- 기존 스캔 응답 스키마가 다수 아이템을 지원하는지 확인
- `items: list[ScannedItem]` 형태로 배열 반환이 이미 지원된다면 변경 최소화
- 단일 아이템만 반환하도록 제한되어 있다면 스키마 확장

### 4단계: 프론트엔드 UX

- 1개: "아이템을 발견했습니다!" (기존)
- 2개: "두 가지를 발견했습니다!"
- 3개: "세 가지를 발견했습니다! 대단한 발견이네요!"
- 다수 아이템 인벤토리 추가 애니메이션 (순차 fade-in)

## 의존성 & 연결

**이전 작업에서 가져올 것**:

- **결과물**: [U-022[Mvp]](../unit-results/U-022[Mvp].md) - Scanner 아이템화 구현
- **결과물**: [U-094[Mvp]] - 파싱 재시도 (안정적 결과 전제)

**다음 작업에 전달할 것**:

- U-096: 생성된 아이템의 사용/소비 로직
- CP-MVP-03: Scanner 데모 시나리오 풍부화

## 주의사항

**기술적 고려사항**:

- (RULE-006) 아이템 이름은 세션 언어와 일치 (ko/en 혼합 금지)
- 3개 아이템 생성 시 프롬프트 토큰 소비가 증가할 수 있음 → 간결한 설명 유도
- 비전 모델이 지시된 개수와 다른 수의 아이템을 반환할 수 있음 → 서버에서 개수 검증/조정

**잠재적 리스크**:

- 3개 아이템 생성 시 품질이 낮아질 수 있음 → 각 아이템의 최소 품질 기준 검증
- 아이템 수에 따른 인벤토리 과포화 → 인벤토리 스크롤(U-077)로 대응

## 페어링 질문 (결정 필요)

- [ ] **Q1**: 아이템 수 결정 주체?
  - Option A: 서버에서 랜덤 결정 후 프롬프트에 지시 (확정적)
  - Option B: 프롬프트에 "1~3개" 범위만 지시하고 모델이 판단 (비확정적)

- [ ] **Q2**: 확률 분포?
  - Option A: 1개=60%, 2개=30%, 3개=10%
  - Option B: 1개=50%, 2개=35%, 3개=15%
  - Option C: 1개=70%, 2개=25%, 3개=5%

## 참고 자료

- `vibe/unit-results/U-022[Mvp].md` - Scanner 아이템화 결과
- `vibe/prd.md` - 6.7(Scanner 슬롯), 5(재화 시스템)
