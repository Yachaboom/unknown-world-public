# CP-MVP-06: 체크포인트 - Scanner 업로드 게이트(안전/좌표/비용)

## 메타데이터

| 항목      | 내용        |
| --------- | ----------- |
| Unit ID   | CP-MVP-06   |
| Phase     | MVP         |
| 예상 소요 | 45분        |
| 의존성    | U-022[Mvp]  |
| 우선순위  | High        |

## 작업 목표

Scanner(이미지 업로드) 기능이 “게임 조작”으로 자연스럽게 작동하고, 업로드 실패/비용 부족/안전 차단 등 현실적인 실패 조건에서도 **안전한 대체 결과**로 플레이가 이어지도록 수동 검증한다.

**배경**: 업로드는 입력 벡터가 넓고(파일/크기/포맷), 비용이 크며, 오류가 UX를 바로 붕괴시킨다. 체크포인트 없이 기능을 확장하면 기술 부채(예외 처리 누락, 좌표 규약 드리프트, 비용/보안 누락)가 누적될 위험이 크다. (PRD 6.7/6.8, RULE-004/005/009)

**완료 기준**:

- Scanner 슬롯에 이미지 드롭/업로드 → 백엔드 처리 → “아이템/단서”가 인벤토리에 반영된다(또는 명시적 폴백). (PRD 6.7)
- bbox 좌표 규약이 유지된다: **0~1000 정규화** 및 \[ymin,xmin,ymax,xmax] 순서가 깨지지 않는다. (RULE-009)
- 업로드 실패(잘못된 타입/크기/네트워크 오류 등) 시에도 UI가 멈추지 않고, 사용자에게 이유가 표시되며 안전 폴백으로 종료된다. (RULE-004)
- Economy 인바리언트가 유지된다: 행동 전 예상 비용이 노출되고, 비용 부족 시 대체 행동(텍스트-only 등)이 제안된다. (RULE-005)
- 언어(ko-KR/en-US) 혼합 출력이 없고, 프롬프트 원문/내부 추론이 노출되지 않는다. (RULE-006/008)
- 발견된 결함/임시 대응은 `vibe/debt-log.md`에 기록된다.

## 영향받는 파일

**생성**:

- `vibe/unit-runbooks/CP-MVP-06.md` - Scanner 업로드 검증 런북(샘플 이미지/절차/체크리스트)
- `vibe/unit-results/CP-MVP-06.md` - 실행 결과/관측값/증거(스크린샷/로그 요약)

**수정**:

- 없음(검증 단계)

**참조**:

- `vibe/prd.md` - Scanner 요구(6.7), 좌표 규약, Hard Gate
- `vibe/tech-stack.md` - 비전/공간 모델 선택, 파일 입력 방식
- `.cursor/rules/00-core-critical.mdc` - RULE-004/005/006/008/009

## 구현 흐름

### 1단계: 정상 업로드(성공 경로)

- Scanner 슬롯에 이미지 1개를 드롭/업로드한다.
- 스트리밍 단계/배지/최종 TurnOutput이 정상적으로 도착하는지 확인한다.
- 인벤토리 또는 로그에 “아이템/단서” 반영이 발생하는지 확인한다.

### 2단계: 실패 업로드(복구/폴백)

- 실패 케이스를 최소 2개 확인한다(예: 비이미지 파일, 너무 큰 파일, 네트워크 오류).
- 실패 시에도 다음을 확인한다:
  - UI가 멈추지 않는다.
  - 오류/차단 메시지가 명시된다.
  - safe fallback 결과로 종료된다.

### 3단계: 좌표/비용/언어 인바리언트 확인

- bbox가 0~1000 및 \[ymin,xmin,ymax,xmax]인지 확인한다(있다면).
- 비용/잔액이 일관되는지(잔액 음수 금지) 확인한다.
- 언어 혼합/프롬프트 노출이 없는지 확인한다.
- 발견된 문제는 `vibe/debt-log.md`에 기록한다.

## 의존성 & 연결

**이전 작업에서 가져올 것**:

- **계획서**: [U-022[Mvp]](U-022[Mvp].md) - Scanner 슬롯 UI + 업로드→아이템화 반영
- **계획서**: [U-021[Mvp]](U-021[Mvp].md) - 이미지 이해(Scanner) 백엔드 엔드포인트

**다음 작업에 전달할 것**:

- 최종 데모 루프(CP-MVP-03)에서 사용할 “업로드 안정성 기준선”과 런북/증거
- Scanner 관련 기술 부채 항목(debt-log)

## 주의사항

**기술적 고려사항**:

- 업로드는 보안/비용/지연 리스크가 크므로, 실패/차단/대체 결과를 “기본 플로우”로 취급한다. (RULE-004/005)
- 좌표 규약은 이미지 이해 결과(비전 bbox)와 UI 핫스팟의 장기 호환성을 좌우하므로, 반드시 검증한다. (RULE-009)

**잠재적 리스크**:

- 업로드 실패 시 UX가 “무반응”으로 보이면 데모에서 치명적 → 반드시 즉시 피드백(배지/메시지/폴백)으로 흡수한다.

## 페어링 질문 (결정 필요)

- [ ] **Q1**: 업로드 파일 제한(크기/포맷)은 어디까지를 MVP 기준으로 둘까?
  - Option A: png/jpg/webp + 크기 상한(권장, 안정성↑)
  - Option B: gif/pdf까지 허용(데모 다양성↑, 예외 처리/비용↑)

## 참고 자료

- `vibe/prd.md` - Scanner 요구/Hard Gate
- `.cursor/rules/00-core-critical.mdc` - RULE-004/005/006/008/009
