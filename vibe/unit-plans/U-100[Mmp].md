# U-100[Mmp]: Dockerfile/로컬 실행(프론트/백엔드)

## 메타데이터

| 항목      | 내용        |
| --------- | ----------- |
| Unit ID   | U-100[Mmp]  |
| Phase     | MMP         |
| 예상 소요 | 75분        |
| 의존성    | CP-MVP-03   |
| 우선순위  | ⚡ Critical |

## 작업 목표

프론트/백엔드를 Docker 기반으로 로컬에서 동일하게 실행할 수 있도록 구성해, 데모/검증 환경을 표준화한다.

**배경**: 배포 전 단계에서 로컬 실행 환경이 흔들리면 회귀 검증이 어려워진다. 또한 Secret/권한을 안전하게 분리하기 위한 컨테이너화가 필요하다. (RULE-007)

**완료 기준**:

- 프론트/백엔드 각각(또는 compose)로 Docker 실행이 가능하다.
- 로컬 실행 시에도 프롬프트 원문/키/토큰이 로그/UI에 노출되지 않는다. (RULE-007/008)
- 개발자 런북(명령/포트/환경변수)이 명확해진다(문서/README 또는 runbook).

## 영향받는 파일

**생성**:

- `frontend/Dockerfile` - 프론트 빌드/서빙
- `backend/Dockerfile` - 백엔드 실행(FastAPI)
- (선택) `docker-compose.yml` - 로컬 통합 실행
- (선택) `vibe/unit-runbooks/U-100[Mmp].md` - 로컬 실행 런북

**수정**:

- 없음(기존 설정과 충돌 시 최소 수정)

**참조**:

- `vibe/tech-stack.md` - Node/Python 런타임 버전
- `.cursor/rules/00-core-critical.mdc` - RULE-007/010

## 구현 흐름

### 1단계: 컨테이너 경계/환경변수 정리

- 프론트: 정적 빌드/서빙(또는 dev 서버 컨테이너) 전략 선택
- 백엔드: Uvicorn 실행, Vertex 인증은 런타임 권한/secret로만 주입

### 2단계: Dockerfile 작성(버전 고정)

- Node 24.12.0, Python 3.14.0 기반으로 이미지 구성(tech-stack SSOT).
- 빌드 캐시/의존성 설치 최적화(필요 최소) 적용

### 3단계: 로컬 실행/검증 루프 연결

- “데모 10분 루프(CP-MVP-03)”를 컨테이너 환경에서도 재현할 수 있도록 런북을 남긴다.

## 의존성 & 연결

**이전 작업에서 가져올 것**:

- **체크포인트**: [CP-MVP-03](CP-MVP-03.md) - 데모 루프 기준선

**다음 작업에 전달할 것**:

- U-101에서 Cloud Run 배포 구성으로 확장할 컨테이너 기반
- U-105 자동 리플레이/회귀 실행 시 “표준 실행 환경”

## 주의사항

**기술적 고려사항**:

- (RULE-007) Secret은 이미지에 bake-in 금지: 런타임 주입만.
- (RULE-010) “최신” 베이스 이미지로 임의 변경 금지: tech-stack 기준 유지.

**잠재적 리스크**:

- 컨테이너화가 초기엔 느릴 수 있음 → 데모 안정성/재현성 이득이 크므로 MMP에서 수행한다.

## 페어링 질문 (결정 필요)

- [ ] **Q1**: 로컬 실행은 compose로 단일 명령을 목표로 할까?
  - Option A: compose 단일 실행(권장: 데모/검증 단순)
  - Option B: 프론트/백엔드 개별 실행(유연하지만 진입장벽↑)

## 참고 자료

- `vibe/tech-stack.md` - 런타임/배포 기준
- `.cursor/rules/00-core-critical.mdc` - RULE-007/010
