# CP-MMP-02: 체크포인트 - 시나리오 회귀 100%

## 메타데이터

| 항목      | 내용              |
| --------- | ----------------- |
| Unit ID   | CP-MMP-02         |
| Phase     | MMP               |
| 예상 소요 | 60분              |
| 의존성    | RU-011[Mmp],U-107 |
| 우선순위  | ⚡ Critical       |

## 작업 목표

Scenario Library를 기준으로 “대표 시나리오 회귀 100% 통과”를 달성하고, Hard Gate 인바리언트가 배포/운영 수준에서도 깨지지 않음을 증명한다.

**배경**: MMP는 품질/운영 관점에서 회귀를 자동으로 잡을 수 있어야 하며, 특히 스키마/경제/안전/일관성은 항상 통과해야 한다. (PRD 10.3/10.5)

**완료 기준**:

- 대표 시나리오 5개(U-105)가 모두 통과한다(예외 없이 pass).
- 실패가 발생하면 즉시 원인(시나리오/턴/인바리언트)을 기록하고, 복구/수정 후 다시 100% 통과를 확인한다.
- 결과 리포트가 아티팩트로 남는다(프롬프트 원문/CoT 비노출). (RULE-008)

## 영향받는 파일

**생성**:

- `vibe/unit-runbooks/CP-MMP-02.md` - 회귀 실행/해석 런북
- `vibe/unit-results/CP-MMP-02.md` - 결과(pass/fail, 실패 원인, 측정값)

**수정**:

- 없음(검증 단계, 필요 시 결함 수정 유닛을 추가로 생성할 수 있음)

**참조**:

- `vibe/prd.md` 10.3/10.5 - Replay/Hard gate 요구
- `.cursor/rules/00-core-critical.mdc` - RULE-003/004/005/006/008/009

## 구현 흐름

### 1단계: 자동 러너 실행(로컬/배포 중 1)

- 자동 러너(U-105)로 시나리오 5개를 실행한다.
- 각 시나리오별 pass/fail와 첫 실패 지점을 기록한다.

### 2단계: 실패 분석/수정 루프

- 실패 시 인바리언트 종류로 분류한다:
  - Schema/Economy/Safety/Consistency
- 수정은 원인 유닛에서 수행하고, 다시 전체 시나리오를 재실행한다.

### 3단계: 결과 아티팩트 정리

- 100% 통과 결과 리포트를 남기고, CP 문서에 링크/요약을 기록한다.

## 의존성 & 연결

**이전 작업에서 가져올 것**:

- **계획서**: [U-105[Mmp]](U-105[Mmp].md) - Scenario Library/자동 리플레이
- **계획서**: [RU-011[Mmp]](RU-011[Mmp].md) - Autopilot/Replay 모듈 정리
- **계획서**: [U-107[Mmp]](U-107[Mmp].md) - UI 품질(모바일/접근성) 개선

**다음 작업에 전달할 것**:

- 운영/데모에서 “회귀 100% 통과”를 지속적으로 유지하는 품질 게이트

## 주의사항

**기술적 고려사항**:

- (RULE-004) 복구 실패 시에도 폴백으로 종료되어야 하며, 회귀에서 “멈춤”이 없어야 한다.
- (RULE-008) 어떤 리포트/로그에도 프롬프트 원문/내부 추론을 남기지 않는다.

**잠재적 리스크**:

- 비결정성으로 텍스트 결과는 달라질 수 있음 → 인바리언트 위주로 pass/fail를 결정하고, 텍스트 비교는 지양한다.

## 페어링 질문 (결정 필요)

- [ ] **Q1**: 회귀 실행 환경은 어디를 기준으로 할까?
  - Option A: 로컬 컨테이너(U-100) 기준(권장: 반복 속도)
  - Option B: 배포 환경(Cloud Run) 기준(신뢰도↑, 실행 비용↑)

## 참고 자료

- `vibe/prd.md` - Replay/Hard gate 품질 게이트
- `.cursor/rules/00-core-critical.mdc` - RULE-003~005, RULE-008
